webpackJsonp([55],{"8pcL":function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var e=i("wtEF"),a=i("mtWM"),n=i.n(a),l=i("9igS"),o=(i("mw3O"),{name:"visitplandetails",store:e.a,data:function(){return{msg:"拜访计划详情页",detailData:null,visitId:null,visitdetails:{},isexa:!1,tableData:null,tableNumber:0,searchName:null,page:1,limit:20,thisshow:!0,retracts:!0,examines:!0,ratetexts:["2","4","6","8","10"],dialogVisible:!1,showverify:!1,auditing:this.$store.state.systemHttp+"/upload/staticImg/examine.png"}},activated:function(){this.loadData(),this.loadTable(),this.reload()},beforeRouteLeave:function(t,s,i){l.a.$off("id"),i()},methods:{reload:function(){var t=this;l.a.$on("id",function(s){s&&(t.loadData(),t.loadTable())})},loadData:function(){var t=this;this.detailData=this.$store.state.visitdetailsData,this.visitId=this.detailData.submitData.id,n()({method:"get",url:t.$store.state.defaultHttp+"visit/selectVisitById.do?cId="+t.$store.state.iscId+"&id="+this.visitId}).then(function(s){t.visitdetails=s.data.map.visit,t.visitdetails.assistants=[],t.visitdetails.assistantsid=[],t.visitdetails.privateUser!==[]&&t.visitdetails.privateUser.forEach(function(s){t.visitdetails.assistants.push(s.private_name),t.visitdetails.assistantsid.push(s.private_id)}),t.$store.state.ispId==t.visitdetails.approverid?t.isexa=!0:t.isexa=!1,"已审核"==t.visitdetails.approverState?(t.examines=!1,t.showverify=!0):(t.examines=!0,t.showverify=!1)}).catch(function(t){})},loadTable:function(){var t=this,s=i("1nuA"),e={};e.searchName=this.searchName,e.page=this.page,e.limit=this.limit,n()({method:"post",url:t.$store.state.defaultHttp+"visit/selectVisit.do?cId="+t.$store.state.iscId+"&pId="+this.$store.state.ispId,data:s.stringify(e)}).then(function(s){var i=s.data.map.success;t.tableData=i,t.tableNumber=s.data.count}).catch(function(t){})},getTime:function(){this.$store.commit("getNowTime")},toexamine:function(t){this.getTime();var s=this,e=i("1nuA"),a=t.target.innerText,l={};l.id=this.visitId,l.approverState="审核"==a?"已审核":"待审核",l.approverTime=this.$store.state.nowtime,n()({method:"post",url:s.$store.state.defaultHttp+"visit/updateVisitState.do?cId="+s.$store.state.iscId,data:e.stringify(l)}).then(function(t){t.data.code&&200==t.data.code?(s.$message({message:"操作成功",type:"success"}),s.examines=!s.examines,s.showverify=!s.showverify,s.$options.methods.loadData.bind(s)(!0)):s.$message({message:t.data.msg,type:"error"})}).catch(function(t){s.$message.error("操作失败,请重新操作")})},getRow:function(t,s){this.$store.state.visitdetailsData.submitData={id:s.id},this.$options.methods.loadData.bind(this)(!0)},retract:function(){this.retracts=!this.retracts,this.thisshow=!this.thisshow},clickRates:function(t){var s=this,e=i("1nuA"),a={};a.id=this.visitId,a.customerpoolid=this.visitdetails.customerpoolid,a.customerName=this.visitdetails.customerName,a.score=t,"已完成"!==this.visitdetails.state?s.$message({message:"该拜访计划非完成状态，暂不可评分",type:"error"}):n()({method:"post",url:s.$store.state.defaultHttp+"visit/updateVisit.do?cId="+s.$store.state.iscId,data:e.stringify(a)}).then(function(t){t.data.code&&200==t.data.code?(s.$message({message:"评分成功",type:"success"}),s.$options.methods.loadData.bind(s)(!0)):s.$message({message:t.data.msg,type:"error"})}).catch(function(t){s.$message.error("评分失败,请重新评分")})},showImg:function(){this.dialogVisible=!0},search:function(){this.$options.methods.loadTable.bind(this)(!0)},handleSizeChange:function(t){this.limit=t,this.$options.methods.loadTable.bind(this)(!1)},handleCurrentChange:function(t){this.page=t,this.$options.methods.loadTable.bind(this)(!1)}}}),r={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("el-row",{staticClass:"visitdetcontent",attrs:{gutter:10}},[i("el-col",{attrs:{span:18}},[i("div",{staticClass:"top"},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",{staticClass:"bold_span"},[t._v(t._s(t.visitdetails.customerName))]),t._v(" "),i("span",{staticStyle:{"margin-left":"50px"}},[t._v(t._s(t.visitdetails.contactsName))]),t._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.retracts,expression:"retracts"}],staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:function(s){t.retract()}}},[t._v("收起")]),t._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.retracts,expression:"!retracts"}],staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:function(s){t.retract()}}},[t._v("显示")]),t._v(" "),t.isexa?i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.examines,expression:"examines"}],staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:function(s){t.toexamine(s)}}},[t._v("审核")]):t._e(),t._v(" "),t.isexa?i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.examines,expression:"!examines"}],staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:function(s){t.toexamine(s)}}},[t._v("反审核")]):t._e()],1),t._v(" "),i("div",{staticClass:"text item"},[i("ul",[i("li",[t._v("拜访对象："),i("span",[t._v(t._s(t.visitdetails.contactsName))])]),t._v(" "),i("li",{staticStyle:{flex:"0 0 50%"}},[t._v("联系电话："),i("span",[t._v(t._s(t.visitdetails.phone))])])]),t._v(" "),i("div",{staticClass:"item_body"},[t._v("拜访主题："),i("span",[t._v(t._s(t.visitdetails.visitTheme))])]),t._v(" "),i("div",{staticClass:"item_body"},[t._v("拜访目的："),i("span",[t._v(t._s(t.visitdetails.visitObjective))])]),t._v(" "),i("p",[t._v(" ")]),t._v(" "),t.showverify?i("div",{staticClass:"verify"},[i("img",{staticClass:"verify_img",attrs:{src:t.auditing,alt:"已审核"}})]):t._e()])])],1),t._v(" "),t.thisshow?i("div",{staticClass:"top"},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v("基本信息")])]),t._v(" "),i("div",{staticClass:"text item"},[i("ul",[i("li",[t._v("拜访时间："),i("span",[t._v(t._s(t.visitdetails.visitTime))])]),t._v(" "),i("li",[t._v("结束时间："),i("span",[t._v(t._s(t.visitdetails.endTime))])]),t._v(" "),i("li"),t._v(" "),i("li",[t._v("协助人员："),t._l(t.visitdetails.assistants,function(s,e){return i("span",{key:e},[t._v(t._s(s)+" , ")])})],2),t._v(" "),i("li",[t._v("审核人："),i("span",[t._v(t._s(t.visitdetails.approver))])]),t._v(" "),i("li",[t._v("审核状态："),i("span",[t._v(t._s(t.visitdetails.approver))])]),t._v(" "),i("li",[t._v("负责人："),i("span",[t._v(t._s(t.visitdetails.private_employee))])]),t._v(" "),i("li",[t._v("部门："),i("span",[t._v(t._s(t.visitdetails.deptname))])]),t._v(" "),i("li",[t._v("机构："),i("span",[t._v(t._s(t.visitdetails.parentname))])])])])])],1):t._e(),t._v(" "),i("div",{staticClass:"top"},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v("执行结果")])]),t._v(" "),i("div",{staticClass:"text item"},[i("ul",[i("li",[t._v("执行状况："),i("span",[t._v(t._s(t.visitdetails.state))])]),t._v(" "),i("li",[t._v("完成时间："),i("span",[t._v(t._s(t.visitdetails.endTime))])]),t._v(" "),i("li"),t._v(" "),i("li",[t._v("签到时间："),i("span",[t._v(t._s(t.visitdetails.visitTime))])]),t._v(" "),i("li",[t._v("签到地址："),i("span",[t._v(t._s(t.visitdetails.customerName))])]),t._v(" "),i("li"),t._v(" "),i("li",[t._v("图片：\n                            "),i("div",{staticClass:"imgbox"},[i("img",{attrs:{src:"/upload/staticImg/test.png"},on:{click:t.showImg}})]),t._v(" "),i("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(s){t.dialogVisible=s}}},[i("img",{attrs:{width:"100%",src:"/upload/staticImg/test.png",alt:""}})])],1)]),t._v(" "),i("p",[t._v(" ")])])])],1),t._v(" "),i("div",{staticClass:"top"},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"block"},[i("span",{staticClass:"rate_text"},[t._v("打分")]),t._v(" "),i("el-rate",{staticClass:"rate_star",attrs:{"show-text":"",texts:t.ratetexts},on:{change:t.clickRates},model:{value:t.visitdetails.score,callback:function(s){t.$set(t.visitdetails,"score",s)},expression:"visitdetails.score"}})],1)])],1)]),t._v(" "),i("el-col",{staticClass:"right",staticStyle:{padding:"10px"},attrs:{span:6}},[i("div",{staticClass:"searchList",staticStyle:{width:"100%"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入公司名称"},nativeOn:{keyup:function(s){return"button"in s||!t._k(s.keyCode,"enter",13,s.key,"Enter")?t.search(s):null}},model:{value:t.searchName,callback:function(s){t.searchName=s},expression:"searchName"}}),t._v(" "),i("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"mini"},on:{click:function(s){t.search()}}})],1),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[i("el-table-column",{attrs:{prop:"customerName",label:"公司名称"},scopedSlots:t._u([{key:"default",fn:function(s){return[i("div",{on:{click:function(i){t.getRow(s.$index,s.row)}}},[t._v("\n                    "+t._s(s.row.customerName)+"\n                ")])]}}])})],1),t._v(" "),i("div",{staticClass:"block numberPage number"},[i("el-pagination",{attrs:{"current-page":t.page,"page-sizes":[20,30,50,100],"page-size":20,layout:"total, sizes, prev, next",total:t.tableNumber},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1)},staticRenderFns:[]};var c=i("VU/8")(o,r,!1,function(t){i("gdXP")},null,null);s.default=c.exports},gdXP:function(t,s){}});