webpackJsonp([34],{E6lE:function(e,t){},sCom:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("wtEF"),r=a("mtWM"),o=a.n(r),l=(a("mw3O"),a("PQp9")),i={store:s.a,components:{UE:l.a},data:function(){return{msg:"新增工单",workOrderaddorUpdateData:null,myform:{id:null,batch_id:null,customerpoolId:null,contactId:null,phone:null,feedbackTime:null,feedbackType:null,acceptance:null,serviceType:null,serviceTypeName:null,orderId:null,problem:null,describe:null,user:this.$store.state.user,ascriptionId:null,ascription:null,secondid:null,department:null,deptid:null,mechanism:null,enclosures:[],enclosureOldNames:[]},rules:{customerpoolId:[{required:!0,message:"客户名称不能为空",trigger:"blur"}],contactId:[{required:!0,message:"联系人名称不能为空",trigger:"blur"}],phone:[{required:!0,message:"电话不能为空",trigger:"blur"}],feedbackType:[{required:!0,message:"反馈方式不能为空",trigger:"blur"}],problem:[{required:!0,message:"问题名称不能为空",trigger:"blur"}],describe:[{required:!0,message:"问题描述不能为空",trigger:"blur"}]},customerId:null,customerName:null,customerList:[],contactsList:[],feedbackTypeList:[{index:1,name:"电话"},{index:2,name:"QQ"},{index:3,name:"微信"},{index:4,name:"邮箱"},{index:5,name:"上门"}],acceptanceList:[],orderList:[],fileList:[],doUpload:this.$store.state.defaultHttp+"workOrder/upload.do?cId="+this.$store.state.iscId,isDisable:!1,activeName:"first",defaultMsg:"",config:{initialFrameWidth:610,initialFrameHeight:500,toolbars:[["undo","redo","|","fontsize","bold","italic","underline","forecolor","|","insertorderedlist","insertunorderedlist","|","justifyleft","justifycenter","justifyright","justifyjustify","|","insertimage","attachment","|","imagenone","imageleft","imageright","imagecenter"]],elementPathEnabled:!1,wordCount:!1},fieldsform:{},previewData:[],deptData:[],defaultProps:{label:"deptname",children:"next"},userData:[]}},mounted:function(){this.loadData(),this.loadContactandOrder(),this.loadfield(),this.loadUserandDept()},methods:{loadData:function(){var e=this,t=a("1nuA"),s=this.$store.state.workOrderaddorUpdateData;this.workOrderaddorUpdateData=s,console.log(s),s.customerpoolId?(this.customerId=s.customerpoolId,this.customerName=s.customerpool,this.myform.id=s.id,this.myform.batch_id=s.batch_id,this.myform.customerpoolId=s.customerpoolId,this.myform.contactId=s.contactsId,this.myform.phone=s.phone,this.myform.feedbackType=s.feedbackType,this.myform.acceptance=s.acceptance,this.myform.serviceType=s.serviceType,this.myform.serviceTypeName=s.serviceTypeName,this.myform.orderId=s.orderNo,this.myform.problem=s.problem,this.myform.describe=s.describe,this.myform.user=s.private_employee,this.myform.ascriptionId=s.ascriptionId,this.myform.ascription=s.ascription,this.myform.secondid=s.secondid,this.myform.department=s.deptname,this.myform.deptid=s.deptid,this.myform.mechanism=s.parentname,this.myform.enclosures=s.enclosures,this.myform.enclosureOldNames=s.enclosureOldNames,this.defaultMsg=s.describe):(this.myform.serviceTypeName=this.$store.state.workOrderaddorUpdateData.name,this.myform.serviceType=this.$store.state.workOrderaddorUpdateData.id);var r={page:1,limit:1e6};o()({method:"post",url:e.$store.state.defaultHttp+"customerpool/query.do?cId="+e.$store.state.iscId,data:t.stringify(r)}).then(function(t){e.customerList=t.data.map.success}).catch(function(e){}),o()({method:"get",url:e.$store.state.defaultHttp+"customerTwo/getNameAndId.do?cId="+e.$store.state.iscId}).then(function(t){e.acceptanceList=t.data.map.success}).catch(function(e){})},loadContactandOrder:function(){var e=this,t=a("1nuA"),s={};s.customerpool_id=this.customerId;var r={};r.searchName=this.customerName,r.page=1,r.limit=1e5,o()({method:"post",url:e.$store.state.defaultHttp+"getPoolContactsName.do?cId="+e.$store.state.iscId,data:t.stringify(s)}).then(function(t){e.contactsList=t.data.map.success}).catch(function(e){}),o()({method:"post",url:e.$store.state.defaultHttp+"order/selectOrderList.do?cId="+e.$store.state.iscId,data:t.stringify(r)}).then(function(t){e.orderList=t.data.map.orders}).catch(function(e){})},loadfield:function(){var e=this,t=a("1nuA"),s=null,r=null;this.workOrderaddorUpdateData.customerpoolId&&(s=this.workOrderaddorUpdateData.id,r=this.workOrderaddorUpdateData.batch_id);var l={label:11,id:s,batch_id:r};o()({method:"post",url:e.$store.state.defaultHttp+"field/queryField.do?cId="+e.$store.state.iscId,data:t.stringify(l)}).then(function(t){var a=t.data;a.forEach(function(t,a){t.displayVal="",e.workOrderaddorUpdateData.customerpoolId?(t.default_value=t.value,"user"!=t.formType&&"structure"!=t.formType||(t.displayVal=t.deptOrUserName,t.default_value=parseInt(t.value))):"checkbox"!==t.formType&&null!==t.value&&(t.default_value=t.value),1==t.is_null&&(e.rules[t.field_name]=[{required:!0,message:" ",trigger:"blur"}])}),e.previewData=a}).catch(function(e){})},loadUserandDept:function(){var e=this,t=a("1nuA"),s={page:1,limit:"9999"};o()({method:"post",url:e.$store.state.defaultHttp+"getPrivateUserAll.do?cId="+e.$store.state.iscId,data:t.stringify(s)}).then(function(t){e.userData=t.data.map.success}).catch(function(e){}),o()({method:"get",url:e.$store.state.defaultHttp+"dept/getDeptNodeTree.do?cId="+e.$store.state.iscId}).then(function(t){e.deptData=t.data.map.success}).catch(function(e){})},selectCustomer:function(e){var t=this;this.customerId=e,this.customerList.forEach(function(a){a.id==e&&(t.myform.ascriptionId=a.privateUser[0].private_id,t.myform.ascription=a.privateUser[0].private_employee,t.myform.secondid=a.secondid,t.myform.department=a.deptname,t.myform.deptid=a.deptid,t.myform.mechanism=a.parentname,t.customerName=a.pName)}),this.$options.methods.loadContactandOrder.bind(this)()},selectContact:function(e){var t=this;this.contactsList.forEach(function(a){a.id==e&&(t.myform.phone=a.phone)})},loadList:function(){var e=this;this.fileList=[];var t=this.myform.enclosures,a=this.myform.enclosureOldNames;t.forEach(function(t,a){e.fileList.push({url:e.$store.state.systemHttp+"upload/"+e.$store.state.iscId+"/"+t,name:"",response:t})}),a.forEach(function(t,a){e.fileList.forEach(function(e,s){a==s&&(e.name=t)})})},handleAvatarSuccess:function(e,t,a){var s=this;this.myform.enclosures=[],this.myform.enclosureOldNames=[],a.forEach(function(e){s.myform.enclosures.push(e.response),s.myform.enclosureOldNames.push(e.name)})},handleRemove:function(e,t){var a=this;this.myform.enclosures=[],this.myform.enclosureOldNames=[],t.forEach(function(e){a.myform.enclosures.push(e.response),a.myform.enclosureOldNames.push(e.name)})},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},handlecheck:function(e,t){this.previewData.forEach(function(a){a.id==t.id&&(a.displayVal=e.deptname,a.default_value=e.deptid)})},beforeUpload:function(e){if(!(e.size/1024/1024<5))return this.$message.warning("文件大小不能超过 5MB!"),!1},uploadSuccess:function(e,t,a){this.previewData.forEach(function(t){"file"==t.formType&&(t.default_value=e)})},onSubmit:function(){var e=this,t=this.$refs.ue.getUEContent(),s=(a("1nuA"),e.previewData),r={id:this.myform.id,batch_id:this.myform.batch_id,customerpoolId:this.customerId,contactsId:this.myform.contactId,phone:this.myform.phone,feedbackType:this.myform.feedbackType,acceptance:this.myform.acceptance,serviceType:this.myform.serviceType,orderId:this.myform.orderId,problem:this.myform.problem,describe:t,enclosures:this.myform.enclosures,enclosureOldNames:this.myform.enclosureOldNames,pId:this.$store.state.ispId,ascriptionId:this.myform.ascriptionId,secondid:this.myform.secondid,deptid:this.myform.deptid},l=!1;if(r.customerpoolId||(e.$message({message:"客户名称不能为空",type:"error"}),l=!0),r.contactsId||(e.$message({message:"联系人不能为空",type:"error"}),l=!0),r.phone||(e.$message({message:"电话不能为空",type:"error"}),l=!0),r.feedbackType||(e.$message({message:"反馈方式不能为空",type:"error"}),l=!0),r.problem||(e.$message({message:"问题名称不能为空",type:"error"}),l=!0),r.describe||(e.$message({message:"问题描述不能为空",type:"error"}),l=!0),s.forEach(function(t){"checkbox"==t.formType?t.value=t.default_value.join(","):"user"==t.formType||"structure"==t.formType?t.default_value&&(t.value=t.default_value.toString()):t.value=t.default_value,1!=t.is_null||t.value||(e.$message({message:t.name+"不能为空",type:"error"}),l=!0)}),!l){var i={entity:r,field:s};this.isDisable=!0,o()({method:"post",url:this.$store.state.defaultHttp+"workOrder/saveOrUpdate.do?cId="+e.$store.state.iscId,data:i}).then(function(t){t.data.code&&"200"==t.data.code?(e.$message({message:"操作成功",type:"success"}),e.closeTag()):(e.$message({message:t.data.msg,type:"error"}),e.isDisable=!1)}).catch(function(t){e.isDisable=!1})}},closeTag:function(){var e=this,t=void 0;this.$store.state.tagsList.forEach(function(a,s){a.name==e.$options.name&&(t=s)});var a=this.$store.state.tagsList.splice(t,1)[0];(this.$store.state.tagsList[t]?this.$store.state.tagsList[t]:this.$store.state.tagsList[t-1])?a.path===this.$route.fullPath&&this.$router.push("/workOrder"):this.$router.push("/index")}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wo_aou"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"bold_span"},[e._v("服务工单")])]),e._v(" "),a("div",{staticClass:"orderHead"},[a("el-form",{ref:"myform",attrs:{inline:!0,model:e.myform,rules:e.rules}},[a("el-form-item",{staticClass:"first_input",attrs:{prop:"customerpoolId",label:"客户名称","label-width":"90px"}},[a("el-select",{staticClass:"inputbox",attrs:{placeholder:"请选择客户名称",filterable:""},on:{change:e.selectCustomer},model:{value:e.myform.customerpoolId,callback:function(t){e.$set(e.myform,"customerpoolId",t)},expression:"myform.customerpoolId"}},e._l(e.customerList,function(e){return a("el-option",{key:e.id,attrs:{label:e.pName,value:e.id}})}))],1),e._v(" "),a("el-form-item",{staticClass:"first_input",attrs:{prop:"contactId",label:"联系人","label-width":"90px"}},[a("el-select",{staticClass:"inputbox",attrs:{placeholder:"请选择联系人"},on:{change:e.selectContact},model:{value:e.myform.contactId,callback:function(t){e.$set(e.myform,"contactId",t)},expression:"myform.contactId"}},e._l(e.contactsList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{staticClass:"first_input",attrs:{prop:"phone",label:"电话","label-width":"90px"}},[a("el-input",{staticClass:"inputbox",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.myform.phone,callback:function(t){e.$set(e.myform,"phone",t)},expression:"myform.phone"}})],1),e._v(" "),a("el-form-item",{staticClass:"first_input",attrs:{prop:"feedbackType",label:"反馈方式","label-width":"90px"}},[a("el-select",{staticClass:"inputbox",attrs:{placeholder:"请选择反馈方式"},model:{value:e.myform.feedbackType,callback:function(t){e.$set(e.myform,"feedbackType",t)},expression:"myform.feedbackType"}},e._l(e.feedbackTypeList,function(e){return a("el-option",{key:e.index,attrs:{label:e.name,value:e.name}})}))],1),e._v(" "),a("el-form-item",{staticClass:"first_input",attrs:{label:"受理人","label-width":"90px"}},[a("el-select",{staticClass:"inputbox",attrs:{placeholder:"请选择受理人"},model:{value:e.myform.acceptance,callback:function(t){e.$set(e.myform,"acceptance",t)},expression:"myform.acceptance"}},e._l(e.acceptanceList,function(e){return a("el-option",{key:e.private_id,attrs:{label:e.private_employee,value:e.private_id}})}))],1),e._v(" "),a("el-form-item",{staticClass:"first_input",attrs:{label:"工单类型","label-width":"90px"}},[a("el-input",{staticClass:"inputbox",attrs:{disabled:!0},model:{value:e.myform.serviceTypeName,callback:function(t){e.$set(e.myform,"serviceTypeName",t)},expression:"myform.serviceTypeName"}})],1),e._v(" "),a("el-form-item",{staticClass:"first_input",attrs:{label:"销售单号","label-width":"90px"}},[a("el-select",{staticClass:"inputbox",attrs:{placeholder:"请选择销售单号"},model:{value:e.myform.orderId,callback:function(t){e.$set(e.myform,"orderId",t)},expression:"myform.orderId"}},e._l(e.orderList,function(e){return a("el-option",{key:e.id,attrs:{label:e.orderNo,value:e.id}})}))],1),e._v(" "),e._l(e.previewData,function(t){return a("el-form-item",{key:t.id,staticClass:"first_input",staticStyle:{"margin-right":"15px"},attrs:{label:t.name,prop:t.field_name,"label-width":"90px"}},["text"==t.formType||"email"==t.formType?a("el-input",{staticClass:"inputbox",attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"textarea"==t.formType?a("el-input",{staticClass:"inputbox",attrs:{type:"textarea",maxlength:t.max_length,placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"number"==t.formType?a("el-input",{staticClass:"inputbox",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"floatnumber"==t.formType?a("el-input",{staticClass:"inputbox",attrs:{onkeyup:"value=value.replace(/^\\D*(\\d*(?:\\.\\d{0,2})?).*$/g, '$1')",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"mobile"==t.formType?a("el-input",{staticClass:"inputbox",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",maxlength:11,placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"select"==t.formType?a("el-select",{staticClass:"inputbox",attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(t.setting,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})):"checkbox"==t.formType?a("el-select",{staticClass:"inputbox",attrs:{multiple:"",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(t.setting,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})):"user"==t.formType?a("el-select",{staticClass:"inputbox",attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(e.userData,function(e){return a("el-option",{key:e.private_id,attrs:{label:e.private_employee,value:e.private_id}})})):"structure"==t.formType?a("el-select",{staticClass:"noPadding_select inputbox",attrs:{placeholder:t.input_tips},model:{value:t.displayVal,callback:function(a){e.$set(t,"displayVal",a)},expression:"item.displayVal"}},[a("el-option",{staticClass:"droplist nopadding_option",attrs:{value:t.displayVal}},[a("el-tree",{ref:"tree",refInFor:!0,attrs:{"node-key":"deptid","highlight-current":"","default-expand-all":"","expand-on-click-node":!1,data:e.deptData,props:e.defaultProps},on:{"node-click":function(a){e.handlecheck(a,t)}}})],1)],1):"date"==t.formType?a("el-date-picker",{staticClass:"inputbox",attrs:{type:"date",placeholder:t.input_tips,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"datetime"==t.formType?a("el-date-picker",{staticClass:"inputbox",attrs:{type:"datetime",placeholder:t.input_tips,format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"file"==t.formType?a("el-upload",{staticClass:"upload-demo",attrs:{action:e.doUpload,"on-success":e.uploadSuccess,"before-upload":e.beforeUpload}},[a("el-button",{attrs:{size:"mini",type:"info-btn"}},[e._v("上传")]),e._v(" "),a("div",{staticClass:"el-upload__tip",staticStyle:{"margin-top":"-20px"},attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(t.input_tips))])],1):e._e()],1)}),e._v(" "),a("br"),e._v(" "),a("el-form-item",{staticClass:"first_input",attrs:{prop:"problem",label:"问题名称","label-width":"90px"}},[a("el-input",{staticStyle:{width:"610px"},model:{value:e.myform.problem,callback:function(t){e.$set(e.myform,"problem",t)},expression:"myform.problem"}})],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",{staticClass:"first_input",attrs:{prop:"describe",label:"问题描述","label-width":"90px"}},[a("div",{staticClass:"editor-container editor_head"},[a("UE",{ref:"ue",attrs:{defaultMsg:e.defaultMsg,config:e.config}})],1)])],2)],1),e._v(" "),a("el-form",{staticClass:"disabledForm",attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"制单人","label-width":"110px"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.myform.user,callback:function(t){e.$set(e.myform,"user",t)},expression:"myform.user"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"负责人","label-width":"110px"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.myform.ascription,callback:function(t){e.$set(e.myform,"ascription",t)},expression:"myform.ascription"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门","label-width":"110px"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.myform.department,callback:function(t){e.$set(e.myform,"department",t)},expression:"myform.department"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"机构","label-width":"110px"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.myform.mechanism,callback:function(t){e.$set(e.myform,"mechanism",t)},expression:"myform.mechanism"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"submit_btn"},[a("el-button",{staticStyle:{"margin-right":"100px"},attrs:{type:"primary",disabled:e.isDisable},on:{click:e.onSubmit}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.closeTag}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var d=a("VU/8")(i,n,!1,function(e){a("E6lE")},null,null);t.default=d.exports}});