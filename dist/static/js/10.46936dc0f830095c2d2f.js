webpackJsonp([10],{"5DJY":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i("wtEF");var a=i("mtWM"),s=i.n(a),o=(i("9igS"),{name:"visitplanaddorupdate",data:function(){return{visitaddOrUpdateData:{},myForm:{customerName:null},rules:{customerName:[{required:!0,message:"公司名称不能为空",trigger:"blur"}],visitTime:[{required:!0,message:"拜访时间不能为空",trigger:"blur"}],endTime:[{required:!0,message:"结束时间不能为空",trigger:"blur"}],remindTime:[{required:!0,message:"提醒时间不能为空",trigger:"blur"}],contactsid:[{required:!0,message:"拜访对象不能为空",trigger:"blur"}],visitTheme:[{required:!0,message:"拜访主题不能为空",trigger:"blur"}],visitObjective:[{required:!0,message:"拜访目的不能为空",trigger:"blur"}],approverid:[{required:!0,message:"审核人不能为空",trigger:"blur"}]},tableData:null,assistAudit:null,contactsList:null,searchvalue:null,formid:null,conid:null,assisid:null,apprid:null,isDisable:!1}},activated:function(){this.loadData(),this.loadTable(),this.loadpId(),this.loadContacts()},methods:{loadTable:function(){var t=this,e=i("1nuA"),a={page:"1",limit:"15"};a.pId=this.$store.state.ispId,a.searchName=this.searchvalue,s()({method:"post",url:t.$store.state.defaultHttp+"rightPoolName.do?cId="+t.$store.state.iscId,data:e.stringify(a)}).then(function(e){t.tableData=e.data.map.success.customerpools}).catch(function(t){})},loadData:function(){var t=this;this.visitaddOrUpdateData=this.$store.state.visitaddOrUpdateData;var e=this.visitaddOrUpdateData.createForm,i=this.visitaddOrUpdateData.setForm;i&&(e.forEach(function(e,a){e.type&&"select"==e.type?t.$set(t.myForm,e.inputModel,i[e.inputModel]):e.type&&"date"==e.type?t.$set(t.myForm,e.inputModel,i[e.inputModel]):t.myForm[e.inputModel]=i[e.inputModel]}),this.formid=i.customerpoolid,this.conid=i.contactsid,this.assisid=i.assistantsid,this.apprid=i.approverid,this.myForm.customerName=i.customerName,this.myForm.contactsid=i.contactsid,this.myForm.assistantsid=i.assistantsid,this.myForm.approverid=i.approverid,this.$emit("input",this.myForm))},loadContacts:function(){var t=this,e=i("1nuA"),a={};a.customerpool_id=this.formid,s()({method:"post",url:t.$store.state.defaultHttp+"getPoolContactsName.do?cId="+t.$store.state.iscId,data:e.stringify(a)}).then(function(e){t.contactsList=e.data.map.success}).catch(function(t){})},loadpId:function(){var t=this;i("1nuA");s()({method:"get",url:t.$store.state.defaultHttp+"customerTwo/getNameAndId.do?cId="+t.$store.state.iscId}).then(function(e){t.assistAudit=e.data.map.success}).catch(function(t){})},getRow:function(t,e){this.myForm.customerName=e.name,this.formid=e.id,this.loadContacts()},handleInput:function(t,e){this.myForm[e]=t},handleoninput:function(t,e){this.myForm[e]=t,this.searchvalue=t,this.$options.methods.loadTable.bind(this)(!0)},handleblur:function(t,e){var i=this,a=t.target.value;this.tableData.forEach(function(t){a==t.name&&(i.formid=t.id,i.myForm.customerName=t.name,i.loadContacts())})},submit:function(){var t=this,e=i("1nuA"),a={};t.visitaddOrUpdateData.submitData&&(a.id=this.visitaddOrUpdateData.submitData.id),a.secondid=this.$store.state.deptid,a.deptid=this.$store.state.insid;var o=!1;t.visitaddOrUpdateData.createForm.forEach(function(e){a[e.inputModel]=t.myForm[e.inputModel],"customerName"!=e.inputModel||a[e.inputModel]||(t.$message({message:"拜访客户不能为空",type:"error"}),o=!0),"visitTime"!=e.inputModel||a[e.inputModel]||(t.$message({message:"拜访时间不能为空",type:"error"}),o=!0),"endTime"!=e.inputModel||a[e.inputModel]||(t.$message({message:"结束时间不能为空",type:"error"}),o=!0),"remindTime"!=e.inputModel||a[e.inputModel]||(t.$message({message:"提醒时间不能为空",type:"error"}),o=!0),"contactsid"!=e.inputModel||a[e.inputModel]||(t.$message({message:"拜访对象不能为空",type:"error"}),o=!0),"visitTheme"!=e.inputModel||a[e.inputModel]||(t.$message({message:"拜访主题不能为空",type:"error"}),o=!0),"visitObjective"!=e.inputModel||a[e.inputModel]||(t.$message({message:"拜访目的不能为空",type:"error"}),o=!0),"approverid"!=e.inputModel||a[e.inputModel]||(t.$message({message:"审核人不能为空",type:"error"}),o=!0)}),o||(a.customerpoolid=this.formid,a.contactsid=this.myForm.contactsid,a.approverid=this.myForm.approverid,a.assistantsid=this.myForm.assistantsid,this.isDisable=!0,s()({method:"post",url:t.visitaddOrUpdateData.submitURL,data:e.stringify(a)}).then(function(e){e.data.code&&200==e.data.code?(t.$message({message:"成功",type:"success"}),t.closeTag()):e.data.code&&20001==e.data.code?t.$message({message:"如改变了拜访公司，请重新选择拜访对象",type:"error"}):t.$message({message:e.data.msg,type:"error"}),t.isDisable=!1}).catch(function(e){t.$message.error("提交失败，请重新提交")}))},closeTag:function(){var t=this,e=void 0;this.$store.state.tagsList.forEach(function(i,a){i.name==t.$options.name&&(e=a)});var i=this.$store.state.tagsList.splice(e,1)[0];(this.$store.state.tagsList[e]?this.$store.state.tagsList[e]:this.$store.state.tagsList[e-1])?i.path===this.$route.fullPath&&this.$router.push("/visitplan"):this.$router.push("/index")}}}),r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"addorupdatecontent"},[i("el-form",{ref:"myForm",staticClass:"myForm",attrs:{model:t.myForm,rules:t.rules}},t._l(t.visitaddOrUpdateData.createForm,function(e){return i("el-form-item",{key:e.inputModel,staticClass:"formitemcont",attrs:{"label-width":"100px",label:e.label,prop:e.inputModel}},[e.type&&"input"!=e.type?e.type&&"textarea"==e.type?i("el-input",{staticStyle:{width:"90%"},attrs:{type:"textarea",rows:"5",value:t.myForm[e.inputModel],"auto-complete":"off"},on:{input:function(i){t.handleInput(i,e.inputModel)}}}):e.type&&"require"==e.type&&"customerName"==e.inputModel?i("el-input",{staticStyle:{width:"90%"},attrs:{value:t.myForm[e.inputModel],"auto-complete":"off"},on:{input:function(i){t.handleoninput(i,e.inputModel)},blur:function(i){t.handleblur(i,e.inputModel)}}}):e.type&&"select"==e.type&&"contactsid"==e.inputModel?i("el-select",{staticStyle:{width:"90%"},attrs:{multiple:e.multiple,"collapse-tags":e.multiple,placeholder:e.placeholder},on:{change:function(i){t.handleInput(i,e.inputModel)}},model:{value:t.myForm[e.inputModel],callback:function(i){t.$set(t.myForm,e.inputModel,i)},expression:"myForm[item.inputModel]"}},t._l(t.contactsList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})):e.type&&"select"==e.type?i("el-select",{staticStyle:{width:"90%"},attrs:{multiple:e.multiple,placeholder:e.placeholder},on:{change:function(i){t.handleInput(i,e.inputModel)}},model:{value:t.myForm[e.inputModel],callback:function(i){t.$set(t.myForm,e.inputModel,i)},expression:"myForm[item.inputModel]"}},t._l(t.assistAudit,function(t){return i("el-option",{key:t.private_id,attrs:{label:t.private_employee,value:t.private_id}})})):e.type&&"date"==e.type?i("el-date-picker",{staticStyle:{width:"90%"},attrs:{type:"datetime",placeholder:e.placeholder,format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","default-time":"12:00:00","auto-complete":"off"},on:{change:function(i){t.handleInput(i,e.inputModel)}},model:{value:t.myForm[e.inputModel],callback:function(i){t.$set(t.myForm,e.inputModel,i)},expression:"myForm[item.inputModel]"}}):t._e():i("el-input",{staticStyle:{width:"90%"},attrs:{value:t.myForm[e.inputModel],"auto-complete":"off"},on:{input:function(i){t.handleInput(i,e.inputModel)}}})],1)})),t._v(" "),i("div",{staticClass:"line",staticStyle:{height:"670px"}}),t._v(" "),i("div",{staticClass:"formlist"},[i("el-table",{attrs:{data:t.tableData,border:"",stripe:"","default-sort":{order:"ascending"},"max-height":"660"}},[i("el-table-column",{attrs:{"header-align":"center",align:"center",width:"35"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{staticStyle:{width:"15px",height:"15px",padding:"0","border-radius":"50%"},on:{click:function(i){t.getRow(e.$index,e.row)}}},[t._v(" ")])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"name","min-width":"200",label:"公司名称",sortable:""}}),t._v(" "),i("el-table-column",{attrs:{prop:"address","show-overflow-tooltip":"","min-width":"200",label:"公司地址",sortable:""}}),t._v(" "),i("el-table-column",{attrs:{prop:"representative","min-width":"90",label:"法人",sortable:""}})],1)],1),t._v(" "),i("div",{staticClass:"submit_btn"},[i("el-button",{staticStyle:{"margin-right":"50px !important"},attrs:{type:"primary",disabled:t.isDisable},on:{click:t.submit}},[t._v("立即提交")]),t._v(" "),i("el-button",{on:{click:t.closeTag}},[t._v("取消")])],1)],1)},staticRenderFns:[]};var n=i("VU/8")(o,r,!1,function(t){i("8pFb")},null,null);e.default=n.exports},"8pFb":function(t,e){}});