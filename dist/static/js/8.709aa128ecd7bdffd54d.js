webpackJsonp([8],{htsr:function(e,t){},pSBV:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("mvHQ"),s=a.n(l),i=(a("wtEF"),a("NYxO"),a("mtWM")),o=a.n(i),r=(a("9igS"),{name:"agreementaddorupdate",data:function(){return{examineaddOrUpdateData:{},myForm:{categoryId:null,category_name:null,private_employee:null,deptname:null,parentname:null,image:null,file:null},imageUrl:null,fileList:[],page:1,limit:15,rules:{our_signatories:[{required:!0,message:"我方签约人不能为空",trigger:"blur"}]},customerList:null,searchvalue:null,isDisable:!1,previewData:[],deptData:[],defaultProps:{label:"deptname",children:"next"},userData:[],doUpload:this.$store.state.defaultHttp+"workOrder/upload.do?cId="+this.$store.state.iscId}},mounted:function(){this.loadData()},methods:{loadData:function(){var e=this.$store.state.examineaddOrUpdateData;if(this.examineaddOrUpdateData=e,e.batch_id){if(this.myForm={categoryId:e.category_id,category_name:e.category,private_employee:e.private_employee,deptname:e.deptname,parentname:e.parentname,image:e.image,file:null},e.file){var t=JSON.parse(e.file);this.myForm.file=t.response,this.fileList=[{url:this.$store.state.systemHttp+"upload/"+this.$store.state.iscId+"/"+t.response,name:t.name,response:t.response}]}this.imageUrl=this.$store.state.systemHttp+"upload/"+this.$store.state.iscId+"/"+e.image}else this.myForm={categoryId:e.id,category_name:e.title,private_employee:this.$store.state.user,deptname:this.$store.state.deptname,parentname:this.$store.state.parentname,image:null,file:null};this.loadfield(),this.loadUserandDept(),this.loadCustomer()},loadfield:function(){var e=this,t=a("1nuA"),l=null,s=null;this.examineaddOrUpdateData.batch_id?(this.examineaddOrUpdateData.id,l=this.examineaddOrUpdateData.batch_id,s=this.examineaddOrUpdateData.category_id):s=this.examineaddOrUpdateData.id;var i={label:10,batch_id:l,categoryId:s};o()({method:"post",url:e.$store.state.defaultHttp+"field/queryField.do?cId="+e.$store.state.iscId,data:t.stringify(i)}).then(function(t){var a=t.data;a.forEach(function(t,a){t.displayVal="",e.examineaddOrUpdateData.batch_id?(t.default_value=t.value,"user"==t.formType||"structure"==t.formType?(t.displayVal=t.deptOrUserName,t.default_value=parseInt(t.value)):"customer"==t.formType&&(t.default_value=parseInt(t.value))):"checkbox"!==t.formType&&null!==t.value&&(t.default_value=t.value),1==t.is_null&&(e.rules[t.field_name]=[{required:!0,message:" ",trigger:"blur"}])}),e.previewData=a}).catch(function(e){})},loadUserandDept:function(){var e=this,t=a("1nuA"),l={page:1,limit:"9999"};o()({method:"post",url:e.$store.state.defaultHttp+"getPrivateUserAll.do?cId="+e.$store.state.iscId,data:t.stringify(l)}).then(function(t){e.userData=t.data.map.success}).catch(function(e){}),o()({method:"get",url:e.$store.state.defaultHttp+"dept/getDeptNodeTree.do?cId="+e.$store.state.iscId}).then(function(t){e.deptData=t.data.map.success}).catch(function(e){})},loadCustomer:function(){var e=this,t=a("1nuA"),l={page:1,limit:20};l.pId=this.$store.state.ispId,l.searchName=this.searchvalue,o()({method:"post",url:e.$store.state.defaultHttp+"rightPoolName.do?cId="+e.$store.state.iscId,data:t.stringify(l)}).then(function(t){e.customerList=t.data.map.success.customerpools}).catch(function(e){})},handleChange:function(e,t){var a=this;this.customerList.forEach(function(l){l.id==e&&a.previewData.forEach(function(a){a.id==t.id&&(a.displayVal=l.name,a.default_value=e)})})},handlecheck:function(e,t){this.previewData.forEach(function(a){a.id==t.id&&(a.displayVal=e.deptname,a.default_value=e.deptid)})},beforeUpload:function(e){if(!(e.size/1024/1024<5))return this.$message.warning("大小不能超过 5MB!"),!1},uploadSuccess:function(e,t,a){this.previewData.forEach(function(t){"file"==t.formType&&(t.default_value=e)})},imageuploadSuccess:function(e,t,a){console.log(e,t,a),this.myForm.image=e,this.imageUrl=URL.createObjectURL(t.raw)},fileuploadSuccess:function(e,t,a){console.log(e,t,a);var l={name:t.name,response:t.response};this.myForm.file=s()(l),console.log({name:this.myForm.file})},submit:function(){var e=this,t=(a("1nuA"),{categoryId:this.myForm.categoryId,pid:parseInt(this.$store.state.ispId),secondid:parseInt(this.$store.state.deptid),deptid:parseInt(this.$store.state.insid),image:this.myForm.image,file:this.myForm.file,id:null,batch_id:null});e.examineaddOrUpdateData.batch_id&&(t.id=e.examineaddOrUpdateData.id,t.batch_id=e.examineaddOrUpdateData.batch_id);var l=e.previewData,s=(new Array,!1);if(l.forEach(function(t){"checkbox"==t.formType?t.value=t.default_value.join(","):"user"==t.formType||"structure"==t.formType?t.default_value&&(t.value=t.default_value.toString()):t.value=t.default_value,1!=t.is_null||t.value||(e.$message({message:t.name+"不能为空",type:"error"}),s=!0)}),!s){var i={oaExamine:t,field:l};console.log(i),this.isDisable=!0,o()({method:"post",url:e.$store.state.defaultHttp+"oaExamine/saveOrUpdate.do?cId="+e.$store.state.iscId,data:i}).then(function(t){t.data.code&&"200"==t.data.code?(e.$message({message:"成功",type:"success"}),e.closeTag()):e.$message({message:t.data.msg,type:"error"}),e.isDisable=!1}).catch(function(t){e.$message.error("提交失败，请重新提交")})}},closeTag:function(){var e=this,t=void 0;this.$store.state.tagsList.forEach(function(a,l){a.name==e.$options.name&&(t=l)});var a=this.$store.state.tagsList.splice(t,1)[0];(this.$store.state.tagsList[t]?this.$store.state.tagsList[t]:this.$store.state.tagsList[t-1])?a.path===this.$route.fullPath&&this.$router.push("/examine"):this.$router.push("/index")}}}),d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addorupdatecontent"},[a("span",{staticClass:"marginSpan"},[e._v("新增"+e._s(e.myForm.category_name)+"审核")]),e._v(" "),a("el-form",{ref:"myForm",staticClass:"field_form_input",attrs:{model:e.myForm,inline:!0,rules:e.rules,"label-width":"130px"}},[e._l(e.previewData,function(t){return a("el-form-item",{key:t.id,attrs:{label:t.name,prop:t.field_name,"label-width":"130px"}},["text"==t.formType||"email"==t.formType?a("el-input",{staticStyle:{width:"30vw"},attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"textarea"==t.formType?a("el-input",{staticStyle:{width:"30vw"},attrs:{type:"textarea",maxlength:t.max_length,placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"number"==t.formType?a("el-input",{staticStyle:{width:"30vw"},attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"floatnumber"==t.formType||"budget"==t.formType||"amount"==t.formType?a("el-input",{staticStyle:{width:"30vw"},attrs:{onkeyup:"value=value.replace(/^\\D*(\\d*(?:\\.\\d{0,2})?).*$/g, '$1')",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"mobile"==t.formType?a("el-input",{staticStyle:{width:"30vw"},attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",maxlength:11,placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"select"==t.formType?a("el-select",{staticStyle:{width:"30vw"},attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(t.setting,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})):"checkbox"==t.formType?a("el-select",{staticStyle:{width:"30vw"},attrs:{multiple:"",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(t.setting,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})):"user"==t.formType?a("el-select",{staticStyle:{width:"30vw"},attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(e.userData,function(e){return a("el-option",{key:e.private_id,attrs:{label:e.private_employee,value:e.private_id}})})):"customer"==t.formType?a("el-select",{staticStyle:{width:"30vw"},attrs:{filterable:"",placeholder:t.input_tips},on:{change:function(a){e.handleChange(a,t)}},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(e.customerList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})):"structure"==t.formType?a("el-select",{staticClass:"noPadding_select",staticStyle:{width:"30vw"},attrs:{placeholder:t.input_tips},model:{value:t.displayVal,callback:function(a){e.$set(t,"displayVal",a)},expression:"item.displayVal"}},[a("el-option",{staticClass:"droplist nopadding_option",attrs:{value:t.displayVal}},[a("el-tree",{ref:"tree",refInFor:!0,attrs:{"node-key":"deptid","highlight-current":"","default-expand-all":"","expand-on-click-node":!1,data:e.deptData,props:e.defaultProps},on:{"node-click":function(a){e.handlecheck(a,t)}}})],1)],1):"date"==t.formType?a("el-date-picker",{staticStyle:{width:"30vw"},attrs:{type:"date",placeholder:t.input_tips,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"datetime"==t.formType?a("el-date-picker",{staticStyle:{width:"30vw"},attrs:{type:"datetime",placeholder:t.input_tips,format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"file"==t.formType?a("el-upload",{staticClass:"upload-demo",attrs:{action:e.doUpload,"on-success":e.uploadSuccess,"before-upload":e.beforeUpload}},[a("el-button",{attrs:{size:"mini",type:"info-btn"}},[e._v("上传")]),e._v(" "),a("div",{staticClass:"el-upload__tip",staticStyle:{"margin-top":"-20px"},attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(t.input_tips))])],1):e._e()],1)}),e._v(" "),a("br"),e._v(" "),a("el-form-item",{attrs:{prop:"image",label:"图片"}},[a("el-upload",{staticClass:"image-uploader",attrs:{action:e.doUpload,"show-file-list":!1,"on-success":e.imageuploadSuccess,"before-upload":e.beforeUpload}},[e.myForm.image?a("img",{staticClass:"image_avatar",attrs:{src:e.imageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",{attrs:{prop:"file",label:"附件"}},[a("el-upload",{staticClass:"upload-demo",attrs:{"file-list":e.fileList,action:e.doUpload,"on-success":e.fileuploadSuccess,"before-upload":e.beforeUpload}},[a("el-button",{attrs:{size:"mini",type:"info-btn"}},[e._v("上传")]),e._v(" "),a("div",{staticClass:"el-upload__tip",staticStyle:{"margin-top":"-20px"},attrs:{slot:"tip"},slot:"tip"},[e._v("文件大小不超过5Mb")])],1)],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",{attrs:{label:"制单人"}},[a("el-input",{staticStyle:{width:"30vw"},attrs:{disabled:""},model:{value:e.myForm.private_employee,callback:function(t){e.$set(e.myForm,"private_employee",t)},expression:"myForm.private_employee"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门"}},[a("el-input",{staticStyle:{width:"30vw"},attrs:{disabled:""},model:{value:e.myForm.deptname,callback:function(t){e.$set(e.myForm,"deptname",t)},expression:"myForm.deptname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"机构",disabled:""}},[a("el-input",{staticStyle:{width:"30vw"},model:{value:e.myForm.parentname,callback:function(t){e.$set(e.myForm,"parentname",t)},expression:"myForm.parentname"}})],1)],2),e._v(" "),a("div",{staticClass:"submit_btn"},[a("el-button",{staticStyle:{"margin-right":"50px !important"},attrs:{type:"primary",disabled:e.isDisable},on:{click:e.submit}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.closeTag}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var n=a("VU/8")(r,d,!1,function(e){a("ptt3"),a("htsr")},null,null);t.default=n.exports},ptt3:function(e,t){}});