webpackJsonp([55],{"8pcL":function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("wtEF"),i=e("mtWM"),l=e.n(i),n=e("9igS"),o=e("mw3O"),c=e.n(o),r={name:"visitplandetails",store:a.a,data:function(){return{msg:"拜访计划详情页",detailData:null,visitId:null,visitdetails:{},tableData:null,tableNumber:0,searchName:null,page:1,limit:20,thisshow:!0,retracts:!0,examineList:[],hasCheck:null,hasRecheck:null,examineLog:[],dialogVisibleexa:!1,exaform:{status:null,remarks:null},rules:{remarks:[{required:!0,message:"审核意见不能为空",trigger:"blur"}]},ratetexts:[2,4,6,8,10],dialogVisible:!1,auditing:this.$store.state.systemHttp+"/upload/staticImg/inaudit.png",audited:this.$store.state.systemHttp+"/upload/staticImg/examine.png",noaudit:this.$store.state.systemHttp+"/upload/staticImg/refuse.png"}},activated:function(){this.loadData(),this.loadTable(),this.reload()},beforeRouteLeave:function(t,s,e){n.a.$off("id"),e()},methods:{reload:function(){var t=this;n.a.$on("id",function(s){s&&(t.loadData(),t.loadTable())})},loadData:function(){var t=this;this.detailData=this.$store.state.visitdetailsData,this.visitId=this.detailData.submitData.id,l()({method:"get",url:t.$store.state.defaultHttp+"visit/selectVisitById.do?cId="+t.$store.state.iscId+"&id="+this.visitId}).then(function(s){t.visitdetails=s.data.map.visit,t.visitdetails.assistants=[],t.visitdetails.assistantsid=[],t.visitdetails.privateUser!==[]&&t.visitdetails.privateUser.forEach(function(s){t.visitdetails.assistants.push(s.private_name),t.visitdetails.assistantsid.push(s.private_id)}),t.visitdetails.photoCheck&&(t.visitdetails.photoName=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+t.visitdetails.photoCheck);var e={checkStatus:s.data.map.visit.checkStatus,recordId:s.data.map.visit.examineRecordId,pId:t.$store.state.ispId};l()({method:"post",url:t.$store.state.defaultHttp+"examineRecord/queryExamineRecordList.do?cId="+t.$store.state.iscId,data:c.a.stringify(e)}).then(function(s){t.examineList=s.data.steps,t.examineList.forEach(function(s,e){if(s.userLength=s.userList.length,1==s.userLength?s.type_style="width:50px;":2==s.userLength?s.type_style="width:75px;":3==s.userLength?s.type_style="width:100px;":4==s.userLength?s.type_style="width:125px;":5==s.userLength&&(s.type_style="width:150px;"),0==e&&(s.userList[0].img?s.headPortrait=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+s.userList[0].img:s.headPortrait=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg"),2==s.stepType)for(var a=0;a<s.userList.length;a++){if(s.userList[a].img&&0!==s.userList[a].examineStatus){s.headPortrait=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+s.userList[a].img;break}if(!s.userList[a].img&&0!==s.userList[a].examineStatus){s.headPortrait=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg";break}if(s.userList[a].img&&0==s.userList[a].examineStatus){s.headPortrait=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+s.userList[a].img;break}if(!s.userList[a].img&&0==s.userList[a].examineStatus){s.headPortrait=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg";break}}3==s.stepType&&s.userList.forEach(function(s,e){s.img?s.headPortrait=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+s.img:s.headPortrait=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg"})}),t.hasCheck=s.data.isCheck,t.hasRecheck=s.data.isRecheck}).catch(function(t){}),l()({method:"get",url:t.$store.state.defaultHttp+"examineLog/queryExamineLogList.do?cId="+t.$store.state.iscId+"&recordId="+t.visitdetails.examineRecordId}).then(function(s){t.examineLog=s.data}).catch(function(t){})}).catch(function(t){})},loadTable:function(){var t=this,s=e("1nuA"),a={};a.searchName=this.searchName,a.page=this.page,a.limit=this.limit,l()({method:"post",url:t.$store.state.defaultHttp+"visit/selectVisit.do?cId="+t.$store.state.iscId+"&pId="+this.$store.state.ispId,data:s.stringify(a)}).then(function(s){var e=s.data.map.success;t.tableData=e,t.tableNumber=s.data.count}).catch(function(t){})},getTime:function(){this.$store.commit("getNowTime")},getRow:function(t,s){this.$store.state.visitdetailsData.submitData={id:s.id},this.$options.methods.loadData.bind(this)(!0)},retract:function(){this.retracts=!this.retracts,this.thisshow=!this.thisshow},showexamine:function(t){this.exaform.status=t,this.dialogVisibleexa=!0},toexamine:function(){var t=this,s=e("1nuA"),a={};a.id=this.visitId,a.recordId=this.visitdetails.examineRecordId,a.pId=this.$store.state.ispId,a.status=this.exaform.status,a.remarks=this.exaform.remarks;var i=!1;a.remarks||(t.$message({message:"审核意见不能为空",type:"error"}),i=!0),i||l()({method:"post",url:t.$store.state.defaultHttp+"examineRecord/auditExamine.do?cId="+t.$store.state.iscId,data:s.stringify(a)}).then(function(s){s.data.code&&"200"==s.data.code?(t.$message({message:"操作成功",type:"success"}),t.dialogVisibleexa=!1,t.exaform.status=null,t.exaform.remarks=null,t.$options.methods.loadData.bind(t)()):t.$message({message:s.data.msg,type:"error"})}).catch(function(s){t.$message.error("审核失败，请稍后再试")})},clickRates:function(t){var s=this,a=e("1nuA"),i={};i.id=this.visitId,i.customerpoolid=this.visitdetails.customerpoolid,i.customerName=this.visitdetails.customerName,i.score=t,"已完成"!==this.visitdetails.state?(s.$message({message:"该拜访计划非完成状态，暂不可评分",type:"error"}),s.visitdetails.score=0):l()({method:"post",url:s.$store.state.defaultHttp+"visit/updateVisitState.do?cId="+s.$store.state.iscId,data:a.stringify(i)}).then(function(t){t.data.code&&200==t.data.code?(s.$message({message:"评分成功",type:"success"}),s.$options.methods.loadData.bind(s)(!0)):s.$message({message:t.data.msg,type:"error"})}).catch(function(t){s.$message.error("评分失败,请重新评分")})},showImg:function(){this.dialogVisible=!0},search:function(){this.$options.methods.loadTable.bind(this)(!0)},handleSizeChange:function(t){this.limit=t,this.$options.methods.loadTable.bind(this)(!1)},handleCurrentChange:function(t){this.page=t,this.$options.methods.loadTable.bind(this)(!1)}}},d={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("el-row",{staticClass:"visitdetcontent",attrs:{gutter:10}},[e("el-col",{attrs:{span:18}},[e("div",{staticClass:"top"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",{staticClass:"bold_span"},[t._v(t._s(t.visitdetails.customerName))]),t._v(" "),e("span",{staticStyle:{"margin-left":"50px"}},[t._v(t._s(t.visitdetails.contactsName))]),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.retracts,expression:"retracts"}],staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:function(s){t.retract()}}},[t._v("收起")]),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.retracts,expression:"!retracts"}],staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:function(s){t.retract()}}},[t._v("显示")])],1),t._v(" "),e("div",{staticClass:"text item"},[e("ul",[e("li",[t._v("拜访对象："),e("span",[t._v(t._s(t.visitdetails.contactsName))])]),t._v(" "),e("li",{staticStyle:{flex:"0 0 50%"}},[t._v("联系电话："),e("span",[t._v(t._s(t.visitdetails.phone))])])]),t._v(" "),e("div",{staticClass:"item_body"},[t._v("拜访主题："),e("span",[t._v(t._s(t.visitdetails.visitTheme))])]),t._v(" "),e("div",{staticClass:"item_body"},[t._v("拜访目的："),e("span",[t._v(t._s(t.visitdetails.visitObjective))])]),t._v(" "),e("p",[t._v(" ")]),t._v(" "),1==t.visitdetails.checkStatus?e("div",{staticClass:"visitaudited"},[e("img",{staticClass:"audited_img",attrs:{src:t.auditing,alt:"审核中"}})]):t._e(),t._v(" "),2==t.visitdetails.checkStatus?e("div",{staticClass:"visitaudited"},[e("img",{staticClass:"audited_img",attrs:{src:t.audited,alt:"已审核"}})]):t._e(),t._v(" "),3==t.visitdetails.checkStatus?e("div",{staticClass:"visitaudited"},[e("img",{staticClass:"audited_img",attrs:{src:t.noaudit,alt:"未通过"}})]):t._e()])])],1),t._v(" "),e("div",{staticClass:"top"},[e("el-card",{staticClass:"box-card",model:{value:t.visitdetails,callback:function(s){t.visitdetails=s},expression:"visitdetails"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("el-popover",{attrs:{placement:"right-start",width:"220",trigger:"click"}},[e("div",{staticStyle:{"max-height":"400px","overflow-y":"overlay"}},t._l(t.examineLog,function(s,a){return e("div",{key:a,staticClass:"examine_popover"},[e("span",{staticClass:"examine_ico"},[0==s.examineStatus?e("i",{staticClass:"el-icon-time",staticStyle:{"font-size":"20px"}}):t._e(),t._v(" "),1==s.examineStatus?e("i",{staticClass:"el-icon-circle-check-outline",staticStyle:{color:"#67c23a","font-size":"20px"}}):t._e(),t._v(" "),2==s.examineStatus?e("i",{staticClass:"el-icon-circle-close-outline",staticStyle:{color:"#f56c6c","font-size":"20px"}}):t._e(),t._v(" "),3==s.examineStatus?e("i",{staticClass:"el-icon-time",staticStyle:{color:"#e6a23c","font-size":"20px"}}):t._e(),t._v(" "),5==s.examineStatus?e("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{color:"#67c23a","font-size":"20px"}}):t._e()]),t._v(" "),e("div",{staticClass:"examint_msg"},[e("p",{staticStyle:{"font-size":"13px",color:"#aaaaaa"}},[t._v(t._s(s.examineTime))]),t._v(" "),1==s.examineStatus?e("p",[t._v(t._s(s.realname+" 已审核"))]):t._e(),t._v(" "),2==s.examineStatus?e("p",[t._v(t._s(s.realname+" 已拒绝"))]):t._e(),t._v(" "),e("div",{staticClass:"examint_remark"},[e("p",[t._v(t._s(s.remarks))])])])])})),t._v(" "),e("span",{staticStyle:{"font-size":"14px","text-decoration":"underline"},attrs:{slot:"reference"},slot:"reference"},[t._v("查看审核历史")])]),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasCheck&&2!==t.visitdetails.checkStatus,expression:"hasCheck && visitdetails.checkStatus !== 2"}],staticClass:"info-btn",staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(s){t.showexamine(1)}}},[t._v("通过")]),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasCheck&&2!==t.visitdetails.checkStatus,expression:"hasCheck && visitdetails.checkStatus !== 2"}],staticClass:"info-btn",staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(s){t.showexamine(2)}}},[t._v("拒绝")]),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasCheck,expression:"hasCheck"}],staticClass:"info-btn",staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(s){t.showexamine(4)}}},[t._v("驳回")])],1),t._v(" "),e("div",{staticClass:"text item"},[e("div",{staticClass:"examine_c"},t._l(t.examineList,function(s,a){return e("div",{key:a,staticClass:"examine_item"},[e("el-popover",{staticClass:"examine_cont",attrs:{placement:"bottom",width:"220",trigger:"hover"}},[t._l(s.userList,function(s,a){return e("div",{key:a,staticClass:"examine_popover"},[e("span",{staticClass:"examine_ico"},[0==s.examineStatus?e("i",{staticClass:"el-icon-time",staticStyle:{"font-size":"20px"}}):t._e(),t._v(" "),1==s.examineStatus?e("i",{staticClass:"el-icon-success",staticStyle:{color:"#67c23a","font-size":"18px"}}):t._e(),t._v(" "),2==s.examineStatus?e("i",{staticClass:"el-icon-circle-close",staticStyle:{color:"#f56c6c","font-size":"20px"}}):t._e(),t._v(" "),3==s.examineStatus?e("i",{staticClass:"el-icon-time",staticStyle:{color:"#e6a23c","font-size":"20px"}}):t._e(),t._v(" "),5==s.examineStatus?e("i",{staticClass:"el-icon-circle-plus",staticStyle:{color:"#67c23a","font-size":"20px"}}):t._e()]),t._v(" "),e("div",{staticClass:"examint_msg"},[e("p",{staticStyle:{"font-size":"13px",color:"#aaaaaa"}},[t._v(t._s(s.examineTime))]),t._v(" "),e("span",[t._v(t._s(s.realname+"("+s.phone+")"))]),t._v(" "),0==s.examineStatus?e("p",[t._v("未审核此申请")]):t._e(),t._v(" "),1==s.examineStatus?e("p",[t._v("通过此申请")]):t._e(),t._v(" "),2==s.examineStatus?e("p",[t._v("拒绝此申请")]):t._e(),t._v(" "),5==s.examineStatus?e("p",[t._v("创建此申请")]):t._e()])])}),t._v(" "),e("div",{staticStyle:{width:"100%"},attrs:{slot:"reference"},slot:"reference"},[5==s.examineStatus||4==s.examineStatus?e("span",{staticClass:"examine_po"},[e("img",{staticClass:"examine_img",attrs:{src:s.headPortrait,width:"50",height:"50"}})]):t._e(),t._v(" "),2==s.stepType?e("span",{staticClass:"examine_po1"},[e("img",{staticClass:"examine_img",class:{mohu:1!==s.examineStatus},attrs:{src:s.headPortrait,width:"50",height:"50"}})]):t._e(),t._v(" "),3==s.stepType?e("div",{staticStyle:{display:"inline-block",margin:"0 15px"},style:s.type_style},t._l(s.userList,function(t,s){return e("span",{key:s,staticClass:"examine_po2"},[e("img",{staticClass:"examine_img",class:{mohu:0==t.examineStatus},attrs:{src:t.headPortrait,width:"50",height:"50"}})])})):t._e(),t._v(" "),e("br"),t._v(" "),s.examineUserName?e("span",{staticClass:"examine_type"},[t._v(t._s(s.examineUserName))]):t._e(),t._v(" "),2==s.stepType?e("span",{staticClass:"examine_type"},[t._v(t._s(s.userLength+"人或签"))]):t._e(),t._v(" "),3==s.stepType?e("span",{staticClass:"examine_type"},[t._v(t._s(s.userLength+"人会签"))]):t._e(),t._v(" "),e("br"),t._v(" "),0==s.examineStatus&&1==a?e("span",{staticClass:"examine_status"},[t._v("一级审核")]):t._e(),t._v(" "),0==s.examineStatus&&2==a?e("span",{staticClass:"examine_status"},[t._v("二级审核")]):t._e(),t._v(" "),0==s.examineStatus&&3==a?e("span",{staticClass:"examine_status"},[t._v("三级审核")]):t._e(),t._v(" "),0==s.examineStatus&&4==a?e("span",{staticClass:"examine_status"},[t._v("四级审核")]):t._e(),t._v(" "),0==s.examineStatus&&5==a?e("span",{staticClass:"examine_status"},[t._v("五级审核")]):t._e(),t._v(" "),0==s.examineStatus&&6==a?e("span",{staticClass:"examine_status"},[t._v("六级审核")]):t._e(),t._v(" "),1==s.examineStatus?e("span",{staticClass:"examine_status"},[e("i",{staticClass:"el-icon-success",staticStyle:{color:"#67c23a","font-size":"15px"}}),t._v(" 已审核")]):t._e(),t._v(" "),2==s.examineStatus?e("span",{staticClass:"examine_status"},[e("i",{staticClass:"el-icon-circle-close",staticStyle:{color:"#f56c6c","font-size":"18px"}}),t._v(" 未通过")]):t._e(),t._v(" "),3==s.examineStatus?e("span",{staticClass:"examine_status"},[e("i",{staticClass:"el-icon-time",staticStyle:{color:"#e6a23c","font-size":"18px"}}),t._v(" 审核中")]):t._e(),t._v(" "),5==s.examineStatus?e("span",{staticClass:"examine_status"},[e("i",{staticClass:"el-icon-circle-plus",staticStyle:{color:"#67c23a","font-size":"18px"}}),t._v(" 发起")]):t._e()])],2),t._v(" "),a!==t.examineList.length-1?e("span",{staticClass:"examine_next"},[e("i",{staticClass:"el-icon-arrow-right"})]):t._e()],1)}))])])],1),t._v(" "),t.thisshow?e("div",{staticClass:"top"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("基本信息")])]),t._v(" "),e("div",{staticClass:"text item"},[e("ul",[e("li",[t._v("拜访时间："),e("span",[t._v(t._s(t.visitdetails.visitTime))])]),t._v(" "),e("li",[t._v("结束时间："),e("span",[t._v(t._s(t.visitdetails.endTime))])]),t._v(" "),e("li"),t._v(" "),e("li",[t._v("协助人员："),t._l(t.visitdetails.assistants,function(s,a){return e("span",{key:a},[t._v(t._s(s)+" , ")])})],2),t._v(" "),e("li",[t._v("审核人："),e("span",[t._v(t._s(t.visitdetails.approver))])]),t._v(" "),e("li",[t._v("审核状态："),e("span",[t._v(t._s(t.visitdetails.approver))])]),t._v(" "),e("li",[t._v("负责人："),e("span",[t._v(t._s(t.visitdetails.private_employee))])]),t._v(" "),e("li",[t._v("部门："),e("span",[t._v(t._s(t.visitdetails.deptname))])]),t._v(" "),e("li",[t._v("机构："),e("span",[t._v(t._s(t.visitdetails.parentname))])])])])])],1):t._e(),t._v(" "),e("div",{staticClass:"top"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("执行结果")])]),t._v(" "),e("div",{staticClass:"text item"},[e("ul",[e("li",[t._v("执行状况："),e("span",[t._v(t._s(t.visitdetails.state))])]),t._v(" "),e("li",{staticStyle:{flex:"0 0 66%"}},[t._v("完成时间："),e("span",[t._v(t._s(t.visitdetails.endTime))])]),t._v(" "),e("li",[t._v("签到时间："),e("span",[t._v(t._s(t.visitdetails.timeCheck))])]),t._v(" "),e("li",{staticStyle:{flex:"0 0 66%"}},[t._v("签到地址："),e("span",[t._v(t._s(t.visitdetails.addressCheck))])]),t._v(" "),e("li",[t._v("图片：\n                            "),t.visitdetails.photoCheck?e("div",{staticClass:"imgbox"},[e("img",{attrs:{src:t.visitdetails.photoName},on:{click:t.showImg}})]):t._e(),t._v(" "),e("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(s){t.dialogVisible=s}}},[e("img",{attrs:{width:"100%",src:t.visitdetails.photoName,alt:""}})])],1)]),t._v(" "),e("p",[t._v(" ")])])])],1),t._v(" "),e("div",{staticClass:"top"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"rate_box"},[e("span",{staticClass:"rate_text"},[t._v("打分")]),t._v(" "),e("el-rate",{staticClass:"rate_star",attrs:{"show-text":"",texts:t.ratetexts},on:{change:t.clickRates},model:{value:t.visitdetails.score,callback:function(s){t.$set(t.visitdetails,"score",s)},expression:"visitdetails.score"}})],1)])],1)]),t._v(" "),e("el-col",{staticClass:"right",staticStyle:{padding:"10px"},attrs:{span:6}},[e("div",{staticClass:"searchList",staticStyle:{width:"100%"}},[e("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入公司名称"},nativeOn:{keyup:function(s){return"button"in s||!t._k(s.keyCode,"enter",13,s.key,"Enter")?t.search(s):null}},model:{value:t.searchName,callback:function(s){t.searchName=s},expression:"searchName"}}),t._v(" "),e("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"mini"},on:{click:function(s){t.search()}}})],1),t._v(" "),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[e("el-table-column",{attrs:{prop:"customerName",label:"公司名称"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{on:{click:function(e){t.getRow(s.$index,s.row)}}},[t._v("\n                    "+t._s(s.row.customerName)+"\n                ")])]}}])})],1),t._v(" "),e("div",{staticClass:"block numberPage number"},[e("el-pagination",{attrs:{"current-page":t.page,"page-sizes":[20,30,50,100],"page-size":20,layout:"total, sizes, prev, next",total:t.tableNumber},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),e("el-dialog",{attrs:{title:"审核意见",visible:t.dialogVisibleexa,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(s){t.dialogVisibleexa=s}}},[e("el-form",{ref:"exaform",attrs:{model:t.exaform,rules:t.rules}},[e("el-form-item",{attrs:{prop:"remarks"}},[e("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入审核意见（必填）"},model:{value:t.exaform.remarks,callback:function(s){t.$set(t.exaform,"remarks",s)},expression:"exaform.remarks"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.dialogVisibleexa=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(s){t.toexamine()}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var v=e("VU/8")(r,d,!1,function(t){e("NfQO")},null,null);s.default=v.exports},NfQO:function(t,s){}});