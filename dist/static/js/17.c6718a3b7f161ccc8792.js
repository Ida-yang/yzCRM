webpackJsonp([17],{NI8N:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("wtEF"),i=a("mtWM"),n=a.n(i),o=(a("mw3O"),{name:"missionplan",store:s.a,computed:{tableData:function(){return s.a.state.missionplanList},tableNumber:function(){return s.a.state.missionplanListnumber}},data:function(){return{msg:"任务",btnList:[{id:"1",name:"未完成"},{id:"2",name:"已完成"},{id:"3",name:"作废"}],progress:"",completed:"",nullify:"",idArr:{id:null},state:"未完成",filterList:null,checklist:null,searchList:{label:"1",time:null,state:"未完成"},pIdData:[{id:"0",name:"全部"},{id:"1",name:"我的"},{id:"2",name:"本组"},{id:"3",name:"本机构"}],timeData:[{id:"2",name:"今天"},{id:"1",name:"昨天"},{id:"5",name:"明天"},{id:"3",name:"本周"},{id:"6",name:"本月"},{id:"7",name:"上月"},{id:"8",name:"下月"}],stateData:[{id:"1",name:"未完成"},{id:"2",name:"已完成"},{id:"3",name:"作废"}],nullvalue:null,page:1,limit:15,searchName:null}},mounted:function(){this.reloadTable(),this.reloadData()},activated:function(){this.reloadTable()},methods:{reloadTable:function(){var e=this,t=a("1nuA"),s={};0==this.searchList.label?s.pId=e.nullvalue:1==this.searchList.label?s.pId=e.$store.state.ispId:2==this.searchList.label?s.secondid=e.$store.state.deptid:3==this.searchList.label?s.deptid=e.$store.state.insid:s.pId=e.$store.state.ispId,this.searchList.state!==this.nullvalue&&(s.state=this.searchList.state),s.page=this.page,s.limit=this.limit,s.example=this.searchList.time,s.searchName=this.searchName,n()({method:"post",url:e.$store.state.defaultHttp+"workPlan/selectWorkPlan.do?cId="+e.$store.state.iscId,data:t.stringify(s)}).then(function(t){var a=t.data.map.success;e.$store.state.missionplanList=a,e.$store.state.missionplanListnumber=t.data.count,a.forEach(function(e){var t=Date.parse(e.updateTime),a=(new Date).getTime()-t;"未完成"==e.state||""==e.state?(e.progress="info",e.completed="",e.nullify=""):"已完成"==e.state?(e.progress="",e.completed="success",e.nullify="",a>72e5&&(e.progressBtn=!0,e.nullifyBtn=!0,e.editBtn=!0,e.deleteBtn=!0)):(e.progress="",e.completed="",e.nullify="danger",e.completedBtn=!0,e.editBtn=!0)})}).catch(function(e){})},reloadData:function(){var e=this,t=a("1nuA"),s={type:"工作计划"},i={type:"工作计划",state:1};n()({method:"post",url:e.$store.state.defaultHttp+"userPageInfo/getAllUserPage.do?cId="+e.$store.state.iscId+"&pId="+e.$store.state.ispId,data:t.stringify(s)}).then(function(t){e.filterList=t.data}).catch(function(e){}),n()({method:"post",url:e.$store.state.defaultHttp+"userPageInfo/getUserPage.do?cId="+e.$store.state.iscId+"&pId="+e.$store.state.ispId,data:t.stringify(i)}).then(function(t){e.checklist=t.data}).catch(function(e){})},selectInfo:function(e){var t=e,a=[new Array];t.forEach(function(e){0!=e.id&&a.push(e.id)}),this.idArr.id=a},getTime:function(){this.$store.commit("getNowTime")},changeState:function(e,t){this.getTime();var s=this,i=a("1nuA"),o={};o.id=t.id,o.state=e.target.innerText,o.updateTime=this.$store.state.nowtime,n()({method:"post",url:s.$store.state.defaultHttp+"workPlan/updateWorkPlan.do?cId="+s.$store.state.iscId+"&pId="+this.$store.state.ispId,data:i.stringify(o)}).then(function(e){e.data.code&&200==e.data.code?(s.$message({message:"修改成功",type:"success"}),s.$options.methods.reloadTable.bind(s)(!0)):s.$message({message:e.data.msg,type:"error"})}).catch(function(e){s.$message.error("操作失败,请重新操作")})},handleAdd:function(){var e=this,t={createForm:[{label:"任务主题",inputModel:"planningTheme"},{label:"关联客户",inputModel:"customerName",type:"require"},{label:"开始时间",inputModel:"startTime",type:"date"},{label:"结束时间",inputModel:"endTime",type:"date"},{label:"提醒时间",inputModel:"remindTime",type:"date"},{label:"描述",inputModel:"describe",type:"textarea"}],setForm:{planningTheme:"",describe:"",startTime:"",endTime:"",remindTime:"",customerName:""}};t.submitURL=this.$store.state.defaultHttp+"workPlan/insertWorkPlan.do?cId="+this.$store.state.iscId+"&pId="+this.$store.state.ispId,this.$store.state.missionaddOrUpdateData=t,n()({method:"get",url:e.$store.state.defaultHttp+"workPlanJurisdiction/insert.do"}).then(function(t){t.data.msg&&"error"==t.data.msg?e.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):e.$router.push({path:"/missionplanaddorupdate"})}).catch(function(e){})},handleEdit:function(e,t){var a=this,s={createForm:[{label:"任务主题",inputModel:"planningTheme"},{label:"关联客户",inputModel:"customerName",type:"require"},{label:"开始时间",inputModel:"startTime",type:"date"},{label:"结束时间",inputModel:"endTime",type:"date"},{label:"提醒时间",inputModel:"remindTime",type:"date"},{label:"描述",inputModel:"describe",type:"textarea"}]};s.setForm={planningTheme:t.planningTheme,describe:t.describe,startTime:t.startTime,endTime:t.endTime,remindTime:t.remindTime,customerId:t.customerId,customerName:t.customerName},s.submitData={id:t.id},s.submitURL=this.$store.state.defaultHttp+"workPlan/updateWorkPlan.do?cId="+this.$store.state.iscId+"&pId="+this.$store.state.ispId,this.$store.state.missionaddOrUpdateData=s,n()({method:"get",url:a.$store.state.defaultHttp+"workPlanJurisdiction/update.do"}).then(function(e){e.data.msg&&"error"==e.data.msg?a.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):a.$router.push({path:"/missionplanaddorupdate"})}).catch(function(e){})},handledelete:function(e,t){var s=this,i=this,o=a("1nuA"),r=[];r.id=t.id,i.$confirm("是否确认删除["+t.planningTheme+"]？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){e.value;n()({method:"post",url:i.$store.state.defaultHttp+"workPlan/deleteWorkPlan.do?cId="+i.$store.state.iscId,data:o.stringify(r)}).then(function(e){e.data.code&&200==e.data.code?(i.$message({message:"删除成功",type:"success"}),i.$options.methods.reloadTable.bind(i)(!0)):e.data.msg&&"error"==e.data.msg?i.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):i.$message({message:e.data.msg,type:"error"})}).catch(function(e){i.$message.error("删除失败,请重新删除")})}).catch(function(){s.$message({type:"info",message:"取消删除["+t.planningTheme+"]"})})},hangleChange:function(e,t){var s=this,i=a("1nuA"),o={};o.pageInfoId=t.pageInfoId,o.state=1==e?1:0,n()({method:"post",url:s.$store.state.defaultHttp+"userPageInfo/updateUserPageByid.do?cId="+s.$store.state.iscId+"&pId="+s.$store.state.ispId,data:i.stringify(o)}).then(function(e){e.data&&"success"==e.data&&s.$options.methods.reloadData.bind(s)(!0)}).catch(function(e){})},search:function(){var e=this,t="",a=1;0==this.searchList.label?(t="workPlanJurisdiction/all.do",a=0):2==this.searchList.label?(t="workPlanJurisdiction/second.do",a=0):3==this.searchList.label&&(t="workPlanJurisdiction/dept.do",a=0),0==a?n()({method:"get",url:e.$store.state.defaultHttp+t}).then(function(t){t.data.msg&&"error"==t.data.msg?e.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):e.$options.methods.reloadTable.bind(e)(!0)}).catch(function(e){}):e.$options.methods.reloadTable.bind(e)(!0)},handleSizeChange:function(e){this.limit=e,this.$options.methods.reloadTable.bind(this)(!0)},handleCurrentChange:function(e){this.page=e,this.$options.methods.reloadTable.bind(this)(!0)}}}),r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"radioList"},[a("el-radio-group",{model:{value:e.searchList.label,callback:function(t){e.$set(e.searchList,"label",t)},expression:"searchList.label"}},[a("span",{staticClass:"nameList"},[e._v("数据授权：")]),e._v(" "),e._l(e.pIdData,function(t){return a("el-radio",{key:t.id,attrs:{label:t.id},on:{change:function(t){e.search()}}},[e._v(e._s(t.name))])})],2),e._v(" "),a("el-radio-group",{model:{value:e.searchList.time,callback:function(t){e.$set(e.searchList,"time",t)},expression:"searchList.time"}},[a("span",{staticClass:"nameList"},[e._v("任务时间：")]),e._v(" "),a("el-radio",{attrs:{label:e.nullvalue},on:{change:function(t){e.search()}}},[e._v("全部")]),e._v(" "),e._l(e.timeData,function(t){return a("el-radio",{key:t.id,attrs:{label:t.id},on:{change:function(t){e.search()}}},[e._v(e._s(t.name))])})],2),e._v(" "),a("el-radio-group",{model:{value:e.searchList.state,callback:function(t){e.$set(e.searchList,"state",t)},expression:"searchList.state"}},[a("span",{staticClass:"nameList"},[e._v("任务状态：")]),e._v(" "),a("el-radio",{attrs:{label:e.nullvalue},on:{change:function(t){e.search()}}},[e._v("全部")]),e._v(" "),e._l(e.stateData,function(t){return a("el-radio",{key:t.id,attrs:{label:t.name},on:{change:function(t){e.search()}}},[e._v(e._s(t.name))])})],2)],1),e._v(" "),a("div",{staticClass:"searchList"},[a("span",{staticClass:"nameList"},[e._v("公司名称：")]),e._v(" "),a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入公司名称"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.search(t):null}},model:{value:e.searchList.searchName,callback:function(t){e.$set(e.searchList,"searchName",t)},expression:"searchList.searchName"}}),e._v("\n          \n        "),a("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"mini"},on:{click:function(t){e.search()}}},[e._v("查询")])],1),e._v(" "),a("div",{staticClass:"entry"},[a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini"},on:{click:function(t){e.handleAdd()}}},[e._v("新增")]),e._v(" "),a("div",{staticClass:"totalnum_head"},[e._v("共 "),a("span",{staticClass:"bold_span"},[e._v(e._s(e.tableNumber))]),e._v(" 条")]),e._v(" "),a("el-popover",{attrs:{placement:"bottom",width:"100",trigger:"click"}},[a("el-checkbox-group",{staticClass:"checklist",staticStyle:{"max-height":"600px","overflow-y":"overlay","overflow-x":"hidden"},model:{value:e.checklist,callback:function(t){e.checklist=t},expression:"checklist"}},e._l(e.filterList,function(t){return a("el-checkbox",{key:t.id,staticClass:"checkone",attrs:{label:t.name,value:t.state},on:{change:function(a){e.hangleChange(a,t)}}})})),e._v(" "),a("el-button",{staticClass:"info-btn screen",attrs:{slot:"reference",icon:"el-icon-more",type:"mini"},slot:"reference"})],1)],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""},on:{"selection-change":e.selectInfo}},[a("el-table-column",{attrs:{fixed:"","header-align":"center",align:"center",type:"selection",width:"45",prop:"id",sortable:""},on:{"selection-change":e.selectInfo}}),e._v(" "),e._l(e.filterList,function(t,s){return a("div",{key:s},["planningTheme"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"主题",prop:"id",fixed:"","min-width":"350",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"visit_info"},[a("span",{staticClass:"visit_theme mission_customer"},[e._v(e._s(t.row.planningTheme))])]),e._v(" "),a("div",{staticClass:"visit_info"},[e._v(e._s(t.row.describe))])]}}])}):e._e(),e._v(" "),"startTime"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"时间",prop:"startTime","show-overflow-tooltip":"","min-width":"150",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("p",[e._v(e._s(t.row.startTime))]),e._v(" "),a("p",[e._v(e._s(t.row.endTime))])])]}}])}):e._e(),e._v(" "),"relationObject"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"关联客户",prop:"customerName","min-width":"200",sortable:""}}):e._e(),e._v(" "),"state"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"状态",prop:"state","min-width":"220",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button-group",[a("el-button",{attrs:{size:"mini",plain:"",disabled:t.row.progressBtn,type:t.row.progress},on:{click:function(a){e.changeState(a,t.row)}}},[e._v("未完成")]),e._v(" "),a("el-button",{attrs:{size:"mini",plain:"",disabled:t.row.completedBtn,type:t.row.completed},on:{click:function(a){e.changeState(a,t.row)}}},[e._v("已完成")]),e._v(" "),a("el-button",{attrs:{size:"mini",plain:"",disabled:t.row.nullifyBtn,type:t.row.nullify},on:{click:function(a){e.changeState(a,t.row)}}},[e._v("作废")])],1)]}}])}):e._e(),e._v(" "),"remindTime"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"提醒时间",prop:"remindTime","min-width":"150",sortable:""}}):e._e(),e._v(" "),"private_employee"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"负责人",prop:"private_employee","min-width":"100",sortable:""}}):e._e(),e._v(" "),"deptname"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"部门",prop:"deptname","min-width":"110",sortable:""}}):e._e(),e._v(" "),"parentname"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"机构",prop:"parentname","show-overflow-tooltip":"","min-width":"110",sortable:""}}):e._e()],1)}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",disabled:t.row.editBtn},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger",disabled:t.row.deleteBtn},on:{click:function(a){e.handledelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],2),e._v(" "),a("div",{staticClass:"block numberPage"},[a("el-pagination",{attrs:{"current-page":e.page,"page-sizes":[20,50,100,500],"page-size":20,layout:"total, sizes, prev, pager, next, jumper",total:e.tableNumber},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var l=a("VU/8")(o,r,!1,function(e){a("RJNp")},null,null);t.default=l.exports},RJNp:function(e,t){}});