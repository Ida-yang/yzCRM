webpackJsonp([38],{MuPd:function(e,t){},QdUB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("wtEF"),a("NYxO");var l=a("mtWM"),o=a.n(l),i=(a("9igS"),{name:"agreementaddorupdate",data:function(){return{activeName:"first",agreeaddOrUpdateData:{},myForm:{start_date:null,end_date:null,customerpool_id:null,signatories:null,orderId:null},subData:{},oppoptions:null,contactslist:null,our_signatoriesId:null,page:1,limit:15,rules:{our_signatories:[{required:!0,message:"我方签约人不能为空",trigger:"blur"}],signatories:[{required:!0,message:"客户签约人不能为空",trigger:"blur"}],end_date:[{required:!0,message:"合同结束时间不能为空",trigger:"blur"}],start_date:[{required:!0,message:"合同开始时间不能为空",trigger:"blur"}],amount:[{required:!0,message:"合同金额不能为空",trigger:"blur"}],customerpool_id:[{required:!0,message:"客户不能为空",trigger:"blur"}],contract_type:[{required:!0,message:"合同类型不能为空",trigger:"blur"}],contract_name:[{required:!0,message:"合同名称不能为空",trigger:"blur"}]},tableData:null,formid:null,searchvalue:null,isDisable:!1,fieldsform:{},previewData:[],deptData:[],defaultProps:{label:"deptname",children:"next"},userData:[],doUpload:this.$store.state.defaultHttp+"workOrder/upload.do?cId="+this.$store.state.iscId}},mounted:function(){this.loadData(),this.loadTable(),this.loadOpp(),this.loadfield(),this.loadUserandDept()},methods:{loadData:function(){var e=this;this.agreeaddOrUpdateData=this.$store.state.agreeaddOrUpdateData,this.oppoptions=this.$store.state.agreeaddOrUpdateData.customerpool_id,this.our_signatoriesId=this.agreeaddOrUpdateData.setForm.our_signatoriesId;var t=this.agreeaddOrUpdateData.createForm,a=this.agreeaddOrUpdateData.setForm;a&&(t.forEach(function(t,l){t.type&&"select"==t.type?e.$set(e.myForm,t.inputModel,a[t.inputModel]):t.type&&"radio"==t.type?e.$set(e.myForm,t.inputModel,a[t.inputModel]):e.myForm[t.inputModel]=a[t.inputModel]}),this.myForm.customerpool_id=this.agreeaddOrUpdateData.setForm.poolName,this.formid=this.agreeaddOrUpdateData.setForm.customerpool_id,this.myForm.opportunity_id=this.agreeaddOrUpdateData.setForm.opportunity_name,this.$emit("input",this.myForm))},loadOpp:function(){var e=this,t=a("1nuA"),l={};l.customerpool_id=this.formid,o()({method:"post",url:e.$store.state.defaultHttp+"opportunity/getOpportunityAll.do?cId="+e.$store.state.iscId,data:t.stringify(l)}).then(function(t){e.oppoptions=t.data}).catch(function(e){}),o()({method:"post",url:e.$store.state.defaultHttp+"getPoolContactsName.do?cId="+e.$store.state.iscId,data:t.stringify(l)}).then(function(t){e.contactslist=t.data.map.success,e.contactslist.forEach(function(t){e.myForm.signatories==t.name&&(e.myForm.signatories=t.id)})}).catch(function(e){})},loadfield:function(){var e=this,t=a("1nuA"),l=null,i=null;this.agreeaddOrUpdateData.submitData&&(l=this.agreeaddOrUpdateData.submitData.id,i=this.agreeaddOrUpdateData.submitData.batch_id);var s={label:6,id:l,batch_id:i};o()({method:"post",url:e.$store.state.defaultHttp+"field/queryField.do?cId="+e.$store.state.iscId,data:t.stringify(s)}).then(function(t){var a=t.data;a.forEach(function(t,a){t.displayVal="",e.agreeaddOrUpdateData.submitData?(t.default_value=t.value,"user"!=t.formType&&"structure"!=t.formType||(t.displayVal=t.deptOrUserName,t.default_value=parseInt(t.value))):"checkbox"!==t.formType&&null!==t.value&&(t.default_value=t.value),1==t.is_null&&(e.rules[t.field_name]=[{required:!0,message:" ",trigger:"blur"}])}),e.previewData=a}).catch(function(e){})},loadUserandDept:function(){var e=this,t=a("1nuA"),l={page:1,limit:"9999"};o()({method:"post",url:e.$store.state.defaultHttp+"getPrivateUserAll.do?cId="+e.$store.state.iscId,data:t.stringify(l)}).then(function(t){e.userData=t.data.map.success}).catch(function(e){}),o()({method:"get",url:e.$store.state.defaultHttp+"dept/getDeptNodeTree.do?cId="+e.$store.state.iscId}).then(function(t){e.deptData=t.data.map.success}).catch(function(e){})},loadTable:function(){var e=this,t=a("1nuA"),l={};l.page=this.page,l.limit=this.limit,l.pId=this.$store.state.ispId,l.searchName=this.searchvalue,o()({method:"post",url:e.$store.state.defaultHttp+"rightPoolName.do?cId="+e.$store.state.iscId,data:t.stringify(l)}).then(function(t){e.tableData=t.data.map.success.customerpools}).catch(function(e){})},handleInput:function(e,t){this.myForm[t]=e},handlechange:function(e,t){this.myForm[t]=e;var a=e.split("-"),l=parseInt(a[0])+1,o=a[1],i=a[2];this.myForm.end_date=l+"-"+o+"-"+i},getRow:function(e,t){this.formid=t.id,this.myForm.customerpool_id=t.name,this.loadOpp()},handleoninput:function(e,t){this.myForm[t]=e,this.searchvalue=e,this.loadTable()},handleblur:function(e,t){var a=this,l=e.target.value;this.tableData.forEach(function(e){l==e.name&&(a.formid=e.id,a.loadOpp())})},handleopp:function(e,t){var a=this;this.oppoptions.forEach(function(t){e==t.opportunity_id&&(a.myForm.amount=t.opportunity_achievement,a.myForm.orderId=t.orderId)})},handlecheck:function(e,t){this.previewData.forEach(function(a){a.id==t.id&&(a.displayVal=e.deptname,a.default_value=e.deptid)})},beforeUpload:function(e){e.size/1024/1024<5||this.$message.warning("文件大小不能超过 5MB!")},uploadSuccess:function(e,t,a){this.previewData.forEach(function(t){"file"==t.formType&&(t.default_value=e)})},submit:function(){var e=this,t=(a("1nuA"),{});e.agreeaddOrUpdateData.submitData?(t.contract_id=e.agreeaddOrUpdateData.submitData.id,t.batch_id=e.agreeaddOrUpdateData.submitData.batch_id):t.orderId=this.myForm.orderId;var l=e.agreeaddOrUpdateData.createForm,i=e.previewData,s=(new Array,!1);if(l.forEach(function(a){t[a.inputModel]=e.myForm[a.inputModel],"our_signatories"!=a.inputModel||t[a.inputModel]||(e.$message({message:"我方签约人不能为空",type:"error"}),s=!0),"signatories"!=a.inputModel||t[a.inputModel]||(e.$message({message:"客户签约人不能为空",type:"error"}),s=!0),"end_date"!=a.inputModel||t[a.inputModel]||(e.$message({message:"合同结束日期不能为空",type:"error"}),s=!0),"start_date"!=a.inputModel||t[a.inputModel]||(e.$message({message:"合同开始日期不能为空",type:"error"}),s=!0),"amount"!=a.inputModel||t[a.inputModel]||(e.$message({message:"合同金额不能为空",type:"error"}),s=!0),"customerpool_id"!=a.inputModel||t[a.inputModel]||(e.$message({message:"客户不能为空",type:"error"}),s=!0),"contract_type"!=a.inputModel||t[a.inputModel]||(e.$message({message:"合同类型不能为空",type:"error"}),s=!0),"contract_name"!=a.inputModel||t[a.inputModel]||(e.$message({message:"合同名称不能为空",type:"error"}),s=!0)}),i.forEach(function(t){"checkbox"==t.formType?t.value=t.default_value.join(","):"user"==t.formType||"structure"==t.formType?t.default_value&&(t.value=t.default_value.toString()):t.value=t.default_value,1!=t.is_null||t.value||(e.$message({message:t.name+"不能为空",type:"error"}),s=!0)}),!s){t.pId=this.$store.state.ispId,t.secondid=this.$store.state.deptid,t.deptid=this.$store.state.insid,t.customerpool_id=this.formid,t.our_signatories==this.$store.state.user?t.our_signatories=this.$store.state.ispId:t.our_signatories=this.our_signatoriesId;var r={entity:t,field:i};this.isDisable=!0,o()({method:"post",url:e.$store.state.defaultHttp+"contract/saveOrUpdate.do?cId="+e.$store.state.iscId,data:r}).then(function(t){t.data.code&&"200"==t.data.code?(e.$message({message:"成功",type:"success"}),e.closeTag()):e.$message({message:t.data.msg,type:"error"}),e.isDisable=!1}).catch(function(t){e.$message.error("提交失败，请重新提交")})}},handleSubmit:function(){var e=this,t=a("1nuA"),l={};e.agreeaddOrUpdateData.submitData?(l.contract_id=e.agreeaddOrUpdateData.submitData.id,l.csId=e.agreeaddOrUpdateData.submitData.csId):l.orderId=this.myForm.orderId,l.secondid=this.$store.state.deptid,l.deptid=this.$store.state.insid;var i=!1;e.agreeaddOrUpdateData.createForm.forEach(function(t){l[t.inputModel]=e.myForm[t.inputModel],"our_signatories"!=t.inputModel||l[t.inputModel]||(e.$message({message:"我方签约人不能为空",type:"error"}),i=!0),"signatories"!=t.inputModel||l[t.inputModel]||(e.$message({message:"客户签约人不能为空",type:"error"}),i=!0),"end_date"!=t.inputModel||l[t.inputModel]||(e.$message({message:"合同结束日期不能为空",type:"error"}),i=!0),"start_date"!=t.inputModel||l[t.inputModel]||(e.$message({message:"合同开始日期不能为空",type:"error"}),i=!0),"amount"!=t.inputModel||l[t.inputModel]||(e.$message({message:"合同金额不能为空",type:"error"}),i=!0),"customerpool_id"!=t.inputModel||l[t.inputModel]||(e.$message({message:"客户不能为空",type:"error"}),i=!0),"contract_type"!=t.inputModel||l[t.inputModel]||(e.$message({message:"合同类型不能为空",type:"error"}),i=!0),"contract_name"!=t.inputModel||l[t.inputModel]||(e.$message({message:"合同名称不能为空",type:"error"}),i=!0)}),i||(l.customerpool_id=this.formid,l.our_signatories==this.$store.state.user?l.our_signatories=this.$store.state.ispId:l.our_signatories=this.our_signatoriesId,this.isDisable=!0,o()({method:"post",url:e.agreeaddOrUpdateData.submitURL,data:t.stringify(l)}).then(function(t){t.data.code&&"200"==t.data.code?(e.$message({message:"成功",type:"success"}),e.closeTag()):e.$message({message:t.data.msg,type:"error"}),e.isDisable=!1}).catch(function(e){}))},closeTag:function(){var e=this,t=void 0;this.$store.state.tagsList.forEach(function(a,l){a.name==e.$options.name&&(t=l)});var a=this.$store.state.tagsList.splice(t,1)[0];(this.$store.state.tagsList[t]?this.$store.state.tagsList[t]:this.$store.state.tagsList[t-1])?a.path===this.$route.fullPath&&this.$router.push("/agreement"):this.$router.push("/index")}}}),s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addorupdatecontent"},[a("el-tabs",{staticClass:"formtabs",attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"主要数据",name:"first"}},[a("el-form",{ref:"myForm",staticClass:"cusForm",attrs:{model:e.myForm,rules:e.rules}},e._l(e.agreeaddOrUpdateData.createForm,function(t){return a("el-form-item",{key:t.inputModel,attrs:{"label-width":"100px",label:t.label,prop:t.inputModel}},[t.type&&"input"!=t.type?e._e():a("el-input",{staticStyle:{width:"90%"},attrs:{value:e.myForm[t.inputModel],"auto-complete":"off",disabled:t.disabled},on:{input:function(a){e.handleInput(a,t.inputModel)}}}),e._v(" "),"textarea"==t.type?a("el-input",{staticStyle:{width:"90%"},attrs:{type:"textarea",rows:"5",value:e.myForm[t.inputModel],"auto-complete":"off",disabled:t.disabled},on:{input:function(a){e.handleInput(a,t.inputModel)}}}):t.type&&"number"==t.type?a("el-input",{staticStyle:{width:"90%"},attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'.')",value:e.myForm[t.inputModel],"auto-complete":"off"},on:{input:function(a){e.handleInput(a,t.inputModel)}}}):t.type&&"require"==t.type&&"customerpool_id"==t.inputModel?a("el-input",{staticStyle:{width:"90%"},attrs:{value:e.myForm[t.inputModel],"auto-complete":"off"},on:{input:function(a){e.handleoninput(a,t.inputModel)},blur:function(a){e.handleblur(a,t.inputModel)}}}):"opportunity_id"==t.inputModel?a("el-select",{staticStyle:{width:"90%"},attrs:{filterable:"",multiple:t.multiple,"collapse-tags":t.multiple,placeholder:t.placeholder},on:{change:function(a){e.handleopp(a,t.inputModel)}},model:{value:e.myForm[t.inputModel],callback:function(a){e.$set(e.myForm,t.inputModel,a)},expression:"myForm[item.inputModel]"}},e._l(e.oppoptions,function(e){return a("el-option",{key:e.opportunity_id,attrs:{label:e.opportunity_name,value:e.opportunity_id}})})):"signatories"==t.inputModel?a("el-select",{staticStyle:{width:"90%"},attrs:{filterable:"",multiple:t.multiple,"collapse-tags":t.multiple,placeholder:t.placeholder},on:{change:function(a){e.handleInput(a,t.inputModel)}},model:{value:e.myForm[t.inputModel],callback:function(a){e.$set(e.myForm,t.inputModel,a)},expression:"myForm[item.inputModel]"}},e._l(e.contactslist,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})):t.type&&"select"==t.type?a("el-select",{staticStyle:{width:"90%"},attrs:{multiple:t.multiple,"collapse-tags":t.multiple,placeholder:t.placeholder},on:{change:function(a){e.handleInput(a,t.inputModel)}},model:{value:e.myForm[t.inputModel],callback:function(a){e.$set(e.myForm,t.inputModel,a)},expression:"myForm[item.inputModel]"}},e._l(t.options,function(e){return a("el-option",{key:e.okey,attrs:{label:e.olabel,value:e.ovalue}})})):t.type&&"date"==t.type&&"start_date"==t.inputModel?a("el-date-picker",{staticStyle:{width:"90%"},attrs:{type:"date",placeholder:t.placeholder,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","auto-complete":"off"},on:{change:function(a){e.handlechange(a,t.inputModel)}},model:{value:e.myForm[t.inputModel],callback:function(a){e.$set(e.myForm,t.inputModel,a)},expression:"myForm[item.inputModel]"}}):t.type&&"date"==t.type&&"end_date"==t.inputModel?a("el-date-picker",{staticStyle:{width:"90%"},attrs:{type:"date",placeholder:t.placeholder,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","auto-complete":"off"},on:{change:function(a){e.handleInput(a,t.inputModel)}},model:{value:e.myForm[t.inputModel],callback:function(a){e.$set(e.myForm,t.inputModel,a)},expression:"myForm[item.inputModel]"}}):t.type&&"radio"==t.type?a("div",[a("el-radio",{attrs:{label:"是"},on:{input:function(a){e.handleInput(a,t.inputModel)}},model:{value:e.myForm[t.inputModel],callback:function(a){e.$set(e.myForm,t.inputModel,a)},expression:"myForm[item.inputModel]"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"否"},on:{input:function(a){e.handleInput(a,t.inputModel)}},model:{value:e.myForm[t.inputModel],callback:function(a){e.$set(e.myForm,t.inputModel,a)},expression:"myForm[item.inputModel]"}},[e._v("否")])],1):e._e()],1)}))],1),e._v(" "),a("el-tab-pane",{attrs:{label:"自定义字段",name:"second"}},[a("el-form",{ref:"attributeform",staticClass:"cusForm",attrs:{model:e.fieldsform,rules:e.rules}},e._l(e.previewData,function(t){return a("el-form-item",{key:t.id,attrs:{label:t.name,prop:t.field_name,"label-width":"130px"}},["text"==t.formType||"email"==t.formType?a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"textarea"==t.formType?a("el-input",{staticStyle:{width:"90%"},attrs:{type:"textarea",maxlength:t.max_length,placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"number"==t.formType?a("el-input",{staticStyle:{width:"90%"},attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"floatnumber"==t.formType?a("el-input",{staticStyle:{width:"90%"},attrs:{onkeyup:"value=value.replace(/^\\D*(\\d*(?:\\.\\d{0,2})?).*$/g, '$1')",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"mobile"==t.formType?a("el-input",{staticStyle:{width:"90%"},attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",maxlength:11,placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"select"==t.formType?a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(t.setting,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})):"checkbox"==t.formType?a("el-select",{staticStyle:{width:"90%"},attrs:{multiple:"",placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(t.setting,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})):"user"==t.formType?a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:t.input_tips},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}},e._l(e.userData,function(e){return a("el-option",{key:e.private_id,attrs:{label:e.private_employee,value:e.private_id}})})):"structure"==t.formType?a("el-select",{staticClass:"noPadding_select",staticStyle:{width:"90%"},attrs:{placeholder:t.input_tips},model:{value:t.displayVal,callback:function(a){e.$set(t,"displayVal",a)},expression:"item.displayVal"}},[a("el-option",{staticClass:"droplist nopadding_option",attrs:{value:t.displayVal}},[a("el-tree",{ref:"tree",refInFor:!0,attrs:{"node-key":"deptid","highlight-current":"","default-expand-all":"","expand-on-click-node":!1,data:e.deptData,props:e.defaultProps},on:{"node-click":function(a){e.handlecheck(a,t)}}})],1)],1):"date"==t.formType?a("el-date-picker",{staticStyle:{width:"90%"},attrs:{type:"date",placeholder:t.input_tips,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"datetime"==t.formType?a("el-date-picker",{staticStyle:{width:"90%"},attrs:{type:"datetime",placeholder:t.input_tips,format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.default_value,callback:function(a){e.$set(t,"default_value",a)},expression:"item.default_value"}}):"file"==t.formType?a("el-upload",{staticClass:"upload-demo",attrs:{action:e.doUpload,multiple:!1,limit:1,"on-success":e.uploadSuccess,"before-upload":e.beforeUpload}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传")]),e._v(" "),a("div",{staticClass:"el-upload__tip",staticStyle:{"margin-top":"-20px"},attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(t.input_tips))])],1):e._e()],1)}))],1)],1),e._v(" "),a("div",{staticClass:"line",staticStyle:{height:"640px"}}),e._v(" "),a("div",{staticClass:"formlist"},[a("el-table",{attrs:{data:e.tableData,border:"",stripe:"","default-sort":{order:"ascending"},"max-height":"630"}},[a("el-table-column",{attrs:{"header-align":"center",align:"center",width:"35"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{width:"15px",height:"15px",padding:"0","border-radius":"50%"},on:{click:function(a){e.getRow(t.$index,t.row)}}},[e._v(" ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name","min-width":"200",label:"公司名称",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"address","show-overflow-tooltip":"","min-width":"200",label:"公司地址",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"representative","min-width":"90",label:"法人",sortable:""}})],1)],1),e._v(" "),a("div",{staticClass:"submit_btn"},[a("el-button",{staticStyle:{"margin-right":"50px !important"},attrs:{type:"primary",disabled:e.isDisable},on:{click:e.submit}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.closeTag}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var r=a("VU/8")(i,s,!1,function(e){a("MuPd")},null,null);t.default=r.exports}});