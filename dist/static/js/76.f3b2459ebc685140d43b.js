webpackJsonp([76],{w6qD:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("wtEF"),n=a("mtWM"),o=a.n(n),l=(a("mw3O"),{name:"culturePond",store:s.a,computed:{tableData:function(){return s.a.state.culturePondList},tableNumber:function(){return s.a.state.culturePondListnumber}},data:function(){return{msg:"culturePond.vue",page:1,limit:20,searchList:{searchName:null,label:1},pIdData:[{index:0,name:"全部"},{index:1,name:"我的"},{index:2,name:"本组"},{index:3,name:"本机构"}],idArr:[],SMSId:[],SMSnames:[],SMSphones:[],SMScontacts:[],SMSemails:[],dialogVisible:!1,dialogVisible2:!1,templateList:null,newform:{templateId:null,culnum:null,explain:null,smscontent:null,url:null},rules:{templateId:[{required:!0,message:"短信模板不能为空",trigger:"blur"}]},downloadUrl:this.$store.state.systemHttp+"upload/culture_pool_template.xls",filterList:null,checklist:null}},mounted:function(){this.loadTable(),this.reloadData()},activated:function(){this.loadTable()},methods:{loadTable:function(){var t=this,e=a("1nuA"),s={};0==this.searchList.label?s.pId=null:1==this.searchList.label?s.pId=t.$store.state.ispId:2==this.searchList.label?s.secondid=t.$store.state.deptid:3==this.searchList.label&&(s.deptid=t.$store.state.insid),s.searchName=this.searchList.searchName,s.page=this.page,s.limit=this.limit,o()({method:"post",url:t.$store.state.defaultHttp+"cultivationPool/queryForList.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){t.$store.state.culturePondList=e.data.map.success,t.$store.state.culturePondListnumber=e.data.count}).catch(function(t){})},loadTemplate:function(){var t=this,e=a("1nuA"),s={type:"营销",genre:"营销类",status:"2"};o()({method:"post",url:t.$store.state.defaultHttp+"template/selectTemplate.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){t.templateList=e.data.map.templates}).catch(function(t){})},reloadData:function(){var t=this,e=a("1nuA"),s={type:"培育池"},n={type:"培育池",state:1};o()({method:"post",url:t.$store.state.defaultHttp+"userPageInfo/getAllUserPage.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(s)}).then(function(e){t.filterList=e.data}).catch(function(t){}),o()({method:"post",url:t.$store.state.defaultHttp+"userPageInfo/getUserPage.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(n)}).then(function(e){t.checklist=e.data}).catch(function(t){})},openDetails:function(t,e){this.$store.state.culturePondetailData={id:e.id},this.$router.push({path:"/culturePondetail"})},selectInfo:function(t){var e=this,a=t,s=[new Array];this.SMSId=[],this.SMSnames=[],this.SMSphones=[],this.SMScontacts=[],this.SMSemails=[],a.forEach(function(t){0!=t.id&&(s.push(t.id),e.SMSId.push(t.id),e.SMSnames.push(t.name),e.SMSphones.push(t.phone),e.SMScontacts.push(t.contacts),e.SMSemails.push(t.email))}),this.idArr=s},handleAdd:function(){this.$store.state.culPondaddorUpdateData={},this.$router.push({path:"/culPondaddorUpdate"})},handleEdit:function(t,e){this.$store.state.culPondaddorUpdateData=e,this.$router.push({path:"/culPondaddorUpdate"})},handleDelete:function(t,e){var s=this,n=this,l=a("1nuA"),i=[];i.ids=e.id,n.$confirm("是否确认删除["+e.name+"]？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){t.value;o()({method:"post",url:n.$store.state.defaultHttp+"cultivationPool/deleteByPrimaryKey.do?cId="+n.$store.state.iscId,data:l.stringify(i)}).then(function(t){t.data.code&&"200"==t.data.code?(n.$message({message:"删除成功",type:"success"}),n.$options.methods.loadTable.bind(n)(!0)):t.data.msg&&"error"==t.data.msg?n.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):n.$message({message:t.data.msg,type:"error"})}).catch(function(t){n.$message.error("删除失败,请重新删除")})}).catch(function(){s.$message({type:"info",message:"取消删除【"+e.name+"】"})})},handleDeletes:function(){var t=this,e=a("1nuA"),s=[];s.ids=this.idArr,s.ids?t.$confirm("是否确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){a.value;o()({method:"post",url:t.$store.state.defaultHttp+"cultivationPool/deleteByPrimaryKey.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){e.data.code&&"200"==e.data.code?(t.$message({message:"删除成功",type:"success"}),t.$options.methods.loadTable.bind(t)(!0)):e.data.msg&&"error"==e.data.msg?t.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):t.$message({message:e.data.msg,type:"error"})}).catch(function(e){t.$message.error("删除失败,请重新删除")})}).catch(function(){t.$message({type:"info",message:"取消删除"})}):t.$message({type:"error",message:"请先选择要删除的线索"})},beforeUpload:function(t){var e=this;this.files=t;var a="xls"===t.name.split(".")[1],s="xlsx"===t.name.split(".")[1],n=t.size/1024/1024<5;return a||s?n?(this.fileName=t.name,void setTimeout(function(){e.submitUpload()},500)):(this.$message.warning("上传模板大小不能超过 5MB!"),!1):(this.$message.warning("上传模板只能是 xls、xlsx格式!"),!1)},uploadExceed:function(t,e){if(t.length>1)return this.$message.warning("只能导入一份文件!"),!1},submitUpload:function(){var t=this;if(""==this.fileName)return this.$message.warning("请选择要上传的文件！"),!1;var e=new FormData;e.append("pId",this.$store.state.ispId),e.append("secondid",this.$store.state.deptid),e.append("deptid",this.$store.state.insid),e.append("files",this.files,this.fileName);o.a.post(this.$store.state.defaultHttp+"cultivationPool/upload.do?cId="+this.$store.state.iscId,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.$message({message:"上传成功",type:"success"}),t.$options.methods.loadTable.bind(t)(!0)}).catch(function(e){t.$message.error("excel上传失败，请重新上传")})},changetemplate:function(t){var e=this;this.templateList.forEach(function(a){a.templateId==t&&(e.newform.smscontent=a.content)})},showsend:function(){this.SMSId[0]?(this.$options.methods.loadTemplate.bind(this)(),this.newform.culnum=this.SMSId.length,this.newform.templateId="",this.newform.explain="",this.newform.smscontent="",this.dialogVisible=!0):this.$message({type:"error",message:"请先选择要发送短信的培育池"})},sendSMS:function(){var t=this,e=a("1nuA"),s={};s.names=this.SMSnames,s.phones=this.SMSphones,s.contacts=this.SMScontacts,s.templateId=this.newform.templateId,o()({method:"post",url:t.$store.state.defaultHttp+"message/sendMarketingMsg.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){e.data.code&&"200"==e.data.code?(t.$message({message:"发送成功",type:"success"}),t.$options.methods.addSMSsended.bind(t)(),t.dialogVisible=!1):t.$message({message:e.data.msg,type:"error"})}).catch(function(t){})},addSMSsended:function(){var t=a("1nuA"),e={type:"培育池"};e.ids=this.SMSId,e.names=this.SMSnames,e.phones=this.SMSphones,e.contacts=this.SMScontacts,e.templateId=this.newform.templateId,e.explain=this.newform.explain,e.pId=this.$store.state.ispId,e.secondid=this.$store.state.deptid,e.deptid=this.$store.state.insid,o()({method:"post",url:this.$store.state.defaultHttp+"sendRecord/insertSendRecord.do?cId="+this.$store.state.iscId,data:t.stringify(e)}).then(function(t){}).catch(function(t){})},showemail:function(){this.SMSId[0]?(this.newform.culnum=this.SMSId.length,this.newform.url="",this.newform.templateId="",this.dialogVisible2=!0):this.$message({type:"error",message:"请先选择要发送邮箱的培育池"})},sendEmail:function(){var t=this,e=a("1nuA"),s={};s.names=this.SMSnames,s.emails=this.SMSemails,s.templateId=this.newform.templateId,s.url=this.newform.url,o()({method:"post",url:t.$store.state.defaultHttp+"message/mailXSend.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){e.data.code&&"200"==e.data.code?(t.$message({message:"发送成功",type:"success"}),t.dialogVisible2=!1):t.$message({message:e.data.msg,type:"error"})}).catch(function(t){})},hangleChange:function(t,e){var s=this,n=a("1nuA"),l={};l.pageInfoId=e.pageInfoId,l.state=1==t?1:0,o()({method:"post",url:s.$store.state.defaultHttp+"userPageInfo/updateUserPageByid.do?cId="+s.$store.state.iscId+"&pId="+s.$store.state.ispId,data:n.stringify(l)}).then(function(t){t.data&&"success"==t.data&&s.$options.methods.reloadData.bind(s)(!0)}).catch(function(t){})},search:function(){this.$options.methods.loadTable.bind(this)()},handleSizeChange:function(t){this.limit=t,this.$options.methods.loadTable.bind(this)()},handleCurrentChange:function(t){this.page=t,this.$options.methods.loadTable.bind(this)()}}}),i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"radioList"},[a("el-radio-group",{model:{value:t.searchList.label,callback:function(e){t.$set(t.searchList,"label",e)},expression:"searchList.label"}},[a("span",{staticClass:"nameList"},[t._v("数据授权：")]),t._v(" "),t._l(t.pIdData,function(e){return a("el-radio",{key:e.index,attrs:{label:e.index},on:{change:function(e){t.search()}}},[t._v(t._s(e.name))])})],2)],1),t._v(" "),a("div",{staticClass:"searchList",staticStyle:{width:"100%"}},[a("span",{staticClass:"nameList"},[t._v("公司名称：")]),t._v(" "),a("el-input",{staticStyle:{"margin-left":"20px",width:"400px"},attrs:{placeholder:"请输入公司名称"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null}},model:{value:t.searchList.searchName,callback:function(e){t.$set(t.searchList,"searchName",e)},expression:"searchList.searchName"}}),t._v("\n          \n        "),a("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"mini"},on:{click:function(e){t.search()}}},[t._v("查询")])],1),t._v(" "),a("div",{staticClass:"entry"},[a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini"},on:{click:function(e){t.handleAdd()}}},[t._v("新增")]),t._v(" "),a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini"},on:{click:function(e){t.handleDeletes()}}},[t._v("删除")]),t._v(" "),a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini"},on:{click:function(e){t.showsend()}}},[t._v("发送短信")]),t._v(" "),a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini"},on:{click:function(e){t.showemail()}}},[t._v("发送邮件")]),t._v(" "),a("div",{staticClass:"totalnum_head"},[t._v("共 "),a("span",{staticClass:"bold_span"},[t._v(t._s(t.tableNumber))]),t._v(" 条")]),t._v(" "),a("el-popover",{attrs:{placement:"left",width:"150",trigger:"click"}},[a("div",{staticClass:"download_c"},[a("p",{staticClass:"download_h"},[t._v("首次导入请下载模板")]),t._v(" "),a("div",{staticClass:"download_down"},[a("el-button",{staticClass:"info-btn",attrs:{type:"mini"}},[a("a",{attrs:{href:t.downloadUrl,download:""}},[t._v("下载模板")])])],1),t._v(" "),a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"","before-upload":t.beforeUpload,"on-exceed":t.uploadExceed}},[a("el-button",{staticClass:"info-btn",attrs:{slot:"trigger",size:"mini"},slot:"trigger"},[t._v("导入excel")])],1)],1),t._v(" "),a("el-button",{staticClass:"info-btn screen_upload",attrs:{slot:"reference",type:"mini"},slot:"reference"},[t._v("导入")])],1),t._v(" "),a("el-popover",{attrs:{placement:"bottom",width:"100",trigger:"click"}},[a("el-checkbox-group",{staticClass:"checklist",staticStyle:{"max-height":"600px","overflow-y":"overlay","overflow-x":"hidden"},model:{value:t.checklist,callback:function(e){t.checklist=e},expression:"checklist"}},t._l(t.filterList,function(e){return a("el-checkbox",{key:e.id,staticClass:"checkone",attrs:{label:e.name,value:e.state},on:{change:function(a){t.hangleChange(a,e)}}})})),t._v(" "),a("el-button",{staticClass:"info-btn screen",attrs:{slot:"reference",icon:"el-icon-more",type:"mini"},slot:"reference"})],1)],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"",stripe:""},on:{"selection-change":t.selectInfo}},[a("el-table-column",{attrs:{fixed:"","header-align":"center",align:"center",type:"selection",width:"45",prop:"id",sortable:""},on:{"selection-change":t.selectInfo}}),t._v(" "),t._l(t.filterList,function(e,s){return a("div",{key:s},["contacts"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"联系人",prop:"contacts",fixed:"","min-width":"100",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"hoverline",on:{click:function(a){t.openDetails(e.$index,e.row)}}},[t._v("\n                        "+t._s(e.row.contacts)+"\n                    ")])]}}])}):t._e(),t._v(" "),"name"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"公司名称",prop:"name",fixed:"","min-width":"200",sortable:""}}):t._e(),t._v(" "),"phone"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"手机",prop:"phone","min-width":"110",sortable:""}}):t._e(),t._v(" "),"email"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"邮箱",prop:"email","min-width":"130",sortable:""}}):t._e(),t._v(" "),"qq"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"QQ",prop:"qq","min-width":"110",sortable:""}}):t._e(),t._v(" "),"telephone"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"固话",prop:"telephone","min-width":"110",sortable:""}}):t._e(),t._v(" "),"microblog"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"微博",prop:"microblog","min-width":"110",sortable:""}}):t._e(),t._v(" "),"wangwang"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"旺旺",prop:"wangwang","min-width":"110",sortable:""}}):t._e(),t._v(" "),"address"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"地址",prop:"address","min-width":"180","show-overflow-tooltip":"",sortable:""}}):t._e(),t._v(" "),"position"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"职位",prop:"position","min-width":"100",sortable:""}}):t._e(),t._v(" "),"sex"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"性别",prop:"sex","min-width":"90",sortable:""}}):t._e(),t._v(" "),"birthday"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"生日",prop:"birthday","min-width":"110",sortable:""}}):t._e(),t._v(" "),"provincialAndUrbanAreas"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"省-市-区",prop:"countryid","min-width":"150",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.country)+"-"+t._s(e.row.city)+"-"+t._s(e.row.area)+"\n                ")]}}])}):t._e(),t._v(" "),"createTime"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"创建时间",prop:"createTime","min-width":"150",sortable:""}}):t._e(),t._v(" "),"pId"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"负责人",prop:"private_employee","min-width":"100",sortable:""}}):t._e(),t._v(" "),"secondid"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"部门",prop:"deptname","min-width":"110",sortable:""}}):t._e(),t._v(" "),"deptid"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"机构",prop:"parentname","min-width":"110","show-overflow-tooltip":"",sortable:""}}):t._e(),t._v(" "),"weChat"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"是否开通微信",prop:"weChat","min-width":"130",sortable:""}}):t._e(),t._v(" "),"alipay"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"是否开通支付宝",prop:"alipay","min-width":"145",sortable:""}}):t._e(),t._v(" "),"msg_number_of_marketing"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"短信营销次数",prop:"msg_number_of_marketing","min-width":"130",sortable:""}}):t._e(),t._v(" "),"msg_open_num"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"短信打开次数",prop:"msg_open_num","min-width":"130",sortable:""}}):t._e(),t._v(" "),"email_number_of_marketing"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"邮件营销次数",prop:"email_number_of_marketing","min-width":"130",sortable:""}}):t._e(),t._v(" "),"email_open_num"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"邮件打开次数",prop:"email_open_num","min-width":"130",sortable:""}}):t._e(),t._v(" "),"label"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"标签",prop:"label","min-width":"110",sortable:""}}):t._e()],1)}),t._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],2),t._v(" "),a("div",{staticClass:"block numberPage"},[a("el-pagination",{attrs:{"current-page":t.page,"page-sizes":[20,50,100,500],"page-size":20,layout:"total, sizes, prev, pager, next, jumper",total:t.tableNumber},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:"发送短信",visible:t.dialogVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"newform",staticStyle:{"padding-right":"30px"},attrs:{model:t.newform,"label-width":"110px",rules:t.rules}},[a("el-form-item",{attrs:{prop:"culnum",label:"培育池选择量"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.newform.culnum,callback:function(e){t.$set(t.newform,"culnum",e)},expression:"newform.culnum"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"templateId",label:"短信模板"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:t.changetemplate},model:{value:t.newform.templateId,callback:function(e){t.$set(t.newform,"templateId",e)},expression:"newform.templateId"}},t._l(t.templateList,function(t){return a("el-option",{key:t.templateId,attrs:{label:t.title,value:t.templateId}})}))],1),t._v(" "),a("el-form-item",{attrs:{prop:"smscontent",label:"短信内容"}},[a("el-input",{attrs:{type:"textarea",rows:"5",disabled:!0},model:{value:t.newform.smscontent,callback:function(e){t.$set(t.newform,"smscontent",e)},expression:"newform.smscontent"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"explain",label:"说明"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入短信说明"},model:{value:t.newform.explain,callback:function(e){t.$set(t.newform,"explain",e)},expression:"newform.explain"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.sendSMS()}}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"发送邮件",visible:t.dialogVisible2,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(e){t.dialogVisible2=e}}},[a("el-form",{ref:"newform",staticStyle:{"padding-right":"30px"},attrs:{model:t.newform,"label-width":"110px",rules:t.rules}},[a("el-form-item",{attrs:{prop:"culnum",label:"培育池选择量"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.newform.culnum,callback:function(e){t.$set(t.newform,"culnum",e)},expression:"newform.culnum"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"templateId",label:"邮件模板ID"}},[a("el-input",{attrs:{placeholder:"例如：rtqfM2"},model:{value:t.newform.templateId,callback:function(e){t.$set(t.newform,"templateId",e)},expression:"newform.templateId"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"url",label:"网址"}},[a("el-input",{model:{value:t.newform.url,callback:function(e){t.$set(t.newform,"url",e)},expression:"newform.url"}},[a("template",{slot:"prepend"},[t._v("http://")])],2)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible2=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.sendEmail()}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]},r=a("VU/8")(l,i,!1,null,null,null);e.default=r.exports}});