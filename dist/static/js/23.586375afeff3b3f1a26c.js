webpackJsonp([23],{Qioj:function(e,t){},lsbt:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("wtEF"),i=a("mtWM"),r=a.n(i),o=(a("mw3O"),{name:"socialMarketing",props:{totalNum:Number},store:s.a,computed:{tableData:function(){return s.a.state.activityList},tableNumber:function(){return s.a.state.activityListnumber}},data:function(){return{datalist:[],defaultProps:{label:"deptname",children:"next"},newform:{resourceid:null,name:null,remarks:null,secondid:null},searchList:{searchName:null,secondid:null,resourceid:null},filterList:null,checklist:null,idArr:{id:null},typeData:null,roleList:null,clickdata:null,qrcode:null,codeURL:null,page:1,limit:20,dialogVisible:!1,dialogVisible2:!1,rules:{name:[{required:!0,message:"活动名称不能为空",trigger:"blur"}],resourceid:[{required:!0,message:"来源不能为空",trigger:"blur"}]}}},beforeCreate:function(){var e=this;r()({method:"get",url:e.$store.state.defaultHttp+"dept/getDeptNodeTree.do?cId="+e.$store.state.iscId}).then(function(t){e.datalist=t.data.map.success}).catch(function(e){})},activated:function(){this.reloadTable()},mounted:function(){this.reloadTable(),this.loadcues()},methods:{reloadTable:function(){var e=this,t=a("1nuA"),s={};s.page=this.page,s.limit=this.limit,s.searchName=this.searchList.searchName,s.secondid=this.searchList.secondid,s.cuesid=this.searchList.cuesid,r()({method:"post",url:e.$store.state.defaultHttp+"activity/getActivity.do?cId="+e.$store.state.iscId,data:t.stringify(s)}).then(function(t){e.$store.state.activityList=t.data.map.success,e.$store.state.activityListnumber=t.data.count,e.$store.state.activityList.forEach(function(t){t.qrcode="/weChat/"+e.$store.state.iscId+"/"+t.url,t.codeURL=e.$store.state.systemHttp+"#/activity?p="+t.param})}).catch(function(e){})},loadcues:function(){var e=this,t=a("1nuA"),s={type:"客户来源"},i={type:"活动"},o={type:"活动",state:1};r()({method:"post",url:e.$store.state.defaultHttp+"typeInfo/getTypeInfoGroupByType.do?cId="+e.$store.state.iscId,data:t.stringify(s)}).then(function(t){e.typeData=t.data}).catch(function(e){}),r()({method:"post",url:e.$store.state.defaultHttp+"userPageInfo/getAllUserPage.do?cId="+e.$store.state.iscId+"&pId="+e.$store.state.ispId,data:t.stringify(i)}).then(function(t){e.filterList=t.data}).catch(function(e){}),r()({method:"post",url:e.$store.state.defaultHttp+"userPageInfo/getUserPage.do?cId="+e.$store.state.iscId+"&pId="+e.$store.state.ispId,data:t.stringify(o)}).then(function(t){e.checklist=t.data}).catch(function(e){})},handleNodeClick:function(e){this.searchList.secondid=e.deptid,this.clickdata=e,this.newform.secondid=e.deptid,this.$options.methods.reloadTable.bind(this)(!0)},selectInfo:function(e){this.multipleSelection=e;var t=e,a=[new Array];t.forEach(function(e){0!=e.id&&a.push(e.id)}),this.idArr.id=a},handledelete:function(e,t){var s=this,i=a("1nuA"),o={};o.id=t.id,t.pId==this.$store.state.ispId?s.$confirm("是否确认删除"+t.name+"吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){e.value;r()({method:"post",url:s.$store.state.defaultHttp+"activity/delActivity.do?cId="+s.$store.state.iscId,data:i.stringify(o)}).then(function(e){e.data.code&&200==e.data.code?(s.$message({message:"删除成功",type:"success"}),s.$options.methods.reloadTable.bind(s)(!0)):e.data.msg&&"error"==e.data.msg?s.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):s.$message({message:e.data.msg,type:"error"})}).catch(function(e){s.$message.error("提交失败,请重新提交")})}).catch(function(){s.$message({type:"info",message:"取消删除["+t.name+"]"})}):s.$message({type:"error",message:"不可删除非本人的活动"})},handleAdd:function(){var e=this;this.newform.resourceid=null,this.newform.name=null,this.newform.remarks=null,this.clickdata?this.newform.secondid==this.$store.state.deptid?r()({method:"post",url:e.$store.state.defaultHttp+"activityJurisdiction/insert.do"}).then(function(t){t.data.msg&&"error"==t.data.msg?e.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):e.dialogVisible=!0}).catch(function(e){}):e.$message({message:"请添加自己部门下的活动",type:"error"}):e.$message({message:"请先选择部门，再添加活动",type:"info"})},adduser:function(){var e=this,t=a("1nuA"),s={};s.resourceid=this.newform.resourceid,s.name=this.newform.name,s.remarks=this.newform.remarks,s.secondid=this.newform.secondid;var i=!1;[this.newform].forEach(function(t){t.name||(e.$message({message:"活动名称不能为空",type:"error"}),i=!0),t.resourceid||(e.$message({message:"来源不能为空",type:"error"}),i=!0)}),i||r()({method:"post",url:e.$store.state.defaultHttp+"activity/insertActivity.do?cId="+e.$store.state.iscId+"&pId="+e.$store.state.ispId,data:t.stringify(s)}).then(function(t){t.data.code&&200==t.data.code?(e.$message({message:"添加活动成功",type:"success"}),e.dialogVisible=!1,e.$options.methods.reloadTable.bind(e)(!0)):e.$message({message:t.data.msg,type:"error"})}).catch(function(t){e.$message.error("提交失败,请重新提交")})},hangleChange:function(e,t){var s=this,i=a("1nuA"),o={};o.pageInfoId=t.pageInfoId,o.state=1==e?1:0,r()({method:"post",url:s.$store.state.defaultHttp+"userPageInfo/updateUserPageByid.do?cId="+s.$store.state.iscId+"&pId="+s.$store.state.ispId,data:i.stringify(o)}).then(function(e){e.data&&"success"==e.data&&s.$options.methods.reloadTable.bind(s)(!0)}).catch(function(e){})},search:function(){this.$options.methods.reloadTable.bind(this)(!0)},handleSizeChange:function(e){this.limit=e,this.$options.methods.reloadTable.bind(this)(!1)},handleCurrentChange:function(e){this.page=e,this.$options.methods.reloadTable.bind(this)(!1)}}}),n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contentall"},[a("div",{staticClass:"otherleftcontent"},[a("el-tree",{attrs:{"node-key":"deptid","highlight-current":"","default-expand-all":"",data:e.datalist,props:e.defaultProps,"expand-on-click-node":!1},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),a("div",{staticClass:"centercontent"}),e._v(" "),a("div",{staticClass:"otherightcontent"},[a("div",{staticClass:"searchList",staticStyle:{width:"100%"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入活动名称"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.search(t):null}},model:{value:e.searchList.searchName,callback:function(t){e.$set(e.searchList,"searchName",t)},expression:"searchList.searchName"}}),e._v("\n              \n            "),a("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"mini"},on:{click:function(t){e.search()}}},[e._v("查询")])],1),e._v(" "),a("div",{staticClass:"entry"},[a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini"},on:{click:function(t){e.handleAdd()}}},[e._v("新增")]),e._v(" "),a("div",{staticClass:"totalnum_head"},[e._v("共 "),a("span",{staticClass:"bold_span"},[e._v(e._s(e.tableNumber))]),e._v(" 条")]),e._v(" "),a("el-popover",{attrs:{placement:"bottom",width:"100",trigger:"click"}},[a("el-checkbox-group",{staticClass:"checklist",staticStyle:{"max-height":"600px","overflow-y":"overlay","overflow-x":"hidden"},model:{value:e.checklist,callback:function(t){e.checklist=t},expression:"checklist"}},e._l(e.filterList,function(t){return a("el-checkbox",{key:t.id,staticClass:"checkone",attrs:{label:t.name,value:t.state},on:{change:function(a){e.hangleChange(a,t)}}})})),e._v(" "),a("el-button",{staticClass:"info-btn screen",attrs:{slot:"reference",icon:"el-icon-more",type:"mini"},slot:"reference"})],1)],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""},on:{"selection-change":e.selectInfo}},[a("el-table-column",{attrs:{fixed:"","header-align":"center",align:"center",type:"selection",width:"45","scope.row.id":"",prop:"id",sortable:""},on:{"selection-change":e.selectInfo}}),e._v(" "),e._l(e.filterList,function(t,s){return a("div",{key:s},["name"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"活动名称",prop:"name",fixed:"","min-width":"150",sortable:""}}):e._e(),e._v(" "),"private_employee"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"负责人",prop:"private_employee","min-width":"100",sortable:""}}):e._e(),e._v(" "),"clueNum"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"线索量",prop:"clueNum","min-width":"100",sortable:""}}):e._e(),e._v(" "),"createTime"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"创建时间",prop:"createTime","min-width":"150",sortable:""}}):e._e(),e._v(" "),"codeURL"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"网址",prop:"codeURL","min-width":"320",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:t.row.codeURL,target:"_blank"}},[e._v(" "+e._s(t.row.codeURL))])]}}])}):e._e(),e._v(" "),"typeName"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"来源",prop:"typeName","min-width":"110",sortable:""}}):e._e(),e._v(" "),"remarks"==t.prop&&1==t.state?a("el-table-column",{attrs:{label:"备注",prop:"remarks","min-width":"180",sortable:""}}):e._e()],1)}),e._v(" "),a("el-table-column",{attrs:{label:"二维码",fixed:"right",width:"120","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{placement:"right",width:"200",trigger:"hover"}},[a("img",{attrs:{src:t.row.qrcode,alt:"图片",width:"200",height:"200"}}),e._v(" "),a("img",{attrs:{slot:"reference",src:t.row.qrcode,alt:"图片",width:"50",height:"50"},slot:"reference"})])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"90",fixed:"right","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.handledelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],2),e._v(" "),a("div",{staticClass:"block numberPage"},[a("el-pagination",{attrs:{"current-page":e.page,"page-sizes":[20,50,100,500],"page-size":20,layout:"total, sizes, prev, pager, next, jumper",total:e.tableNumber},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加活动",visible:e.dialogVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"newform",attrs:{model:e.newform,"label-width":"80px",rules:e.rules}},[a("el-form-item",{attrs:{prop:"resourceid",label:"来源"}},[a("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择来源"},model:{value:e.newform.resourceid,callback:function(t){e.$set(e.newform,"resourceid",t)},expression:"newform.resourceid"}},e._l(e.typeData,function(t){return a("el-option",{key:t.id,attrs:{label:t.typeName,value:t.id}},[e._v(e._s(t.typeName))])}))],1),e._v(" "),a("el-form-item",{attrs:{prop:"name",label:"活动名称"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入活动名称"},model:{value:e.newform.name,callback:function(t){e.$set(e.newform,"name",t)},expression:"newform.name"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"remarks",label:"备注"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入活动备注"},model:{value:e.newform.remarks,callback:function(t){e.$set(e.newform,"remarks",t)},expression:"newform.remarks"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.adduser()}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改活动",visible:e.dialogVisible2,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.dialogVisible2=t}}},[a("el-form",{ref:"newform",attrs:{model:e.newform,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"resourceid",label:"来源"}},[a("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择来源"},model:{value:e.newform.resourceid,callback:function(t){e.$set(e.newform,"resourceid",t)},expression:"newform.resourceid"}},e._l(e.typeData,function(t){return a("el-option",{key:t.id,attrs:{label:t.typeName,value:t.id}},[e._v(e._s(t.typeName))])}))],1),e._v(" "),a("el-form-item",{attrs:{prop:"name",label:"活动名称"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入活动名称"},model:{value:e.newform.name,callback:function(t){e.$set(e.newform,"name",t)},expression:"newform.name"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"remarks",label:"备注"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入活动备注"},model:{value:e.newform.remarks,callback:function(t){e.$set(e.newform,"remarks",t)},expression:"newform.remarks"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible2=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.updateuser()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var l=a("VU/8")(o,n,!1,function(e){a("Qioj")},null,null);t.default=l.exports}});