webpackJsonp([40],{x2Ez:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("INCx"),i=a.n(s),n=a("wtEF"),l=a("mtWM"),o=a.n(l),c=(a("mw3O"),{name:"examinedetail",store:n.a,filters:{commaing:function(t){if(t){var e=i()(t).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"),a=".00",s=t.toString().split(".");return 2===s.length?1===(a=s[1].toString()).length?e+"."+a+"0":e+"."+a:e+a}}},data:function(){return{detailData:null,tableDatas:null,tableNumber:null,page:1,limit:20,searchList:{keyword:null},examineDetail:{},fieldData:[],dialogImageUrl:null,dialogVisible:!1,examineList:[],hasCheck:null,hasRecheck:null,examineLog:[],showLaunch:!1,isSelf:!1,dialogVisibleexa:!1,exaform:{status:null,remarks:null},rules:{remarks:[{required:!0,message:"审核意见不能为空",trigger:"blur"}]},auditing:this.$store.state.systemHttp+"/upload/staticImg/inaudit.png",audited:this.$store.state.systemHttp+"/upload/staticImg/examine.png",noaudit:this.$store.state.systemHttp+"/upload/staticImg/refuse.png"}},activated:function(){this.loadData(),this.loadTable()},methods:{loadData:function(){var t=this,e=a("1nuA");this.detailData=this.$store.state.examinedetailData;var s={label:10,id:this.detailData.id,categoryId:this.detailData.category_id};o()({method:"get",url:t.$store.state.defaultHttp+"oaExamine/selectByPrimakey.do?cId="+t.$store.state.iscId+"&id="+t.detailData.id}).then(function(e){var a=e.data,s=a.createTime.slice(0,10),i=new RegExp("-","g");if(a.cTime=s.replace(i,""),a.image&&(a.imageUrl=t.$store.state.systemHttp+"upload/"+t.$store.state.iscId+"/"+a.image),a.file){var n=JSON.parse(a.file);a.file_name=n.name,a.fileUrl=t.$store.state.systemHttp+"upload/"+t.$store.state.iscId+"/"+n.response}t.examineDetail=a,a.examineRecordId?t.$options.methods.loadExamine.bind(t)():(t.showLaunch=!1,a.pid==t.$store.state.ispId?t.isSelf=!0:t.isSelf=!1)}).catch(function(t){}),o()({method:"post",url:t.$store.state.defaultHttp+"field/information.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){t.fieldData=e.data}).catch(function(t){})},loadExamine:function(){var t=this,e=a("1nuA"),s={checkStatus:t.examineDetail.checkStatus,recordId:t.examineDetail.examineRecordId,pId:t.$store.state.ispId};o()({method:"post",url:t.$store.state.defaultHttp+"examineRecord/queryExamineRecordList.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){t.examineList=e.data.steps,t.examineList.forEach(function(e,a){if(e.userLength=e.userList.length,1==e.userLength?e.type_style="width:50px;":2==e.userLength?e.type_style="width:75px;":3==e.userLength?e.type_style="width:100px;":4==e.userLength?e.type_style="width:125px;":5==e.userLength&&(e.type_style="width:150px;"),0==a&&(e.userList[0].img?e.headPortrait=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+e.userList[0].img:e.headPortrait=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg"),2==e.stepType)for(var s=0;s<e.userList.length;s++){if(e.userList[s].img&&0!==e.userList[s].examineStatus){e.headPortrait=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+e.userList[s].img;break}if(!e.userList[s].img&&0!==e.userList[s].examineStatus){e.headPortrait=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg";break}if(e.userList[s].img&&0==e.userList[s].examineStatus){e.headPortrait=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+e.userList[s].img;break}if(!e.userList[s].img&&0==e.userList[s].examineStatus){e.headPortrait=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg";break}}3==e.stepType&&e.userList.forEach(function(e,a){e.img?e.headPortrait=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+e.img:e.headPortrait=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg"})}),t.hasCheck=e.data.isCheck,t.hasRecheck=e.data.isRecheck,t.showLaunch=!0}).catch(function(t){}),o()({method:"get",url:t.$store.state.defaultHttp+"examineLog/queryExamineLogList.do?cId="+t.$store.state.iscId+"&recordId="+t.examineDetail.examineRecordId}).then(function(e){t.examineLog=e.data}).catch(function(t){})},loadTable:function(){var t=this,e=a("1nuA"),s={};s.page=this.page,s.limit=this.limit,o()({method:"post",url:t.$store.state.defaultHttp+"oaExamine/selectList.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){var a=e.data.map.success;a.forEach(function(t){var e=t.timeConsuming,a=parseInt(e/24),s=parseInt(e%24);t.takeupTime=a+"天"+s+"小时";var i=t.createTime.slice(0,10),n=new RegExp("-","g");t.cTime=i.replace(n,"")}),t.tableDatas=a,t.tableNumber=e.data.count}).catch(function(t){})},clickLaunch:function(){var t=this,e=a("1nuA");console.log(this.examineDetail);var s={id:this.examineDetail.id,pid:this.$store.state.ispId,categoryId:this.examineDetail.category_id,type:"4",secondid:this.$store.state.deptid};o()({method:"post",url:t.$store.state.defaultHttp+"oaExamine/saveOaExamineRecord.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){e.data.code&&"200"==e.data.code?(t.$message({message:"成功",type:"success"}),t.showLaunch=!0,t.$options.methods.loadData.bind(t)()):t.$message({message:e.data.msg,type:"error"})}).catch(function(t){})},showImg:function(t){this.dialogImageUrl=this.examineDetail.imageUrl,this.dialogVisible=!0},showexamine:function(t){this.exaform.status=t,this.dialogVisibleexa=!0},toexamine:function(){var t=this,e=a("1nuA"),s={};s.id=this.detailData.id,s.recordId=this.examineDetail.examineRecordId,s.pId=this.$store.state.ispId,s.status=this.exaform.status,s.remarks=this.exaform.remarks;var i=!1;s.remarks||(t.$message({message:"审核意见不能为空",type:"error"}),i=!0),i||o()({method:"post",url:t.$store.state.defaultHttp+"examineRecord/auditExamine.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){e.data.code&&"200"==e.data.code?(t.$message({message:"操作成功",type:"success"}),t.dialogVisibleexa=!1,t.exaform.status=null,t.exaform.remarks=null,t.$options.methods.loadData.bind(t)()):t.$message({message:e.data.msg,type:"error"})}).catch(function(e){t.$message.error("审核失败，请稍后再试")})},getRow:function(t,e){this.$store.state.examinedetailData={id:e.id,category_id:e.category_id},this.$options.methods.loadData.bind(this)(!0)},search:function(){this.$options.methods.loadData.bind(this)()},handleSizeChange:function(t){this.limit=t,this.$options.methods.loadData.bind(this)()},handleCurrentChange:function(t){this.page=t,this.$options.methods.loadData.bind(this)()}}}),r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"agrdetcontent",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"top"},[a("el-card",{staticClass:"box-card",model:{value:t.examineDetail,callback:function(e){t.examineDetail=e},expression:"examineDetail"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"bold_span"},[t._v(t._s(t.examineDetail.category+"审核-"+t.examineDetail.private_employee+"-"+t.examineDetail.cTime))]),t._v(" "),!t.showLaunch&&t.isSelf?a("el-button",{staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:t.clickLaunch}},[t._v("发起")]):t._e()],1),t._v(" "),a("div",{staticClass:"table_div"},[a("ul",{staticClass:"flex_50_ul"},[t._l(t.fieldData,function(e,s){return a("li",{key:s,style:{flex:2==e.type?"0 0 100%":""}},[a("span",{staticClass:"block_bg_span",style:{"line-height":2==e.type?"90px":"",width:2==e.type?"20%":""}},[t._v(t._s(e.name))]),t._v(" "),a("span",{staticClass:"block_span",style:{width:2==e.type?"70%":""}},[t._v(t._s(e.value))])])}),t._v(" "),a("li",[a("span",{staticClass:"block_bg_span"},[t._v("制单人")]),t._v(" "),a("span",{staticClass:"block_span"},[t._v(t._s(t.examineDetail.private_employee))])]),t._v(" "),a("li",[a("span",{staticClass:"block_bg_span"},[t._v("部门")]),t._v(" "),a("span",{staticClass:"block_span"},[t._v(t._s(t.examineDetail.deptname))])]),t._v(" "),a("li",[a("span",{staticClass:"block_bg_span"},[t._v("机构")]),t._v(" "),a("span",{staticClass:"block_span"},[t._v(t._s(t.examineDetail.parentname))])]),t._v(" "),a("li",[a("span",{staticClass:"block_bg_span"},[t._v("创建时间")]),t._v(" "),a("span",{staticClass:"block_span"},[t._v(t._s(t.examineDetail.createTime))])])],2),t._v(" "),a("ul",{staticClass:"flex_50_ul"},[a("li",{staticStyle:{"border-top":"0"}},[a("span",{staticClass:"block_bg_span",staticStyle:{"line-height":"100px"}},[t._v("图片")]),t._v(" "),a("span",[a("img",{staticStyle:{"vertical-align":"top"},attrs:{src:t.examineDetail.imageUrl,alt:"",width:"100",height:"100"},on:{click:t.showImg}})])]),t._v(" "),a("li",{staticStyle:{"border-top":"0"}},[a("span",{staticClass:"block_bg_span",staticStyle:{"line-height":"100px"}},[t._v("附件")]),t._v(" "),a("span",{staticClass:"block_span"},[a("a",{attrs:{href:t.examineDetail.fileUrl,dowmload:""}},[t._v(t._s(t.examineDetail.file_name))])])])]),t._v(" "),1==t.examineDetail.checkStatus?a("div",{staticClass:"agreeaudited"},[a("img",{staticClass:"audited_img",attrs:{src:t.auditing,alt:"审核中"}})]):t._e(),t._v(" "),2==t.examineDetail.checkStatus?a("div",{staticClass:"agreeaudited"},[a("img",{staticClass:"audited_img",attrs:{src:t.audited,alt:"已审核"}})]):t._e(),t._v(" "),3==t.examineDetail.checkStatus?a("div",{staticClass:"agreeaudited"},[a("img",{staticClass:"audited_img",attrs:{src:t.noaudit,alt:"未通过"}})]):t._e()])])],1),t._v(" "),t.showLaunch?a("div",{staticClass:"top"},[a("el-card",{staticClass:"box-card",model:{value:t.examineDetail,callback:function(e){t.examineDetail=e},expression:"examineDetail"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("el-popover",{attrs:{placement:"right-start",width:"220",trigger:"click"}},[a("div",{staticStyle:{"max-height":"400px","overflow-y":"overlay"}},t._l(t.examineLog,function(e,s){return a("div",{key:s,staticClass:"examine_popover"},[a("span",{staticClass:"examine_ico"},[0==e.examineStatus?a("i",{staticClass:"el-icon-time",staticStyle:{"font-size":"20px"}}):t._e(),t._v(" "),1==e.examineStatus?a("i",{staticClass:"el-icon-circle-check-outline",staticStyle:{color:"#67c23a","font-size":"20px"}}):t._e(),t._v(" "),2==e.examineStatus?a("i",{staticClass:"el-icon-circle-close-outline",staticStyle:{color:"#f56c6c","font-size":"20px"}}):t._e(),t._v(" "),3==e.examineStatus?a("i",{staticClass:"el-icon-time",staticStyle:{color:"#e6a23c","font-size":"20px"}}):t._e(),t._v(" "),5==e.examineStatus?a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{color:"#67c23a","font-size":"20px"}}):t._e()]),t._v(" "),a("div",{staticClass:"examint_msg"},[a("p",{staticStyle:{"font-size":"13px",color:"#aaaaaa"}},[t._v(t._s(e.examineTime))]),t._v(" "),1==e.examineStatus?a("p",[t._v(t._s(e.realname+" 已审核"))]):t._e(),t._v(" "),2==e.examineStatus?a("p",[t._v(t._s(e.realname+" 已拒绝"))]):t._e(),t._v(" "),a("div",{staticClass:"examint_remark"},[a("p",[t._v(t._s(e.remarks))])])])])})),t._v(" "),a("span",{staticStyle:{"font-size":"14px","text-decoration":"underline"},attrs:{slot:"reference"},slot:"reference"},[t._v("查看审核历史")])]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasCheck&&2!==t.examineDetail.checkStatus,expression:"hasCheck && examineDetail.checkStatus !== 2"}],staticClass:"info-btn",staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(e){t.showexamine(1)}}},[t._v("通过")]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasCheck&&2!==t.examineDetail.checkStatus,expression:"hasCheck && examineDetail.checkStatus !== 2"}],staticClass:"info-btn",staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(e){t.showexamine(2)}}},[t._v("拒绝")]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasCheck,expression:"hasCheck"}],staticClass:"info-btn",staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(e){t.showexamine(4)}}},[t._v("驳回")])],1),t._v(" "),a("div",{staticClass:"text item"},[a("div",{staticClass:"examine_c"},t._l(t.examineList,function(e,s){return a("div",{key:s,staticClass:"examine_item"},[a("el-popover",{staticClass:"examine_cont",attrs:{placement:"bottom",width:"220",trigger:"hover"}},[t._l(e.userList,function(e,s){return a("div",{key:s,staticClass:"examine_popover"},[a("span",{staticClass:"examine_ico"},[0==e.examineStatus?a("i",{staticClass:"el-icon-time",staticStyle:{"font-size":"20px"}}):t._e(),t._v(" "),1==e.examineStatus?a("i",{staticClass:"el-icon-success",staticStyle:{color:"#67c23a","font-size":"18px"}}):t._e(),t._v(" "),2==e.examineStatus?a("i",{staticClass:"el-icon-circle-close",staticStyle:{color:"#f56c6c","font-size":"20px"}}):t._e(),t._v(" "),3==e.examineStatus?a("i",{staticClass:"el-icon-time",staticStyle:{color:"#e6a23c","font-size":"20px"}}):t._e(),t._v(" "),5==e.examineStatus?a("i",{staticClass:"el-icon-circle-plus",staticStyle:{color:"#67c23a","font-size":"20px"}}):t._e()]),t._v(" "),a("div",{staticClass:"examint_msg"},[a("p",{staticStyle:{"font-size":"13px",color:"#aaaaaa"}},[t._v(t._s(e.examineTime))]),t._v(" "),a("span",[t._v(t._s(e.realname+"("+e.phone+")"))]),t._v(" "),0==e.examineStatus?a("p",[t._v("未审核此申请")]):t._e(),t._v(" "),1==e.examineStatus?a("p",[t._v("通过此申请")]):t._e(),t._v(" "),2==e.examineStatus?a("p",[t._v("拒绝此申请")]):t._e(),t._v(" "),5==e.examineStatus?a("p",[t._v("创建此申请")]):t._e()])])}),t._v(" "),a("div",{staticStyle:{width:"100%"},attrs:{slot:"reference"},slot:"reference"},[5==e.examineStatus||4==e.examineStatus?a("span",{staticClass:"examine_po"},[a("img",{staticClass:"examine_img",attrs:{src:e.headPortrait,width:"50",height:"50"}})]):t._e(),t._v(" "),2==e.stepType?a("span",{staticClass:"examine_po1"},[a("img",{staticClass:"examine_img",class:{mohu:1!==e.examineStatus},attrs:{src:e.headPortrait,width:"50",height:"50"}})]):t._e(),t._v(" "),3==e.stepType?a("div",{staticStyle:{display:"inline-block",margin:"0 15px"},style:e.type_style},t._l(e.userList,function(t,e){return a("span",{key:e,staticClass:"examine_po2"},[a("img",{staticClass:"examine_img",class:{mohu:0==t.examineStatus},attrs:{src:t.headPortrait,width:"50",height:"50"}})])})):t._e(),t._v(" "),a("br"),t._v(" "),e.examineUserName?a("span",{staticClass:"examine_type"},[t._v(t._s(e.examineUserName))]):t._e(),t._v(" "),2==e.stepType?a("span",{staticClass:"examine_type"},[t._v(t._s(e.userLength+"人或签"))]):t._e(),t._v(" "),3==e.stepType?a("span",{staticClass:"examine_type"},[t._v(t._s(e.userLength+"人会签"))]):t._e(),t._v(" "),a("br"),t._v(" "),0==e.examineStatus&&1==s?a("span",{staticClass:"examine_status"},[t._v("一级审核")]):t._e(),t._v(" "),0==e.examineStatus&&2==s?a("span",{staticClass:"examine_status"},[t._v("二级审核")]):t._e(),t._v(" "),0==e.examineStatus&&3==s?a("span",{staticClass:"examine_status"},[t._v("三级审核")]):t._e(),t._v(" "),0==e.examineStatus&&4==s?a("span",{staticClass:"examine_status"},[t._v("四级审核")]):t._e(),t._v(" "),0==e.examineStatus&&5==s?a("span",{staticClass:"examine_status"},[t._v("五级审核")]):t._e(),t._v(" "),0==e.examineStatus&&6==s?a("span",{staticClass:"examine_status"},[t._v("六级审核")]):t._e(),t._v(" "),1==e.examineStatus?a("span",{staticClass:"examine_status"},[a("i",{staticClass:"el-icon-success",staticStyle:{color:"#67c23a","font-size":"15px"}}),t._v(" 已审核")]):t._e(),t._v(" "),2==e.examineStatus?a("span",{staticClass:"examine_status"},[a("i",{staticClass:"el-icon-circle-close",staticStyle:{color:"#f56c6c","font-size":"18px"}}),t._v(" 未通过")]):t._e(),t._v(" "),3==e.examineStatus?a("span",{staticClass:"examine_status"},[a("i",{staticClass:"el-icon-time",staticStyle:{color:"#e6a23c","font-size":"18px"}}),t._v(" 审核中")]):t._e(),t._v(" "),5==e.examineStatus?a("span",{staticClass:"examine_status"},[a("i",{staticClass:"el-icon-circle-plus",staticStyle:{color:"#67c23a","font-size":"18px"}}),t._v(" 发起")]):t._e()])],2),t._v(" "),s!==t.examineList.length-1?a("span",{staticClass:"examine_next"},[a("i",{staticClass:"el-icon-arrow-right"})]):t._e()],1)}))])])],1):t._e()]),t._v(" "),a("el-col",{staticClass:"right",staticStyle:{padding:"10px","min-height":"635px"},attrs:{span:6}},[a("div",{staticClass:"searchList",staticStyle:{width:"100%"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入标题名称"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null}},model:{value:t.searchList.keyword,callback:function(e){t.$set(t.searchList,"keyword",e)},expression:"searchList.keyword"}}),t._v(" "),a("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"mini"},on:{click:function(e){t.search()}}})],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableDatas}},[a("el-table-column",{attrs:{label:"标题",prop:"poolName"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{on:{click:function(a){t.getRow(e.$index,e.row)}}},[t._v("\n                    "+t._s(e.row.category+"审核-"+e.row.private_employee+"-"+e.row.cTime)+"\n                ")])]}}])})],1),t._v(" "),a("div",{staticClass:"block numberPage number"},[a("el-pagination",{attrs:{"current-page":t.page,"page-sizes":[20,30,50,100],"page-size":20,layout:"total, sizes, prev, next",total:t.tableNumber},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"审核意见",visible:t.dialogVisibleexa,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(e){t.dialogVisibleexa=e}}},[a("el-form",{ref:"exaform",attrs:{model:t.exaform,rules:t.rules}},[a("el-form-item",{attrs:{prop:"remarks"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入审核意见（必填）"},model:{value:t.exaform.remarks,callback:function(e){t.$set(t.exaform,"remarks",e)},expression:"exaform.remarks"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisibleexa=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.toexamine()}}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]};var m=a("VU/8")(c,r,!1,function(t){a("yCUU")},null,null);e.default=m.exports},yCUU:function(t,e){}});