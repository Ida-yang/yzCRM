webpackJsonp([18],{UjdE:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("woOf"),o=a.n(s),r=a("INCx"),n=a.n(r),l=a("wtEF"),i=a("mtWM"),c=a.n(i),d=(a("mw3O"),{name:"agreement",props:{totalNum:Number},store:l.a,computed:{tableData:function(){return l.a.state.agreementList},tableNumber:function(){return l.a.state.agreementListnumber}},filters:{rounding:function(t){if(t){var e=n()(t).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"),a=".00",s=t.toString().split(".");return 2===s.length?1===(a=s[1].toString()).length?e+"."+a+"0":e+"."+a:e+a}}},data:function(){return{fieldHeadData:[],searchList:{searchName:null,type:null,label:"1",example:"0"},searchListNew:{searchName:null,type:null,label:"1",example:"0"},pIdData:[{label:"0",value:"全部"},{label:"1",value:"我的"},{label:"2",value:"本组"},{label:"3",value:"本机构"},{label:"4",value:"待我审核"}],agreementTime:[{id:"0",name:"全部"},{id:"1",name:"本月签约"},{id:"2",name:"近一个月到期"},{id:"3",name:"已过期"}],typeData:[{id:"1",name:"服务合同"},{id:"2",name:"销售合同"},{id:"3",name:"代理合同"},{id:"4",name:"其他"}],nullvalue:null,page:1,limit:20,idArr:{ids:null},filterList:null,checklist:null,formLabelWidth:"130px"}},mounted:function(){this.loadFieldHead(),this.reloadTable(),this.reloadData()},activated:function(){this.loadFieldHead(),this.reloadTable()},methods:{reloadTable:function(){var t=this,e=a("1nuA"),s={};0==this.searchList.label||(1==this.searchList.label?s.pId=t.$store.state.ispId:2==this.searchList.label?s.secondid=t.$store.state.deptid:3==this.searchList.label?s.deptid=t.$store.state.insid:(this.searchList.label=4)&&(s.examine=t.$store.state.ispId)),s.searchName=this.searchList.searchName,s.example=this.searchList.example,s.type=this.searchList.type,s.page=this.page,s.limit=this.limit,s.label=6,c()({method:"post",url:t.$store.state.defaultHttp+"pageInfo/queryPageList.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){var a=e.data.map.success;t.$store.state.agreementList=a,t.$store.state.agreementListnumber=e.data.count}).catch(function(t){})},loadFieldHead:function(){var t=this,e=a("1nuA"),s={label:6,pId:this.$store.state.ispId};c()({method:"post",url:t.$store.state.defaultHttp+"field/queryListHead.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){t.fieldHeadData=e.data}).catch(function(t){})},reloadData:function(){var t=this,e=a("1nuA"),s={type:"合同"},o={type:"合同",state:1};c()({method:"post",url:t.$store.state.defaultHttp+"userPageInfo/getAllUserPage.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(s)}).then(function(e){t.filterList=e.data}).catch(function(t){}),c()({method:"post",url:t.$store.state.defaultHttp+"userPageInfo/getUserPage.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(o)}).then(function(e){t.checklist=e.data}).catch(function(t){})},selectInfo:function(t){this.multipleSelection=t;var e=t,a=[new Array];e.forEach(function(t){0!=t.contract_id&&a.push(t.contract_id)}),this.idArr.ids=a},openDetails:function(t,e){var a={};a.submitData={id:e.contract_id},this.$store.state.agreedetailsData=a,this.$router.push({path:"/agreementDetails"})},handleDeletes:function(){var t=this,e=a("1nuA"),s=[];s.ids=this.idArr.ids,s.ids?t.$confirm("是否确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){a.value;c()({method:"post",url:t.$store.state.defaultHttp+"delContract.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){e.data&&"success"==e.data?(t.$message({message:"删除成功",type:"success"}),t.$options.methods.reloadTable.bind(t)(!0)):e.data.msg&&"error"==e.data.msg?t.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):t.$message({message:e.data,type:"error"})}).catch(function(){t.$message({type:"info",message:"取消删除"})})}):t.$message({type:"error",message:"请先选择要删除的合同"})},handleAdd:function(){var t={},e=this;t.createForm=[{label:"合同类型",inputModel:"contract_type",type:"select",options:[{okey:"0",olabel:"销售合同",ovalue:"销售合同"},{okey:"2",olabel:"服务合同",ovalue:"服务合同"},{okey:"3",olabel:"代理合同",ovalue:"代理合同"},{okey:"4",olabel:"其他",ovalue:"其他"}]},{label:"合同名称",inputModel:"contract_name"},{label:"客户",inputModel:"customerpool_id",type:"require"},{label:"对应商机",inputModel:"opportunity_id",type:"select"},{label:"合同金额",inputModel:"amount",type:"number"},{label:"开始时间",inputModel:"start_date",type:"date"},{label:"结束时间",inputModel:"end_date",type:"date"},{label:"客户签约人",inputModel:"signatories",type:"select"},{label:"我方签约人",inputModel:"our_signatories",disabled:!0},{label:"备注",inputModel:"remarks",type:"textarea"}],t.setForm={contract_type:"",contract_name:"",customerpool_id:"",opportunity_id:"",amount:"",start_date:"",end_date:"",signatories:"",our_signatories:this.$store.state.user,remarks:""},t.submitURL=this.$store.state.defaultHttp+"insertContract.do?cId="+this.$store.state.iscId,this.$store.state.agreeaddOrUpdateData=t,c()({method:"get",url:e.$store.state.defaultHttp+"contractJurisdiction/insert.do"}).then(function(t){t.data.msg&&"error"==t.data.msg?e.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):e.$router.push({path:"/agreementaddorupdate"})}).catch(function(t){})},handleEdit:function(t,e){var a=this,s={createForm:[{label:"合同类型",inputModel:"contract_type",type:"select",options:[{okey:"0",olabel:"销售合同",ovalue:"销售合同"},{okey:"2",olabel:"服务合同",ovalue:"服务合同"},{okey:"3",olabel:"代理合同",ovalue:"代理合同"},{okey:"4",olabel:"其他",ovalue:"其他"}]},{label:"合同名称",inputModel:"contract_name"},{label:"客户",inputModel:"customerpool_id",type:"require"},{label:"对应商机",inputModel:"opportunity_id",type:"select"},{label:"合同金额",inputModel:"amount",type:"number"},{label:"开始时间",inputModel:"start_date",type:"date"},{label:"结束时间",inputModel:"end_date",type:"date"},{label:"客户签约人",inputModel:"signatories",type:"select"},{label:"我方签约人",inputModel:"our_signatories",disabled:!0},{label:"备注",inputModel:"remarks",type:"textarea"}]};s.setForm={contract_type:e.contract_type,contract_name:e.contract_name,customerpool_id:e.customerpool_id,poolName:e.poolName,opportunity_id:e.opportunity_name,opportunity_name:e.opportunity_id,amount:e.amount,start_date:e.start_date,end_date:e.end_date,signatories:e.signatories,our_signatories:e.our_signatories,our_signatoriesId:e.pId,remarks:e.remarks},s.submitData={id:e.contract_id,batch_id:e.batch_id},s.submitURL=this.$store.state.defaultHttp+"updateContract.do?cId="+this.$store.state.iscId,this.$store.state.agreeaddOrUpdateData=s,c()({method:"get",url:a.$store.state.defaultHttp+"contractJurisdiction/update.do"}).then(function(t){t.data.msg&&"error"==t.data.msg?a.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):a.$router.push({path:"/agreementaddorupdate"})}).catch(function(t){})},handleDelete:function(t,e){var s=this,o=this,r=a("1nuA"),n=[];n.ids=e.contract_id,o.$confirm("是否确认删除["+e.contract_name+"]？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){t.value;c()({method:"post",url:o.$store.state.defaultHttp+"delContract.do?cId="+o.$store.state.iscId,data:r.stringify(n)}).then(function(t){t.data&&"success"==t.data?(o.$message({message:"删除成功",type:"success"}),o.$options.methods.reloadTable.bind(o)(!0)):t.data.msg&&"error"==t.data.msg?o.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):o.$message({message:t.data,type:"error"})}).catch(function(t){o.$message.error("删除失败，请重新操作")})}).catch(function(){s.$message({type:"info",message:"取消删除["+e.contract_name+"]"})})},hangleChange:function(t,e){var s=this,o=a("1nuA"),r={};r.pageInfoId=e.pageInfoId,r.state=1==t?1:0,c()({method:"post",url:s.$store.state.defaultHttp+"userPageInfo/updateUserPageByid.do?cId="+s.$store.state.iscId+"&pId="+s.$store.state.ispId,data:o.stringify(r)}).then(function(t){t.data&&"success"==t.data&&s.$options.methods.reloadData.bind(s)(!0)}).catch(function(t){s.$message.error("提交失败，请重新提交")})},getSummaries:function(t){var e=t.columns,a=t.data,s=[];return e.forEach(function(t,e){if(0!==e){var o=a.map(function(e){return Number(e[t.property])});if("amount"==t.property||"already"==t.property||"surplus"==t.property){s[e]=o.reduce(function(t,e){return e+t},0),s[e]=s[e].toFixed(2);var r=n()(s[e]).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"),l=".00",i=s[e].split(".");2===i.length?1===(l=i[1].toString()).length?s[e]=r+"."+l+"0":s[e]=r+"."+l:s[e]=r+l,s[e]+=" 元"}else s[e]=""}else s[e]="合计"}),s},search:function(){var t=this,e=(a("1nuA"),""),s=1;0==this.searchList.label?(e="contractJurisdiction/all.do",s=0):2==this.searchList.label?(e="contractJurisdiction/second.do",s=0):3==this.searchList.label&&(e="contractJurisdiction/dept.do",s=0),0==s?c()({method:"get",url:t.$store.state.defaultHttp+e}).then(function(e){e.data.msg&&"error"==e.data.msg?t.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):t.$options.methods.reloadTable.bind(t)(!0)}).catch(function(e){t.$message.error("查询失败，请重新查询")}):t.$options.methods.reloadTable.bind(t)(!0)},reset:function(){this.searchList=o()({},this.searchListNew),this.$options.methods.reloadTable.bind(this)(!0)},handleSizeChange:function(t){this.limit=t,this.$options.methods.reloadTable.bind(this)(!1)},handleCurrentChange:function(t){this.page=t,this.$options.methods.reloadTable.bind(this)(!1)}}}),u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"radioList"},[a("el-radio-group",{model:{value:t.searchList.label,callback:function(e){t.$set(t.searchList,"label",e)},expression:"searchList.label"}},[a("span",{staticClass:"nameList"},[t._v("数据授权：")]),t._v(" "),t._l(t.pIdData,function(e){return a("el-radio",{key:e.label,attrs:{label:e.label},on:{change:function(e){t.search()}}},[t._v(t._s(e.value))])})],2),t._v(" "),a("el-radio-group",{model:{value:t.searchList.type,callback:function(e){t.$set(t.searchList,"type",e)},expression:"searchList.type"}},[a("span",{staticClass:"nameList"},[t._v("合同类型：")]),t._v(" "),a("el-radio",{attrs:{label:t.nullvalue},on:{change:function(e){t.search()}}},[t._v("全部")]),t._v(" "),t._l(t.typeData,function(e,s){return a("el-radio",{key:s,attrs:{label:e.name},on:{change:function(e){t.search()}}},[t._v(t._s(e.name))])})],2),t._v(" "),a("el-radio-group",{model:{value:t.searchList.example,callback:function(e){t.$set(t.searchList,"example",e)},expression:"searchList.example"}},[a("span",{staticClass:"nameList"},[t._v("到期合同：")]),t._v(" "),t._l(t.agreementTime,function(e,s){return a("el-radio",{key:s,attrs:{label:e.id},on:{change:function(e){t.search()}}},[t._v(t._s(e.name))])})],2)],1),t._v(" "),a("div",{staticClass:"searchList",staticStyle:{width:"100%"}},[a("span",{staticClass:"nameList"},[t._v("公司名称：")]),t._v(" "),a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入公司名称"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null}},model:{value:t.searchList.searchName,callback:function(e){t.$set(t.searchList,"searchName",e)},expression:"searchList.searchName"}}),t._v("\n          \n        "),a("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"mini"},on:{click:function(e){t.search()}}},[t._v("查询")])],1),t._v(" "),a("div",{staticClass:"entry"},[a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini"},on:{click:function(e){t.handleAdd()}}},[t._v("新增")]),t._v(" "),a("el-button",{staticClass:"btn",attrs:{size:"mini"},on:{click:function(e){t.handleDeletes()}}},[t._v("删除")]),t._v(" "),a("div",{staticClass:"totalnum_head"},[t._v("共 "),a("span",{staticClass:"bold_span"},[t._v(t._s(t.tableNumber))]),t._v(" 条")]),t._v(" "),a("el-popover",{attrs:{placement:"bottom",width:"100",trigger:"click"}},[a("el-checkbox-group",{staticClass:"checklist",staticStyle:{"max-height":"600px","overflow-y":"overlay","overflow-x":"hidden"},model:{value:t.checklist,callback:function(e){t.checklist=e},expression:"checklist"}},t._l(t.filterList,function(e){return a("el-checkbox",{key:e.id,staticClass:"checkone",attrs:{label:e.name,value:e.state},on:{change:function(a){t.hangleChange(a,e)}}})})),t._v(" "),a("el-button",{staticClass:"info-btn screen",attrs:{slot:"reference",icon:"el-icon-more",type:"mini"},slot:"reference"})],1)],1),t._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","text-align":"left"},attrs:{data:t.tableData,border:"",stripe:"","summary-method":t.getSummaries,"show-summary":""},on:{"selection-change":t.selectInfo}},[a("el-table-column",{attrs:{fixed:"","header-align":"center",align:"center",type:"selection",width:"45","scope.row.contract_id":"",prop:"contract_id"},on:{"selection-change":t.selectInfo}}),t._v(" "),t._l(t.filterList,function(e,s){return a("div",{key:s},["contract_number"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"合同编号",prop:"contract_number",fixed:"","min-width":"150",sortable:""}}):t._e(),t._v(" "),"contract_name"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"合同名称",prop:"contract_name",fixed:"","min-width":"150",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"hoverline",on:{click:function(a){t.openDetails(e.$index,e.row)}}},[t._v("\n                        "+t._s(e.row.contract_name)+"\n                    ")])]}}])}):t._e(),t._v(" "),"contract_type"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"合同类型",prop:"contract_type","min-width":"110",sortable:""}}):t._e(),t._v(" "),"poolName"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"公司名称",prop:"poolName","min-width":"200",sortable:""}}):t._e(),t._v(" "),"opportunity_id"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"商机名称",prop:"opportunity_name","min-width":"150",sortable:""}}):t._e(),t._v(" "),"amount"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"合同金额",prop:"amount","min-width":"125",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("rounding")(e.row.amount))+"\n                ")]}}])}):t._e(),t._v(" "),"already"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"已回款金额",prop:"already","min-width":"120",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("rounding")(e.row.already))+"\n                ")]}}])}):t._e(),t._v(" "),"surplus"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"剩余金额",prop:"surplus","min-width":"130",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("rounding")(e.row.surplus))+"\n                ")]}}])}):t._e(),t._v(" "),"start_date"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"合同开始日期",prop:"start_date","min-width":"130",sortable:""}}):t._e(),t._v(" "),"end_date"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"合同到期日期",prop:"end_date","show-overflow-tooltip":"","min-width":"130",sortable:""}}):t._e(),t._v(" "),"expireDay"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"剩余天数",prop:"expireDay","min-width":"110",sortable:""}}):t._e(),t._v(" "),"signatories"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"客户签约人",prop:"signatories","min-width":"120",sortable:""}}):t._e(),t._v(" "),"our_signatories"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"我方签约人",prop:"our_signatories","min-width":"120",sortable:""}}):t._e(),t._v(" "),"state"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"状态",prop:"approvalStatus",width:"90",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.checkStatus?a("el-tag",{staticStyle:{"background-color":"#ffffff",color:"#606266","border-color":"#dcdfe6"},attrs:{size:"small",effect:"dark"}},[t._v("待审核")]):t._e(),t._v(" "),1==e.row.checkStatus?a("el-tag",{staticStyle:{"background-color":"#e6a23c",color:"#ffffff","border-color":"#e6a23c"},attrs:{size:"small",effect:"dark"}},[t._v("审核中")]):t._e(),t._v(" "),2==e.row.checkStatus?a("el-tag",{staticStyle:{"background-color":"#67c23a",color:"#ffffff","border-color":"#67c23a"},attrs:{size:"small",effect:"dark"}},[t._v("已审核")]):t._e(),t._v(" "),3==e.row.checkStatus?a("el-tag",{staticStyle:{"background-color":"#f56c6c",color:"#ffffff","border-color":"#f56c6c"},attrs:{size:"small",effect:"dark"}},[t._v("未通过")]):t._e()]}}])}):t._e(),t._v(" "),"deptname"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"部门",prop:"deptname","min-width":"90",sortable:""}}):t._e(),t._v(" "),"parentname"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"机构",prop:"parentname","min-width":"100","show-overflow-tooltip":"",sortable:""}}):t._e(),t._v(" "),"createTime"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"创建时间",prop:"create_time","min-width":"150",sortable:""}}):t._e(),t._v(" "),"remarks"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"备注",prop:"remarks",sortable:"","min-width":"180"}}):t._e(),t._v(" "),t._l(t.fieldHeadData,function(s){return e.prop==s.field_name&&1==e.state?a("el-table-column",{key:s.field_name,attrs:{label:s.name,prop:s.field_name,"min-width":"130",sortable:""}}):t._e()})],2)}),t._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",disabled:e.row.disabledBtn},on:{click:function(a){t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{size:"mini",disabled:e.row.disabledBtn,type:"danger"},on:{click:function(a){t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],2),t._v(" "),a("div",{staticClass:"block numberPage"},[a("el-pagination",{attrs:{"current-page":t.page,"page-sizes":[20,50,100,500],"page-size":20,layout:"total, sizes, prev, pager, next, jumper",total:t.tableNumber},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var p=a("VU/8")(d,u,!1,function(t){a("rNqx")},null,null);e.default=p.exports},rNqx:function(t,e){}});