webpackJsonp([13],{"/j3N":function(t,e){},tqso:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("bOdI"),s=a.n(o),i=a("INCx"),n=a.n(i),l=a("wtEF"),r=a("mtWM"),c=a.n(r),d=(a("mw3O"),a("PQp9")),u={name:"businessOpportunityDetails",store:l.a,components:{UE:d.a},filters:{commaing:function(t){if(t){var e=n()(t).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"),a=".00",o=t.toString().split(".");return 2===o.length?1===(a=o[1].toString()).length?e+"."+a+"0":e+"."+a:e+a}}},data:function(){var t;return t={pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},searchList:{keyword:null},opportunitydetail:{},fieldData:[],contacts:{},customerpool:{},customerId:null,privateUser:{},contractTime:null,failTime:null,tableDatas:null,tableNumber:null,page:1,limit:20,thisshow:!0,idArr:{opportunity_id:null},active:0,stepList:null,steptime:null,addstep:null,shownext:!0,showfail:!1,showsuccess:!1,showcreate:!1,showdurate:!1,isprocess:"process",retracts:!0,auxList:{},auxcontent:!1,rules:{followContent:[{required:!0,message:"请输入跟进内容",trigger:"blur"}],contactsId:[{required:!0,message:"请选择联系人",trigger:"blur"}],followType:[{required:!0,message:"请选择联系方式",trigger:"blur"}]},followform:{followType:"电话",contactTime:"",contactsId:"",followContent:"",imgName:null,enclosureName:null},followTypes:[{label:"电话",value:"1"},{label:"微信",value:"2"},{label:"QQ",value:"3"},{label:"邮箱",value:"4"},{label:"拜访",value:"5"}],fastcontactList:null,files:null,filesName:null,imgfile:null,imgName:null,filesList:[],imgList:[],record:[],dialogVisible2:!1,dialogImageUrl2:null,contactData:[],competitorData:[],aaa:0,bbb:0,ccc:0,ddd:0,fff:0,ggg:0,dialogVisible:!1,opportunityDeal:null,dialogVisible3:!1,reasonsForFailure:[],codeSnippet:null,defaultMsg:"",config:{initialFrameWidth:"",initialFrameHeight:200,toolbars:[["bold","|","insertorderedlist","insertunorderedlist","|","justifyleft","justifycenter","justifyright","justifyjustify","|"]],elementPathEnabled:!1,wordCount:!1},baseindex:"first",showauxAnalys:!0,failReasonData:[],itemData:[{id:10,productImg:null,amountOfMoney:null,commitTime:null,brand:null,discount:null,discountAfter:null,discountAmount:null,tbGoods:{goodsName:"",describe:""},num:null,price:null,taxAfter:null,taxAmount:null,taxRate:null,unit:null,edit:!1,remarks1:null,remarks2:null}],list:null,selectData:[],scopeIndex:"",cusdiscount:null,custaxRate:null,OKdisabled:!0,classification_id:null,goodsName:null,dialogVisible1:!1,tableData:[],itemList:[],multipleSelection:[]},s()(t,"idArr",[]),s()(t,"datalist",[]),s()(t,"defaultProps",{label:"name",children:"next"}),s()(t,"defaultkeys",[1]),s()(t,"nodeChange",!1),s()(t,"updateData",[]),s()(t,"productData",{}),s()(t,"isDisable",!1),s()(t,"competitorList",[]),s()(t,"filterList",null),s()(t,"checklist",null),t},activated:function(){this.loadTable(),this.loadData(),this.getList(),this.reloadData()},methods:{loadTable:function(){this.idArr.opportunity_id=this.$store.state.oppdetailsData.submitData.id;var t=this,e=a("1nuA"),o={};o.page=this.page,o.limit=this.limit;var s={type:"失败原因"},i={page:1,limit:999999999},n={type:"快捷方式"};c()({method:"post",url:t.$store.state.defaultHttp+"opportunity/query.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(o)}).then(function(e){t.tableDatas=e.data.map.success,t.tableNumber=e.data.count}).catch(function(t){}),c()({method:"post",url:t.$store.state.defaultHttp+"typeInfo/getTypeInfoGroupByType.do?cId="+t.$store.state.iscId,data:e.stringify(s)}).then(function(e){t.failReasonData=e.data}).catch(function(t){}),c()({method:"get",url:t.$store.state.defaultHttp+"classification/getClassificationNodeTree.do?cId="+t.$store.state.iscId}).then(function(e){t.datalist=e.data.map.success}).catch(function(t){}),c()({method:"post",url:t.$store.state.defaultHttp+"competitor/queryForList.do?cId="+t.$store.state.iscId,data:e.stringify(i)}).then(function(e){t.competitorList=e.data.map.success}).catch(function(t){}),c()({method:"post",url:t.$store.state.defaultHttp+"typeInfo/getTypeInfoGroupByType.do?cId="+t.$store.state.iscId,data:e.stringify(n)}).then(function(e){t.fastcontactList=e.data}).catch(function(t){})},loadData:function(){var t=this,e=a("1nuA"),o={label:5,id:this.idArr.opportunity_id};c()({method:"get",url:t.$store.state.defaultHttp+"opportunity/getopportunityById.do?cId="+t.$store.state.iscId+"&opportunity_id="+t.idArr.opportunity_id}).then(function(e){t.opportunitydetail=e.data.map.success[0],t.opportunitydetail.discount?t.cusdiscount=e.data.map.success[0].discount:t.cusdiscount="100",t.opportunitydetail.taxRate?t.custaxRate=e.data.map.success[0].taxRate:t.custaxRate="0",t.contacts=e.data.map.success[0].contacts[0],t.privateUser=e.data.map.success[0].privateUser[0],t.customerpool=e.data.map.success[0].customerpool[0],t.opportunityDeal=e.data.map.success[0].opportunity_deal,t.customerId=t.customerpool.id,t.stepList=t.opportunitydetail.addstep,t.stepList.length=t.opportunitydetail.addstep.length-1,t.addstep=t.opportunitydetail.opportunityProgress;var a=t.addstep;if(a)for(var o=0,s=a.length;o<s;o++)if(t.stepList[o].createTime=a[o].createTime,t.steptime=a[o].createTime,"0"==a[o].progress_probability?(t.active=o,t.shownext=!1,t.showfail=!0,t.showsuccess=!1,t.isprocess="error",t.failTime=a[o].createTime,t.showauxAnalys=!1):"100"==a[o].progress_probability?(t.active=o+1,t.shownext=!1,t.showfail=!1,t.showsuccess=!0,t.isprocess="wait",t.contractTime=a[o].createTime,t.showauxAnalys=!1):(t.active=o+1,t.shownext=!0,t.showfail=!1,t.showsuccess=!1,t.isprocess="process",t.showauxAnalys=!0),0!==o){if(a[o].previousTime){var i=a[o].previousTime.split(" "),n=a[o].createTime.split(" "),l=new Date(i[0].replace(/-/g,"/")),r=new Date(n[0].replace(/-/g,"/"));t.showcreate=!0,t.showdurate=!0;var c=r.getTime()-l.getTime(),d=Math.floor(c/864e5);t.stepList[o].duration="历时："+d+"天"}}else t.showdurate=!1,t.showcreate=!0;t.auxcontent=!1,t.$options.methods.loadfollow.bind(t)()}).catch(function(e){t.$message.error("商机详情加载失败,请重新进入页面")}),c()({method:"post",url:t.$store.state.defaultHttp+"field/information.do?cId="+t.$store.state.iscId,data:e.stringify(o)}).then(function(e){t.fieldData=e.data}).catch(function(t){}),c()({method:"get",url:t.$store.state.defaultHttp+"opportunity/opportunityAnalysis.do?cId="+t.$store.state.iscId+"&opportunity_id="+t.idArr.opportunity_id}).then(function(e){t.auxList=e.data.map.opportunity,t.aaa=parseFloat(t.auxList.trackProportion),t.bbb=parseFloat(t.auxList.surplusProportion),t.ccc=parseFloat(t.auxList.step_probability),t.ddd=parseFloat(t.auxList.competitorProportion),t.fff=parseFloat(t.auxList.numProportion),t.ggg=parseFloat(t.auxList.contactsProportion)}).catch(function(t){}),t.$options.methods.loadProduct.bind(t)(),t.$options.methods.getCompetitor.bind(t)()},loadProduct:function(){var t=this,e=a("1nuA"),o={};o.opportunity_id=t.idArr.opportunity_id,c()({method:"post",url:t.$store.state.defaultHttp+"order/selectById.do?cId="+t.$store.state.iscId,data:e.stringify(o)}).then(function(e){t.productData=e.data,t.updateData=e.data.orderDetails,t.updateData.forEach(function(e){e.image?e.productImg=t.$store.state.systemHttp+"product/"+t.$store.state.iscId+"/"+e.image:e.productImg="../../../../static/img/noProduct.png"}),t.updateData.length?t.$options.methods.getItem.bind(t)():t.itemData=[{id:10,productImg:null,amountOfMoney:null,commitTime:null,brand:null,discount:null,discountAfter:null,discountAmount:null,tbGoods:{goodsName:"",describe:""},num:null,price:null,taxAfter:null,taxAmount:null,taxRate:null,unit:null,edit:!1,remarks1:null,remarks2:null}]}).catch(function(t){})},loadfollow:function(){var t=this,e=a("1nuA"),o={page:1,limit:1e5};c()({method:"get",url:t.$store.state.defaultHttp+"getFollowByOpportunityIdOrContractId.do?cId="+t.$store.state.iscId+"&opportunity_id="+t.idArr.opportunity_id}).then(function(e){t.record=e.data.map.success,t.record.forEach(function(e){e.showdelico=!1;var a=Date.parse(e.createTime),o=(new Date).getTime()-a;o<72e5&&(e.showdelico=!0),o>72e5&&(e.showdelico=!1),e.userImagName&&(e.imgUrl=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+e.userImagName),e.userImagName&&null!=e.userImagName||(e.imgUrl=t.$store.state.systemHttp+"/upload/staticImg/avatar.jpg"),e.imgName&&null!==e.imgName&&(e.picture_detail=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+e.imgName),e.enclosureName&&null!==e.enclosureName&&(e.enclosureUrl=t.$store.state.systemHttp+"/upload/"+t.$store.state.iscId+"/"+e.enclosureName),e.followContent=e.followContent.replace(/\n/g,"<br/>")})}).catch(function(t){}),c()({method:"post",url:t.$store.state.defaultHttp+"customerpool/getPoolContacts.do?cId="+t.$store.state.iscId+"&customerpool_id="+t.customerId,data:e.stringify(o)}).then(function(e){t.contactData=e.data.map.success,t.followform.contactsId=e.data.map.success[0].id}).catch(function(t){})},reloadData:function(){var t=this,e=a("1nuA"),o={type:"销售订单详情"},s={type:"销售订单详情",state:1};c()({method:"post",url:t.$store.state.defaultHttp+"userPageInfo/getAllUserPage.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(o)}).then(function(e){t.filterList=e.data}).catch(function(t){}),c()({method:"post",url:t.$store.state.defaultHttp+"userPageInfo/getUserPage.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(s)}).then(function(e){t.checklist=e.data}).catch(function(t){})},hangleChange:function(t,e){var o=this,s=a("1nuA"),i={};i.pageInfoId=e.pageInfoId,i.state=1==t?1:0,c()({method:"post",url:o.$store.state.defaultHttp+"userPageInfo/updateUserPageByid.do?cId="+o.$store.state.iscId+"&pId="+o.$store.state.ispId,data:s.stringify(i)}).then(function(t){t.data&&"success"==t.data&&o.$options.methods.reloadData.bind(o)(!0)}).catch(function(t){o.$message.error("提交失败，请重新提交")})},showImg:function(t,e){this.dialogImageUrl2=this.$store.state.systemHttp+"/upload/"+this.$store.state.iscId+"/"+e.imgName,this.dialogVisible2=!0},closeDialog:function(){this.dialogVisible=!1,this.shownext=!0},nextStep:function(){for(var t=this,e=a("1nuA"),o=0,s=this.stepList.length;o<s;o++){var i={};i.previousTime=this.steptime+":00",i.deptid=this.$store.state.insid,i.secondid=this.$store.state.deptid,i.oy_id=this.idArr.opportunity_id,i.opportunityDeal=this.opportunityDeal,t.active==o&&(i.stepId=this.stepList[o].step_id,i.progress_probability=this.stepList[o].step_probability,"100"==i.progress_probability&&(t.shownext=!1),c()({method:"post",url:t.$store.state.defaultHttp+"saveOpportunityProgress.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(i)}).then(function(e){e.data.code&&200==e.data.code?(t.$message({message:"修改成功",type:"success"}),t.active+=1,t.dialogVisible=!1,t.$options.methods.loadData.bind(t)(!0)):t.$message({message:e.data.msg,type:"error"})}).catch(function(e){t.$message.error("修改失败,请重新修改")}))}},endStep:function(){var t=this,e=a("1nuA"),o=this.$refs.ue.getUEContent(),s={};s.previousTime=this.steptime+":00",s.deptid=this.$store.state.insid,s.secondid=this.$store.state.deptid,s.oy_id=this.idArr.opportunity_id,s.stepId=100,s.codeSnippet=o,s.reasonsForFailure=this.reasonsForFailure;var i=!1;s.reasonsForFailure.length||(t.$message({message:"失败原因不能为空",type:"error"}),i=!0),i||c()({method:"post",url:t.$store.state.defaultHttp+"saveOpportunityProgress.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,data:e.stringify(s)}).then(function(e){e.data.code&&200==e.data.code?(t.$message({message:"关闭成功",type:"success"}),t.isprocess="error",t.shownext=!1,t.showfail=!0,t.showauxAnalys=!1,t.dialogVisible3=!1,t.$options.methods.loadData.bind(t)(!0)):t.$message({message:e.data.msg,type:"error"})}).catch(function(e){t.$message.error("关闭失败,请重新关闭")})},auxAnalys:function(){this.auxcontent=!this.auxcontent},changeState:function(t){var e=this,o=a("1nuA"),s={};s.id=t.id,s.status=t.status,c()({method:"post",url:e.$store.state.defaultHttp+"contacts/updateStatus.do?cId="+e.$store.state.iscId,data:o.stringify(s)}).then(function(t){t.data.code&&"200"==t.data.code?e.$options.methods.loadData.bind(e)():e.$message({message:"可能出了点什么问题，再看看",type:"error"})}).catch(function(t){})},changePrimary:function(t){var e=this,o=a("1nuA"),s={};s.id=t.id,s.isCrux=t.isCrux,c()({method:"post",url:e.$store.state.defaultHttp+"contacts/updateIsCrux.do?cId="+e.$store.state.iscId,data:o.stringify(s)}).then(function(t){t.data.code&&"200"==t.data.code?e.$options.methods.loadData.bind(e)():e.$message({message:"可能出了点什么问题，再看看",type:"error"})}).catch(function(t){})},retract:function(){this.thisshow=!this.thisshow,this.retracts=!this.retracts},beforeUploadimg:function(t,e){this.imgfile=t.raw;var a="jpg"===t.name.split(".")[1],o="png"===t.name.split(".")[1],s="jpeg"===t.name.split(".")[1],i=t.size/1024/1024<.5;return a||o||s?i?(this.imgName=t.name,void this.imgList.push({name:t.name})):(this.$message.warning("图片大小不能超过 500KB!"),!1):(this.$message.warning("图片只能是 jpg、png、jpeg格式!"),!1)},beforeUploadfile:function(t,e){this.files=t.raw;var a="xls"===t.name.split(".")[1],o="xlsx"===t.name.split(".")[1],s="doc"===t.name.split(".")[1],i="docx"===t.name.split(".")[1],n=t.size/1024/1024<5;return a||o||s||i?n?(this.filesName=t.name,void this.filesList.push({name:t.name})):(this.$message.warning("附件大小不能超过 5MB!"),!1):(this.$message.warning("附件只能是 xls、xlsx、doc、docx格式!"),!1)},Submitfollowform:function(){var t=this,e=(a("1nuA"),new FormData);e.append("opportunity_id",this.idArr.opportunity_id),e.append("followType",this.followform.followType),e.append("contactTime",this.followform.contactTime),e.append("followContent",this.followform.followContent),e.append("contactsId",this.followform.contactsId),e.append("customerpool_id",this.customerId),e.append("deptid",this.$store.state.insid),e.append("secondid",this.$store.state.deptid),e.append("imgNames",this.imgfile),e.append("enclosureNames",this.files),this.followform.followContent?this.followform.contactsId?c()({method:"get",url:t.$store.state.defaultHttp+"customerJurisdiction/follow.do"}).then(function(a){a.data.msg&&"error"==a.data.msg?t.$message({message:"对不起，您没有该权限，请联系管理员开通",type:"error"}):c()({method:"post",url:t.$store.state.defaultHttp+"addFollow.do?cId="+t.$store.state.iscId+"&pId="+t.$store.state.ispId,headers:{"Content-Type":"multipart/form-data"},data:e}).then(function(e){e.data.msg&&"success"==e.data.msg?t.$message({message:"提交成功",type:"success"}):t.$message({message:e.data.msg,type:"error"}),t.followform.contactTime="",t.followform.followContent="",t.followform.imgName="",t.followform.enclosureName="",t.filesList=[],t.imgList=[],t.imgfile=null,t.files=null,t.$options.methods.loadfollow.bind(t)(!0)}).catch(function(e){t.$message.error("提交失败,请重新提交")})}).catch(function(t){}):t.$message({message:"联系人不能为空",type:"error"}):t.$message({message:"跟进内容不能为空",type:"error"})},getCompetitor:function(){var t=this,e=a("1nuA"),o={};o.oy_id=this.idArr.opportunity_id,c()({method:"post",url:t.$store.state.defaultHttp+"opportunityCompetitor/selectByOpportunityId.do?cId="+t.$store.state.iscId,data:e.stringify(o)}).then(function(e){var a=e.data;t.competitorData=a.map(function(e){return t.$set(e,"edit",!1),e})}).catch(function(t){})},cellClick2:function(t,e,a,o){var s=this;"操作"!==e.label&&(t.edit=!0,this.competitorData.forEach(function(e,a){t.id==e.id&&(s.scopeIndex=a)}))},addCompetitor:function(){this.competitorData.push({id:null,oy_id:this.idArr.opportunity_id,competitor_id:null,contacts:null,advantage:null,inferiority:null,commonTactics:null,edit:!1})},selectChange:function(t,e){this.competitorList.forEach(function(a){a.id==t&&(e.competitor_id=a.id,e.contacts=a.contacts)})},editCompetitor:function(t,e){var o=this,s=a("1nuA"),i=e;i.competitor_id||this.$message({message:"竞争对手不能为空",type:"success"}),c()({method:"post",url:o.$store.state.defaultHttp+"opportunityCompetitor/saveOrUpdate.do?cId="+o.$store.state.iscId,data:s.stringify(i)}).then(function(t){t.data.code&&"200"==t.data.code?(o.$message({message:"操作成功",type:"success"}),e.edit=!1,o.$options.methods.loadData.bind(o)()):o.$message({message:t.data.msg,type:"error"})}).catch(function(t){})},deleteCompetitor:function(t,e){var o=this,s=a("1nuA"),i={};i.id=e.id,o.$confirm("是否确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){t.value;c()({method:"post",url:o.$store.state.defaultHttp+"opportunityCompetitor/delete.do?cId="+o.$store.state.iscId,data:s.stringify(i)}).then(function(t){t.data.code&&"200"==t.data.code?(o.$message({message:"操作成功",type:"success"}),o.$options.methods.loadData.bind(o)()):o.$message({message:t.data.msg,type:"error"})}).catch(function(t){})}).catch(function(){o.$message({type:"info",message:"取消删除"})})},getList:function(){var t=this,e=a("1nuA"),o={page:1,limit:1e6};c()({method:"post",url:t.$store.state.defaultHttp+"goods/search.do?cId="+t.$store.state.iscId,data:e.stringify(o)}).then(function(e){var a=e.data.map.goods;a.forEach(function(e){for(var a in e.aaa=JSON.parse(e.spec),e.goodspec=[],e.aaa)"null"!==a&&"undefined"!==a&&e.goodspec.push({label:a,value:e.aaa[a]});e.image?e.productImg=t.$store.state.systemHttp+"product/"+t.$store.state.iscId+"/"+e.image:e.productImg="../../../../static/img/noProduct.png"}),t.list=a.map(function(e){return t.$set(e,"edit",!1),e}),t.$options.methods.getSelect.bind(t)()}).catch(function(t){})},getItem:function(){var t=this;this.itemData=[],0!==this.updateData.length&&this.updateData.forEach(function(e,a){for(var o in e.aaa=JSON.parse(e.spec),e.goodspec=[],e.aaa)"null"!==o&&"undefined"!==o&&e.goodspec.push({label:o,value:e.aaa[o]});t.itemData.push({productImg:e.productImg,amountOfMoney:e.amountOfMoney,brand:e.brand,discount:e.discount,discountAfter:e.discountAfter,discountAmount:e.discountAmount,goodsId:e.goodsId,tbGoods:{goodsName:e.goodsName,describe:e.describe},id:e.itemId,itemId:e.itemId,num:e.num,price:e.price,taxAfter:e.taxAfter,taxAmount:e.taxAmount,taxRate:e.taxRate,goodspec:e.goodspec,unit:e.unit,edit:!1,remarks1:e.remarks1,remarks2:e.remarks2})})},getData:function(){var t=this,e=a("1nuA"),o={page:1,limit:1e6};o.classification_id=this.classification_id,o.searchName=this.goodsName,c()({method:"post",url:t.$store.state.defaultHttp+"goods/search.do?cId="+t.$store.state.iscId,data:e.stringify(o)}).then(function(e){var a=e.data.map.goods;a.map(function(e){return t.$set(e,"edit",!1),e}),a.forEach(function(e){for(var a in e.aaa=JSON.parse(e.spec),e.goodspec=[],e.aaa)"null"!==a&&"undefined"!==a&&e.goodspec.push({label:a,value:e.aaa[a]});e.image?e.productImg=t.$store.state.systemHttp+"product/"+t.$store.state.iscId+"/"+e.image:e.productImg="../../../../static/img/noProduct.png"}),t.tableData=a}).catch(function(t){})},getSelect:function(){var t=this;this.itemData.forEach(function(e,a){t.list.forEach(function(a,o){a.id==e.id&&t.list.splice(o,1)})}),this.selectData=this.list},handleAdd:function(){this.itemData.push({productImg:null,amountOfMoney:null,commitTime:null,brand:null,discount:null,discountAfter:null,discountAmount:null,tbGoods:{goodsName:"",describe:""},num:null,price:null,taxAfter:null,taxAmount:null,taxRate:null,unit:null,edit:!1,remarks1:null,remarks2:null})},getSummary:function(t){var e=t.columns,a=t.data,o=[];return e.forEach(function(t,e){if(0!==e){var s=a.map(function(e){return Number(e[t.property])});if("amountOfMoney"==t.property||"discountAmount"==t.property||"discountAfter"==t.property||"taxAmount"==t.property||"taxAfter"==t.property){o[e]=s.reduce(function(t,e){return e+t},0),o[e]=o[e].toFixed(2);var i=n()(o[e]).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"),l=".00",r=o[e].split(".");2===r.length?1===(l=r[1].toString()).length?o[e]=i+"."+l+"0":o[e]=i+"."+l:o[e]=i+l,o[e]+=" 元"}else"num"==t.property?(o[e]=s.reduce(function(t,e){return e+t},0),o[e]):o[e]=""}else o[e]="合计"}),o},cellClick:function(t,e,a,o){var s=this;t.edit=!1,"操作"!==e.label&&(t.edit=!0,this.itemData.forEach(function(e,a){t.id==e.id&&(s.scopeIndex=a)}))},handleFoces:function(t,e){this.scopeIndex=t},handleFilter:function(t){var e=this;this.selectData=[],this.list.forEach(function(a){-1!=a.tbGoods.goodsName.indexOf(t)&&e.selectData.push(a)})},currentChange:function(t){var e=this;this.itemData.forEach(function(a,o){o==e.scopeIndex&&t&&(t.edit=!0,t.price=t.tbGoods.price,t.discount=e.cusdiscount,t.taxRate=e.custaxRate,t.num=1,e.itemData.splice(o,1,t),e.OKdisabled=!1,e.$options.methods.handleinput(1,o,t))}),this.list.forEach(function(a,o){t&&t.id==a.id&&e.list.splice(o,1)}),this.selectData=this.list},handleinput:function(t,e,a,o){if(a.num&&a.price){var s=parseInt(a.num)*parseFloat(a.price);a.amountOfMoney=s.toFixed(2)}if(a.amountOfMoney&&a.discount&&"discount"==o){var i=parseFloat(a.amountOfMoney)*parseFloat(a.discount)/100,n=parseFloat(a.amountOfMoney)-i;a.discountAmount=n.toFixed(2),a.discountAfter=i.toFixed(2)}else if(a.amountOfMoney&&a.discountAmount&&"discountAmount"==o){var l=parseFloat(a.amountOfMoney)-parseFloat(a.discountAmount),r=l/parseFloat(a.amountOfMoney)*100;a.discount=r.toFixed(2),a.discountAfter=l.toFixed(2)}else if(a.amountOfMoney&&a.discount){var c=parseFloat(a.amountOfMoney)*parseFloat(a.discount)/100,d=parseFloat(a.amountOfMoney)-c;a.discountAmount=d.toFixed(2),a.discountAfter=c.toFixed(2)}else a.discountAmount=0,a.discountAfter=a.amountOfMoney;if(a.amountOfMoney&&a.taxRate)if(a.discountAfter){var u=parseFloat(a.discountAfter)*parseFloat(a.taxRate)/100,p=parseFloat(a.discountAfter)+u;a.taxAmount=u.toFixed(2),a.taxAfter=p.toFixed(2)}else{var m=parseFloat(a.amountOfMoney)*parseFloat(a.taxRate)/100,f=parseFloat(a.amountOfMoney)+m;a.taxAmount=m.toFixed(2),a.taxAfter=f.toFixed(2)}else a.taxAmount=0,a.taxAfter=a.discountAfter},showDialog:function(){this.dialogVisible1=!0,this.$options.methods.getData.bind(this)()},handleNodeClick:function(t){this.classification_id=t.id,0==t.next.length&&(this.nodeChange=!0,this.$options.methods.getData.bind(this)())},addInput:function(t){this.goodsName=t,this.$options.methods.getData.bind(this)()},selectInfo:function(t){this.itemList=[],this.multipleSelection=t;var e=t,a=new Array;e.forEach(function(t){0!=t.id&&a.push(t.id)}),this.idArr=a,this.itemList=t},handleSubmit:function(){var t=this,e=[];this.itemData.forEach(function(a,o){a.goodsId&&e.push(a),t.itemList.length&&t.itemList.forEach(function(e,o){e.edit=!0,a.id==e.id&&t.itemList.splice(o,1)})}),this.itemData=e.concat(this.itemList),this.itemData.forEach(function(e,a){t.list.forEach(function(o,s){o.id==e.id&&(e.price=o.tbGoods.price,e.discount=t.cusdiscount,e.taxRate=t.custaxRate,e.num=1,t.list.splice(s,1),t.$options.methods.handleinput(1,a,e))})}),this.selectData=this.list,this.dialogVisible1=!1},confirmEdit:function(t){t.edit=!1,this.$message({message:"本地保存成功",type:"success"})},handleDelete:function(t,e){var a=this;this.itemData.forEach(function(e,o){o==t&&a.itemData.splice(o,1)}),this.$options.methods.getList.bind(this)()},onSubmit:function(){var t=this,e=0,a=new Array;this.itemData.forEach(function(t){(t.goodsId||t.itemId)&&(e+=parseFloat(t.taxAfter),a.push({price:t.price,num:t.num,itemId:t.id,amountOfMoney:t.amountOfMoney,discount:t.discount,discountAmount:t.discountAmount,discountAfter:t.discountAfter,taxRate:t.taxRate,taxAmount:t.taxAmount,taxAfter:t.taxAfter,remarks1:t.remarks1,remarks2:t.remarks2}))});var o={id:this.productData.id,opportunity_id:this.idArr.opportunity_id,customerpoolId:this.customerId,totalSum:e,ascriptionId:this.customerpool.pId,secondid:this.customerpool.secondid,deptid:this.customerpool.deptid,orderDetails:a,pId:parseInt(this.$store.state.ispId)},s=!1;o.orderDetails.length||(t.$message({message:"至少添加一个产品",type:"error"}),s=!0),s||(this.isDisable=!0,c()({method:"post",url:t.$store.state.defaultHttp+"order/saveOrUpdateFromOpportunityOrContract.do?cId="+t.$store.state.iscId,data:o}).then(function(e){e.data.code&&"200"==e.data.code?(t.$message({message:"操作成功",type:"success"}),t.itemData.forEach(function(t){t.edit=!1}),t.$options.methods.loadData.bind(t)()):t.$message({message:e.data.msg,type:"error"}),t.isDisable=!1}).catch(function(e){t.isDisable=!1}))},getRow:function(t,e){this.$store.state.oppdetailsData.submitData={id:e.opportunity_id},this.idArr.opportunity_id=e.opportunity_id,this.$options.methods.loadData.bind(this)(!0)},search:function(){var t=this,e=a("1nuA"),o={};o.searchName=this.searchList.keyword,o.page=this.page,o.limit=this.limit,c()({method:"post",url:t.$store.state.defaultHttp+"opportunity/query.do?cId="+t.$store.state.iscId,data:e.stringify(o)}).then(function(e){t.tableDatas=e.data.map.success,t.tableNumber=e.data.count}).catch(function(t){})},handleSizeChange:function(t){this.limit=t,this.$options.methods.loadData.bind(this)()},handleCurrentChange:function(t){this.page=t,this.$options.methods.loadData.bind(this)()}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"oppdetcontent",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"top"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"bold_span"},[t._v(t._s(t.customerpool.name))]),a("span",{staticStyle:{"margin-left":"50px"}},[t._v("预计成交金额："+t._s(t._f("commaing")(t.opportunitydetail.opportunity_achievement))+" 元")]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.retracts,expression:"retracts"}],staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:function(e){t.retract()}}},[t._v("收起")]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.retracts,expression:"!retracts"}],staticClass:"info-btn",staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"mini"},on:{click:function(e){t.retract()}}},[t._v("显示")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.thisshow,expression:"thisshow"}],staticClass:"text item"},[a("ul",[a("li",[t._v("姓名："),a("span",[t._v(t._s(t.contacts.coName))])]),t._v(" "),a("li",[t._v("手机："),a("span",[t._v(t._s(t.contacts.phone))])]),t._v(" "),a("li",[t._v("电话："),a("span",[t._v(t._s(t.contacts.telephone))])]),t._v(" "),a("li",[t._v("邮箱："),a("span",[t._v(t._s(t.contacts.email))])]),t._v(" "),a("li",[t._v("QQ："),a("span",[t._v(t._s(t.contacts.qq))])]),t._v(" "),a("li",[t._v("微信："),a("span",[t._v(t._s(t.contacts.wechat))])]),t._v(" "),a("li",[t._v("性别："),a("span",[t._v(t._s(t.contacts.sex))])]),t._v(" "),a("li",[t._v("职务："),a("span",[t._v(t._s(t.contacts.identity))])]),t._v(" "),a("li",[t._v("备注："),a("span",[t._v(t._s(t.customerpool.remark))])]),t._v(" "),a("li",[t._v("地址："),a("span",[t._v(t._s(t.customerpool.address))])]),t._v(" "),t._l(t.fieldData,function(e,o){return a("li",{key:o},[t._v("\n                            "+t._s(e.name)+"："),a("span",[t._v(t._s(e.value))])])})],2)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.thisshow,expression:"!thisshow"}]})])],1),t._v(" "),t.auxcontent?a("div",{staticClass:"bottom"},[a("div",{staticClass:"aux_c"},[a("div",{staticClass:"aux_ul"},[a("div",{staticClass:"aux_li"},[a("p",[a("span",{staticStyle:{"font-size":"20px","line-height":"50px","font-weight":"bold"}},[t._v(t._s(t.auxList.timeConsuming)+"天")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"12px",color:"#666666","line-height":"25px"}},[t._v("跟踪时间")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"14px",color:"#333333","line-height":"20px"}},[t._v(t._s(t.auxList.trackProportion)+"%")])]),t._v(" "),a("el-progress",{attrs:{type:"circle",percentage:t.aaa,width:34,"stroke-width":5,"show-text":!1}})],1)]),t._v(" "),a("div",{staticClass:"aux_ul"},[a("div",{staticClass:"aux_li"},[a("p",[a("span",{staticStyle:{"font-size":"20px","line-height":"50px","font-weight":"bold"}},[t._v(t._s(t.auxList.surplusTime)+"天")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"12px",color:"#666666","line-height":"25px"}},[t._v("剩余天数")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"14px",color:"#333333","line-height":"20px"}},[t._v(t._s(t.auxList.surplusProportion)+"%")])]),t._v(" "),a("el-progress",{attrs:{type:"circle",percentage:t.bbb,width:34,"stroke-width":5,"show-text":!1}})],1)]),t._v(" "),a("div",{staticClass:"aux_ul"},[a("div",{staticClass:"aux_li"},[a("p",[a("span",{staticStyle:{"font-size":"20px","line-height":"50px","font-weight":"bold"}},[t._v(t._s(t.auxList.step_probability)+"%")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"12px",color:"#666666","line-height":"25px"}},[t._v("成功率")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"14px",color:"#333333","line-height":"20px"}},[t._v(t._s(t.auxList.step_probability)+"%")])]),t._v(" "),a("el-progress",{attrs:{type:"circle",percentage:t.ccc,width:34,"stroke-width":5,"show-text":!1}})],1)]),t._v(" "),a("div",{staticClass:"aux_ul"},[a("div",{staticClass:"aux_li"},[a("p",[a("span",{staticStyle:{"font-size":"20px","line-height":"50px","font-weight":"bold"}},[t._v(t._s(t.auxList.competitor)+"人")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"12px",color:"#666666","line-height":"25px"}},[t._v("竞争对手")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"14px",color:"#333333","line-height":"20px"}},[t._v(" ")])])])]),t._v(" "),a("div",{staticClass:"aux_ul"},[a("div",{staticClass:"aux_li"},[a("p",[a("span",{staticStyle:{"font-size":"20px","line-height":"50px","font-weight":"bold"}},[t._v(t._s(t.auxList.num)+"次")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"12px",color:"#666666","line-height":"25px"}},[t._v("联系次数")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"14px",color:"#333333","line-height":"20px"}},[t._v(t._s(t.auxList.numProportion)+"%")])]),t._v(" "),a("el-progress",{attrs:{type:"circle",percentage:t.fff,width:34,"stroke-width":5,"show-text":!1}})],1)]),t._v(" "),a("div",{staticClass:"aux_ul"},[a("div",{staticClass:"aux_li"},[a("p",[a("span",{staticStyle:{"font-size":"20px","line-height":"50px","font-weight":"bold"}},[t._v(t._s(t.auxList.contacts)+"人")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"12px",color:"#666666","line-height":"25px"}},[t._v("关键联系人")]),a("br"),t._v(" "),a("span",{staticStyle:{"font-size":"14px",color:"#333333","line-height":"20px"}},[t._v(t._s(t.auxList.contactsProportion)+"%")])]),t._v(" "),a("el-progress",{attrs:{type:"circle",percentage:t.ggg,width:34,"stroke-width":5,"show-text":!1}})],1)])])]):t._e(),t._v(" "),a("div",{staticClass:"top"},[a("el-card",{staticClass:"box-card step_process"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.opportunitydetail.opportunity_name))]),t._v(" "),t.shownext?a("el-button",{staticClass:"info-btn",staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("下一步")]):t._e(),t._v(" "),t.shownext?a("el-button",{staticClass:"info-btn",staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(e){t.dialogVisible3=!0}}},[t._v("失败关闭")]):t._e(),t._v(" "),t.showfail?a("span",{staticStyle:{"line-height":"20px",float:"right","font-size":"14px"}},[t._v("该商机已关闭")]):t._e(),t._v(" "),t.showsuccess?a("span",{staticStyle:{"line-height":"20px",float:"right","font-size":"14px"}},[t._v("签约成功！")]):t._e(),t._v(" "),t.showauxAnalys?a("el-button",{staticClass:"info-btn",staticStyle:{float:"right","margin-right":"10px"},attrs:{size:"mini"},on:{click:function(e){t.auxAnalys()}}},[t._v("辅助分析")]):t._e()],1),t._v(" "),a("el-steps",{staticStyle:{padding:"10px"},attrs:{active:t.active,"finish-status":"success","process-status":t.isprocess,"align-center":""}},t._l(t.stepList,function(e){return a("el-step",{key:e.step_id,attrs:{title:e.step_name,description:e.step_probability}},[a("template",{slot:"description"},[a("p",[t._v("成功几率："+t._s(e.step_probability)+"%")]),t._v(" "),t.showcreate?a("p",[t._v(t._s(e.createTime))]):t._e(),t._v(" "),t.showdurate?a("p",[t._v(t._s(e.duration))]):t._e()])],2)}))],1)],1),t._v(" "),a("div",{staticClass:"bottom"},[a("el-tabs",{attrs:{type:"card"},model:{value:t.baseindex,callback:function(e){t.baseindex=e},expression:"baseindex"}},[a("el-tab-pane",{staticStyle:{"min-height":"200px"},attrs:{label:"跟进记录",name:"first"}},[a("el-form",{ref:"followform",staticClass:"followform",attrs:{rules:t.rules,model:t.followform}},[a("el-form-item",{attrs:{prop:"followContent"}},[a("el-input",{attrs:{type:"textarea",placeholder:"添加跟进内容"},model:{value:t.followform.followContent,callback:function(e){t.$set(t.followform,"followContent",e)},expression:"followform.followContent"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"联系方式",prop:"followType"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},model:{value:t.followform.followType,callback:function(e){t.$set(t.followform,"followType",e)},expression:"followform.followType"}},t._l(t.followTypes,function(t){return a("el-option",{key:t.value,attrs:{value:t.label,label:t.label}})}))],1),t._v(" "),a("el-form-item",{staticStyle:{width:"290px"},attrs:{label:"联系人",prop:"contactsId"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},model:{value:t.followform.contactsId,callback:function(e){t.$set(t.followform,"contactsId",e)},expression:"followform.contactsId"}},t._l(t.contactData,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"下次联系时间"}},[a("el-date-picker",{staticStyle:{width:"200px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","default-time":"12:00:00","picker-options":t.pickerOptions,placeholder:"选择日期时间"},model:{value:t.followform.contactTime,callback:function(e){t.$set(t.followform,"contactTime",e)},expression:"followform.contactTime"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"快捷沟通"}},t._l(t.fastcontactList,function(e){return a("el-radio",{key:e.id,attrs:{label:e.content},model:{value:t.followform.followContent,callback:function(e){t.$set(t.followform,"followContent",e)},expression:"followform.followContent"}},[t._v(t._s(e.typeName))])})),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"上传图片"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"file-list":t.imgList,action:"","auto-upload":!1,"on-change":t.beforeUploadimg}},[a("el-button",{staticClass:"info-btn",attrs:{size:"mini"}},[t._v("上传图片")])],1)],1),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"上传附件"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"file-list":t.filesList,action:"","auto-upload":!1,"on-change":t.beforeUploadfile}},[a("el-button",{staticClass:"info-btn",attrs:{size:"mini"}},[t._v("上传附件")])],1)],1),t._v(" "),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{staticStyle:{"margin-top":"6px"},attrs:{type:"primary",size:"mini"},on:{click:t.Submitfollowform}},[t._v("立即提交")])],1)],1),t._v(" "),a("div",{staticStyle:{width:"100%",height:"10px"}}),t._v(" "),t._l(t.record,function(e){return a("ul",{key:e.followId,staticClass:"followrecord"},[a("li",{staticClass:"recordicon"},[a("img",{staticClass:"detail_portrait",attrs:{src:e.imgUrl,alt:"头像"}})]),t._v(" "),a("li",{staticClass:"verticalline"}),t._v(" "),a("li",{staticClass:"recordcontent"},[a("div",{staticClass:"left_more"},[a("p",[a("span",{staticClass:"de_span_2"},[t._v(t._s(e.contacts[0].name))]),t._v(" "),a("span",{staticClass:"de_span_1"},[t._v(" | ")]),t._v(" "),a("span",{staticClass:"de_span_1"},[t._v(t._s(e.createTime))]),t._v(" "),e.contactTime?a("span",{staticClass:"de_span_1"},[t._v("  --  ")]):t._e(),t._v(" "),a("span",{staticClass:"de_span_1"},[t._v(t._s(e.contactTime))]),t._v("\n                                      \n                                    "),a("span",{staticClass:"de_span_3"},[t._v("  "+t._s(e.followType)+"  ")])]),t._v(" "),a("div",{staticStyle:{"margin-top":"15px","margin-bottom":"15px"},domProps:{innerHTML:t._s(e.followContent)}}),t._v(" "),e.imgName?a("div",{staticClass:"imgbox_two"},[a("img",{attrs:{src:e.picture_detail,alt:"图片",width:"80",height:"80"},on:{click:function(a){t.showImg(a,e)}}})]):t._e(),t._v(" "),e.enclosureName?a("div",[a("a",{attrs:{href:e.enclosureUrl,download:""}},[t._v(t._s(e.enclosureOldName))])]):t._e(),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible2},on:{"update:visible":function(e){t.dialogVisible2=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl2,alt:""}})])],1)])])})],2),t._v(" "),a("el-tab-pane",{attrs:{label:"基本信息",name:"second"}},[a("div",{staticClass:"text"},[a("ul",[a("li",[t._v("客户决策人："),a("span",[t._v(t._s(t.contacts.coName))])]),t._v(" "),a("li",[t._v("创建时间："),a("span",[t._v(t._s(t.opportunitydetail.opportunity_time))])]),t._v(" "),a("li",[t._v("签约时间："),a("span",[t._v(t._s(t.contractTime))])]),t._v(" "),a("li",[t._v("失败时间："),a("span",[t._v(t._s(t.failTime))])]),t._v(" "),a("li",[t._v("预计成交金额："),a("span",{staticClass:"bold_span"},[t._v(t._s(t._f("commaing")(t.opportunitydetail.opportunity_achievement))+" 元")])]),t._v(" "),a("li",[t._v("预计成交时间："),a("span",[t._v(t._s(t.opportunitydetail.opportunity_deal))])]),t._v(" "),a("li",[t._v("负责人："),a("span",[t._v(t._s(t.privateUser.private_employee))])]),t._v(" "),a("li",[t._v("部门："),a("span",[t._v(t._s(t.opportunitydetail.deptname))])]),t._v(" "),a("li",[t._v("机构："),a("span",[t._v(t._s(t.opportunitydetail.parentname))])]),t._v(" "),a("li",[t._v("备注："),a("span",[t._v(t._s(t.opportunitydetail.opportunity_remarks))])])])])]),t._v(" "),a("el-tab-pane",{attrs:{label:"联系人",name:"third"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.contactData,border:"",stripe:""}},[a("el-table-column",{attrs:{prop:"name",label:"联系人名称","min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"手机","min-width":"110"}}),t._v(" "),a("el-table-column",{attrs:{label:"固话",prop:"telephone","min-width":"110"}}),t._v(" "),a("el-table-column",{attrs:{label:"邮箱",prop:"email","min-width":"130"}}),t._v(" "),a("el-table-column",{attrs:{label:"QQ",prop:"qq","min-width":"110"}}),t._v(" "),a("el-table-column",{attrs:{label:"微信",prop:"wechat","min-width":"110"}}),t._v(" "),a("el-table-column",{attrs:{label:"地址",prop:"address","min-width":"200"}}),t._v(" "),a("el-table-column",{attrs:{label:"职务",prop:"identity","show-overflow-tooltip":"","min-width":"90"}}),t._v(" "),a("el-table-column",{attrs:{label:"性别",prop:"sex","min-width":"90"}}),t._v(" "),a("el-table-column",{attrs:{label:"是否在职",prop:"status","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{content:e.row.status,placement:"right"}},[a("el-switch",{attrs:{"active-value":"在职","inactive-value":"离职","active-color":"#13ce66","inactive-color":"#bbbbbb"},on:{change:function(a){t.changeState(e.row)}},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"是否为关键人",prop:"isCrux","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{content:e.row.isCrux,placement:"right"}},[a("el-switch",{attrs:{"active-value":"是","inactive-value":"否","active-color":"#13ce66","inactive-color":"#bbbbbb"},on:{change:function(a){t.changePrimary(e.row)}},model:{value:e.row.isCrux,callback:function(a){t.$set(e.row,"isCrux",a)},expression:"scope.row.isCrux"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"备注",prop:"remark","min-width":"180"}})],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"产品报价",name:"fourth"}},[a("div",{staticClass:"entry"},[a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.handleAdd}}),t._v(" "),a("el-popover",{attrs:{placement:"bottom",width:"100",trigger:"click"}},[a("el-checkbox-group",{staticClass:"checklist",staticStyle:{"max-height":"600px","overflow-y":"overlay","overflow-x":"hidden"},model:{value:t.checklist,callback:function(e){t.checklist=e},expression:"checklist"}},t._l(t.filterList,function(e){return a("el-checkbox",{key:e.id,staticClass:"checkone",attrs:{label:e.name,value:e.state},on:{change:function(a){t.hangleChange(a,e)}}})})),t._v(" "),a("el-button",{staticClass:"info-btn screen",attrs:{slot:"reference",icon:"el-icon-more",type:"mini"},slot:"reference"})],1)],1),t._v(" "),a("el-table",{attrs:{data:t.itemData,border:"","highlight-current-row":"","show-summary":"","summary-method":t.getSummary},on:{"cell-click":t.cellClick}},[a("el-table-column",{attrs:{"header-align":"center",fixed:"",align:"center",type:"index",width:"45"}}),t._v(" "),t._l(t.filterList,function(e,o){return a("div",{key:o},["goodsName"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"产品名称",prop:"tbGoods.goodsName","min-width":"280",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-select",{attrs:{placeholder:"请选择",filterable:"","filter-method":t.handleFilter},on:{focus:function(a){t.handleFoces(e.$index,e.row)}},model:{value:e.row.tbGoods.goodsName,callback:function(a){t.$set(e.row.tbGoods,"goodsName",a)},expression:"scope.row.tbGoods.goodsName"}},[a("el-option",{staticClass:"droplist",attrs:{value:e.row.tbGoods.goodsName}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.selectData,border:""},on:{"current-change":t.currentChange}},[a("el-table-column",{attrs:{"header-align":"center",type:"index","min-width":"45"}}),t._v(" "),a("el-table-column",{attrs:{prop:"tbGoods.goodsName",label:"产品名称",width:"130"}}),t._v(" "),a("el-table-column",{attrs:{prop:"tbGoods.describe","show-overflow-tooltip":"",label:"描述",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"goodspec",label:"规格属性","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.goodspec,function(e,o){return a("span",{key:o},[t._v(t._s(e.label+"："+e.value))])})}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"unit",label:"单位","min-width":"90"}})],1)],1)],1),t._v(" "),a("el-button",{staticClass:"btn info-btn",staticStyle:{width:"30px",height:"28px",padding:"0"},attrs:{size:"mini",icon:"el-icon-more"},on:{click:function(e){t.showDialog()}}})]:a("span",[t._v(t._s(e.row.tbGoods.goodsName))])]}}])}):t._e(),t._v(" "),"image"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"主图",prop:"productImg",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"right",width:"200",trigger:"hover"}},[a("img",{attrs:{src:e.row.productImg,alt:"",width:"200",height:"200"}}),t._v(" "),a("img",{attrs:{slot:"reference",src:e.row.productImg,alt:"",width:"80",height:"80"},slot:"reference"})])]}}])}):t._e(),t._v(" "),"describe"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"规格描述",prop:"tbGoods.describe","min-width":"120"}}):t._e(),t._v(" "),"spec"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"规格属性",prop:"goodspec","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.goodspec,function(e,o){return a("span",{key:o},[t._v(t._s(e.value+"/"))])})}}])}):t._e(),t._v(" "),"unit"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"单位",prop:"unit","min-width":"50"}}):t._e(),t._v(" "),"num"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"num","min-width":"100",label:"数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",size:"small"},on:{input:function(a){t.handleinput(a,e.$index,e.row)}},model:{value:e.row.num,callback:function(a){t.$set(e.row,"num",a)},expression:"scope.row.num"}})]:a("span",[t._v(t._s(e.row.num))])]}}])}):t._e(),t._v(" "),"price"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"price","min-width":"120",label:"单价"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'.')",size:"small"},on:{input:function(a){t.handleinput(a,e.$index,e.row)}},model:{value:e.row.price,callback:function(a){t.$set(e.row,"price",a)},expression:"scope.row.price"}})]:a("span",[t._v(t._s(e.row.price))])]}}])}):t._e(),t._v(" "),"amountOfMoney"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"amountOfMoney","min-width":"120",label:"金额"}}):t._e(),t._v(" "),"discount"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"discount","min-width":"90",label:"折扣"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'.')",size:"small"},on:{input:function(a){t.handleinput(a,e.$index,e.row,"discount")}},model:{value:e.row.discount,callback:function(a){t.$set(e.row,"discount",a)},expression:"scope.row.discount"}},[a("span",{staticStyle:{"margin-right":"5px","line-height":"34px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("%")])])]:e.row.discount?a("span",[t._v(t._s(e.row.discount+" %"))]):t._e()]}}])}):t._e(),t._v(" "),"discountAmount"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"discountAmount","min-width":"120",label:"折扣额"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'.')",size:"small"},on:{input:function(a){t.handleinput(a,e.$index,e.row,"discountAmount")}},model:{value:e.row.discountAmount,callback:function(a){t.$set(e.row,"discountAmount",a)},expression:"scope.row.discountAmount"}})]:a("span",[t._v(t._s(e.row.discountAmount))])]}}])}):t._e(),t._v(" "),"discountAfter"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"discountAfter","min-width":"120",label:"折后金额"}}):t._e(),t._v(" "),"taxRate"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"taxRate","min-width":"90",label:"税率"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'.')",size:"small"},on:{input:function(a){t.handleinput(a,e.$index,e.row)}},model:{value:e.row.taxRate,callback:function(a){t.$set(e.row,"taxRate",a)},expression:"scope.row.taxRate"}},[a("span",{staticStyle:{"margin-right":"5px","line-height":"34px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("%")])])]:a("span",[t._v(t._s(e.row.taxRate))])]}}])}):t._e(),t._v(" "),"taxAmount"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"taxAmount","min-width":"120",label:"税额"}}):t._e(),t._v(" "),"taxAfter"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"taxAfter","min-width":"120",label:"税后金额"}}):t._e(),t._v(" "),"commitTime"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"交货日期",prop:"commitTime",width:"90"}}):t._e(),t._v(" "),"brand"==e.prop&&1==e.state?a("el-table-column",{attrs:{prop:"brand","min-width":"80",label:"产品品牌"}}):t._e(),t._v(" "),"remark"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"产品备注",prop:"tbGoods.remark",width:"120"}}):t._e(),t._v(" "),"remarks1"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"备注1",prop:"remarks1","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{size:"small"},model:{value:e.row.remarks1,callback:function(a){t.$set(e.row,"remarks1",a)},expression:"scope.row.remarks1"}})]:a("span",[t._v(t._s(e.row.remarks1))])]}}])}):t._e(),t._v(" "),"remarks2"==e.prop&&1==e.state?a("el-table-column",{attrs:{label:"备注2",prop:"remarks2","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{size:"small"},model:{value:e.row.remarks2,callback:function(a){t.$set(e.row,"remarks2",a)},expression:"scope.row.remarks2"}})]:a("span",[t._v(t._s(e.row.remarks2))])]}}])}):t._e()],1)}),t._v(" "),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticStyle:{width:"30px",height:"30px",padding:"0"},attrs:{type:"success",plain:"",disabled:!e.row.edit,icon:"el-icon-circle-check-outline"},on:{click:function(a){t.confirmEdit(e.row)}}}),t._v(" "),a("el-button",{staticStyle:{width:"30px",height:"30px",padding:"0"},attrs:{type:"danger",plain:"",icon:"el-icon-delete"},on:{click:function(a){t.handleDelete(e.$index,e.row)}}})]}}])})],2),t._v(" "),a("div",{staticClass:"pro_sub_btn"},[a("el-button",{attrs:{type:"primary",disabled:t.isDisable},on:{click:t.onSubmit}},[t._v("立即提交")])],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"竞争对手",name:"fifth"}},[a("div",{staticClass:"entry"},[a("el-button",{staticClass:"btn info-btn",attrs:{size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:t.addCompetitor}})],1),t._v(" "),a("el-table",{attrs:{data:t.competitorData,border:"","highlight-current-row":""},on:{"cell-click":t.cellClick2}},[a("el-table-column",{attrs:{"header-align":"center",fixed:"",align:"center",type:"index",width:"45"}}),t._v(" "),a("el-table-column",{attrs:{label:"公司名称",prop:"name","min-width":"280",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-select",{attrs:{placeholder:"请选择",filterable:""},on:{focus:function(a){t.handleFoces(e.$index,e.row)},change:function(a){t.selectChange(a,e.row)}},model:{value:e.row.name,callback:function(a){t.$set(e.row,"name",a)},expression:"scope.row.name"}},t._l(t.competitorList,function(t){return a("el-option",{key:t.id,staticClass:"droplist",attrs:{label:t.name,value:t.id}})}))]:a("span",[t._v(t._s(e.row.name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"contacts","min-width":"100",label:"联系人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"advantage","min-width":"220",label:"优势"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{size:"small"},model:{value:e.row.advantage,callback:function(a){t.$set(e.row,"advantage",a)},expression:"scope.row.advantage"}})]:a("span",[t._v(t._s(e.row.advantage))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"inferiority","min-width":"220",label:"劣势"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{size:"small"},model:{value:e.row.inferiority,callback:function(a){t.$set(e.row,"inferiority",a)},expression:"scope.row.inferiority"}})]:a("span",[t._v(t._s(e.row.inferiority))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"commonTactics","min-width":"220",label:"常用战术"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("el-input",{staticClass:"edit-input",attrs:{size:"small"},model:{value:e.row.commonTactics,callback:function(a){t.$set(e.row,"commonTactics",a)},expression:"scope.row.commonTactics"}})]:a("span",[t._v(t._s(e.row.commonTactics))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticStyle:{width:"30px",height:"30px",padding:"0"},attrs:{type:"success",plain:"",disabled:!e.row.edit,icon:"el-icon-circle-check-outline"},on:{click:function(a){t.editCompetitor(e.$index,e.row)}}}),t._v(" "),a("el-button",{staticStyle:{width:"30px",height:"30px",padding:"0"},attrs:{type:"danger",plain:"",icon:"el-icon-delete"},on:{click:function(a){t.deleteCompetitor(e.$index,e.row)}}})]}}])})],1)],1),t._v(" "),t.showfail?a("el-tab-pane",{attrs:{label:"失败原因",name:"sixth"}},[a("div",{staticClass:"wo_c",staticStyle:{"min-height":"200px"}},[a("ul",{staticClass:"wo_ul_left"},[a("li",{staticClass:"wo_li_left"},[a("span",{staticStyle:{"font-size":"14px"}},[t._v("失败原因：")]),t._v(" "),t._l(t.opportunitydetail.reasonsForFailures,function(e){return a("el-tag",{key:e,staticStyle:{"margin-right":"5px"},attrs:{size:"small",type:"info"}},[t._v(t._s(e))])})],2),t._v(" "),a("br"),t._v(" "),a("li",{staticClass:"wo_li_left"},[a("span",{staticStyle:{"font-size":"14px"}},[t._v("失败描述：")]),t._v(" "),a("div",{domProps:{innerHTML:t._s(t.opportunitydetail.codeSnippet)}})])])])]):t._e()],1)],1)]),t._v(" "),a("el-dialog",{staticClass:"orderDialog",attrs:{title:"选择产品",visible:t.dialogVisible1,"close-on-click-modal":!1,width:"80%",center:""},on:{"update:visible":function(e){t.dialogVisible1=e}}},[a("div",{staticClass:"otherleftcontent"},[a("el-tree",{attrs:{"node-key":"id","highlight-current":"",accordion:"","expand-on-click-node":"",data:t.datalist,props:t.defaultProps,"default-expanded-keys":t.defaultkeys},on:{"node-click":t.handleNodeClick}})],1),t._v(" "),a("div",{staticClass:"otherightcontent"},[a("span",[t._v("产品名称：")]),a("el-input",{staticStyle:{width:"200px"},on:{input:t.addInput},model:{value:t.goodsName,callback:function(e){t.goodsName=e},expression:"goodsName"}}),t._v(" "),a("br"),a("br"),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"",fit:""},on:{"selection-change":t.selectInfo}},[a("el-table-column",{attrs:{"header-align":"center",align:"center",type:"selection","min-width":"45"},on:{"selection-change":t.selectInfo}}),t._v(" "),a("el-table-column",{attrs:{prop:"tbGoods.goodsName",label:"产品名称",width:"130"}}),t._v(" "),a("el-table-column",{attrs:{prop:"tbGoods.describe","show-overflow-tooltip":"",label:"描述",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"goodspec",label:"规格属性","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.goodspec,function(e,o){return a("span",{key:o},[t._v(t._s(e.label+"："+e.value))])})}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"unit",label:"单位",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{prop:"brand",label:"品牌",width:"90"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer order_foot",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible1=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.handleSubmit()}}},[t._v("确 定")])],1)]),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible,"close-on-click-modal":!1,width:"400px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("span",[t._v("确认修改商机进度吗？一旦确定将不可撤回")]),t._v(" "),a("br"),a("br"),t._v(" "),a("span",{staticStyle:{"margin-right":"10px","font-size":"14px"}},[t._v("预计成交时间:")]),t._v(" "),a("el-date-picker",{attrs:{align:"right",type:"date","picker-options":t.pickerOptions,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:t.opportunityDeal,callback:function(e){t.opportunityDeal=e},expression:"opportunityDeal"}}),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.closeDialog()}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.nextStep()}}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible3,"close-on-click-modal":!1,width:"620px"},on:{"update:visible":function(e){t.dialogVisible3=e}}},[a("span",[t._v("确认关闭商机进度吗？一旦确定将不可撤回")]),t._v(" "),a("br"),a("br"),t._v(" "),a("el-checkbox-group",{model:{value:t.reasonsForFailure,callback:function(e){t.reasonsForFailure=e},expression:"reasonsForFailure"}},t._l(t.failReasonData,function(e){return a("el-checkbox",{key:e.id,staticStyle:{width:"190px",margin:"0"},attrs:{label:e.id}},[t._v(t._s(e.typeName))])})),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"editor-container"},[a("UE",{ref:"ue",attrs:{defaultMsg:t.defaultMsg,config:t.config}})],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible3=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.endStep()}}},[t._v("确 定")])],1)],1),t._v(" "),a("el-col",{staticClass:"right",staticStyle:{padding:"10px","min-height":"600px"},attrs:{span:6}},[a("div",{staticClass:"searchList",staticStyle:{width:"100%"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入公司名称"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null}},model:{value:t.searchList.keyword,callback:function(e){t.$set(t.searchList,"keyword",e)},expression:"searchList.keyword"}}),t._v(" "),a("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"mini"},on:{click:function(e){t.search()}}})],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableDatas}},[a("el-table-column",{attrs:{prop:"customerpool[0].name",label:"公司名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{on:{click:function(a){t.getRow(e.$index,e.row)}}},[t._v("\n                        "+t._s(e.row.customerpool[0].name)+"\n                    ")])]}}])})],1),t._v(" "),a("div",{staticClass:"block numberPage number"},[a("el-pagination",{attrs:{"current-page":t.page,"page-sizes":[20,30,50,100],"page-size":20,layout:"total, sizes, prev, next",total:t.tableNumber},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(u,p,!1,function(t){a("/j3N")},null,null);e.default=m.exports}});